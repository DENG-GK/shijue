# é¢å‘å¯¹è±¡ç¼–ç¨‹

> é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰æ˜¯ Python çš„æ ¸å¿ƒç‰¹æ€§ï¼Œåœ¨è®¡ç®—æœºè§†è§‰é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨ã€‚å­¦ä¼š OOPï¼Œä½ å°±èƒ½å†™å‡ºæ›´æœ‰ç»„ç»‡ã€æ›´æ˜“æ‰©å±•çš„ä»£ç ã€‚

---

## ğŸ“– ç†è®ºéƒ¨åˆ†

### 1. ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Ÿ

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å†™çš„ä»£ç éƒ½æ˜¯"é¢å‘è¿‡ç¨‹"çš„â€”â€”ä¸€æ­¥ä¸€æ­¥æŒ‰é¡ºåºæ‰§è¡Œã€‚ä½†å½“é¡¹ç›®å˜å¤§åï¼Œè¿™ç§æ–¹å¼ä¼šå˜å¾—æ··ä¹±ã€‚

**é¢å‘è¿‡ç¨‹ vs é¢å‘å¯¹è±¡çš„ç›´è§‚å¯¹æ¯”ï¼š**

```python
# ========== é¢å‘è¿‡ç¨‹ï¼šæ•°æ®å’Œå‡½æ•°åˆ†ç¦» ==========
# æ•°æ®
image_name = "photo.jpg"
image_width = 1920
image_height = 1080
image_channels = 3

# å‡½æ•°
def get_pixel_count(w, h):
    return w * h

def get_size_mb(w, h, c):
    return w * h * c / (1024 * 1024)

# ä½¿ç”¨æ—¶è¦æ‰‹åŠ¨ä¼ å…¥æ­£ç¡®çš„æ•°æ®
pixels = get_pixel_count(image_width, image_height)
size = get_size_mb(image_width, image_height, image_channels)
```

```python
# ========== é¢å‘å¯¹è±¡ï¼šæ•°æ®å’Œå‡½æ•°ç»‘å®šåœ¨ä¸€èµ· ==========
class Image:
    def __init__(self, name, width, height, channels=3):
        self.name = name
        self.width = width
        self.height = height
        self.channels = channels

    def get_pixel_count(self):
        return self.width * self.height

    def get_size_mb(self):
        return self.width * self.height * self.channels / (1024 * 1024)

# ä½¿ç”¨æ—¶æ›´ç›´è§‚
img = Image("photo.jpg", 1920, 1080)
pixels = img.get_pixel_count()     # æ•°æ®å’Œæ“ä½œç»‘åœ¨ä¸€èµ·äº†ï¼
size = img.get_size_mb()
```

**é€šä¿—ç†è§£ï¼š**
- **é¢å‘è¿‡ç¨‹** å°±åƒåšèœçš„é£Ÿè°±ï¼šç¬¬ä¸€æ­¥åˆ‡èœï¼Œç¬¬äºŒæ­¥çƒ­æ²¹ï¼Œç¬¬ä¸‰æ­¥ç‚’èœ...
- **é¢å‘å¯¹è±¡** å°±åƒæŠŠ"å¨å¸ˆ"å°è£…èµ·æ¥ï¼šå¨å¸ˆçŸ¥é“è‡ªå·±æœ‰ä»€ä¹ˆé£Ÿæï¼ˆå±æ€§ï¼‰ï¼ŒçŸ¥é“æ€ä¹ˆåšèœï¼ˆæ–¹æ³•ï¼‰ï¼Œä½ åªéœ€è¦è¯´"å¨å¸ˆï¼Œåšä¸€ç›˜å®«ä¿é¸¡ä¸"ã€‚

---

### 2. ç±»å’Œå¯¹è±¡

- **ç±»ï¼ˆClassï¼‰**ï¼šæ˜¯ä¸€ä¸ª"æ¨¡æ¿"æˆ–"è“å›¾"ï¼Œå®šä¹‰äº†å¯¹è±¡åº”è¯¥æœ‰ä»€ä¹ˆå±æ€§å’Œè¡Œä¸º
- **å¯¹è±¡ï¼ˆObjectï¼‰**ï¼šæ˜¯ç±»çš„ä¸€ä¸ª"å®ä¾‹"ï¼Œæ˜¯æ ¹æ®æ¨¡æ¿åˆ›å»ºå‡ºæ¥çš„å…·ä½“ä¸œè¥¿

```python
# ç±» = æ¨¡æ¿          å¯¹è±¡ = å…·ä½“çš„å®ä¾‹
# "æ±½è½¦è®¾è®¡å›¾"  â†’    "æˆ‘çš„é‚£è¾†çº¢è‰²æœ¬ç”°"
# "Image ç±»"    â†’    "photo.jpg è¿™å¼ å…·ä½“çš„å›¾ç‰‡"
```

#### 2.1 å®šä¹‰ä¸€ä¸ªç±»

```python
class Dog:
    """ä¸€åªç‹—çš„ç±»"""

    def __init__(self, name, breed):
        """æ„é€ å‡½æ•°ï¼šåˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨

        Args:
            name: ç‹—çš„åå­—
            breed: å“ç§
        """
        self.name = name      # å®ä¾‹å±æ€§
        self.breed = breed    # å®ä¾‹å±æ€§
        self.tricks = []      # å®ä¾‹å±æ€§ï¼ˆé»˜è®¤ç©ºåˆ—è¡¨ï¼‰

    def sit(self):
        """è®©ç‹—åä¸‹"""
        print(f"{self.name} åä¸‹äº† ğŸ•")

    def learn_trick(self, trick):
        """å­¦ä¹ æ–°æŠ€èƒ½"""
        self.tricks.append(trick)
        print(f"{self.name} å­¦ä¼šäº†: {trick}!")

    def show_tricks(self):
        """å±•ç¤ºæ‰€æœ‰æŠ€èƒ½"""
        if self.tricks:
            print(f"{self.name} çš„æŠ€èƒ½: {', '.join(self.tricks)}")
        else:
            print(f"{self.name} è¿˜æ²¡å­¦ä¼šä»»ä½•æŠ€èƒ½")
```

#### 2.2 åˆ›å»ºå¯¹è±¡ï¼ˆå®ä¾‹åŒ–ï¼‰

```python
# åˆ›å»ºä¸¤ä¸ª Dog å¯¹è±¡
dog1 = Dog("æ—ºè´¢", "é‡‘æ¯›")      # è°ƒç”¨ __init__ï¼Œä¼ å…¥ name å’Œ breed
dog2 = Dog("å°ç™½", "æŸ¯åŸº")

# è®¿é—®å±æ€§
print(dog1.name)     # æ—ºè´¢
print(dog2.breed)    # æŸ¯åŸº

# è°ƒç”¨æ–¹æ³•
dog1.sit()                      # æ—ºè´¢ åä¸‹äº† ğŸ•
dog1.learn_trick("æ¡æ‰‹")         # æ—ºè´¢ å­¦ä¼šäº†: æ¡æ‰‹!
dog1.learn_trick("ç¿»æ»š")         # æ—ºè´¢ å­¦ä¼šäº†: ç¿»æ»š!
dog1.show_tricks()              # æ—ºè´¢ çš„æŠ€èƒ½: æ¡æ‰‹, ç¿»æ»š

dog2.show_tricks()              # å°ç™½ è¿˜æ²¡å­¦ä¼šä»»ä½•æŠ€èƒ½
# dog1 å’Œ dog2 æ˜¯ç‹¬ç«‹çš„ï¼Œäº’ä¸å½±å“ï¼
```

#### 2.3 self æ˜¯ä»€ä¹ˆï¼Ÿ

`self` æ˜¯å¯¹è±¡è‡ªèº«çš„å¼•ç”¨ã€‚æ¯ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ `self`ï¼Œä½†è°ƒç”¨æ—¶ä¸éœ€è¦æ‰‹åŠ¨ä¼ ã€‚

```python
class Counter:
    def __init__(self):
        self.count = 0    # self.count æ˜¯è¿™ä¸ªå¯¹è±¡è‡ªå·±çš„ count

    def increment(self):
        self.count += 1   # ä¿®æ”¹è‡ªå·±çš„ count

# ä¸¤ä¸ªç‹¬ç«‹çš„è®¡æ•°å™¨
c1 = Counter()
c2 = Counter()

c1.increment()
c1.increment()
c1.increment()

print(c1.count)   # 3
print(c2.count)   # 0ï¼ˆc2 æ²¡æœ‰è¢«æ“ä½œè¿‡ï¼‰
```

**é€šä¿—ç†è§£ selfï¼š** å½“ä½ è¯´ `c1.increment()` æ—¶ï¼ŒPython å®é™…ä¸Šæ‰§è¡Œçš„æ˜¯ `Counter.increment(c1)`ã€‚`self` å°±æ˜¯ `c1`ï¼Œå‘Šè¯‰æ–¹æ³•"ä½ åœ¨æ“ä½œå“ªä¸ªå¯¹è±¡"ã€‚

---

### 3. å±æ€§å’Œæ–¹æ³•

#### 3.1 å®ä¾‹å±æ€§ vs ç±»å±æ€§

```python
class Image:
    # ç±»å±æ€§ï¼šæ‰€æœ‰å®ä¾‹å…±äº«ï¼ˆåƒæ˜¯å…¨ç­åŒå­¦å…±ç”¨ä¸€å—é»‘æ¿ï¼‰
    supported_formats = ["jpg", "png", "bmp"]
    instance_count = 0

    def __init__(self, name, width, height):
        # å®ä¾‹å±æ€§ï¼šæ¯ä¸ªå®ä¾‹ç‹¬æœ‰ï¼ˆåƒæ˜¯æ¯ä¸ªåŒå­¦è‡ªå·±çš„è¯¾æœ¬ï¼‰
        self.name = name
        self.width = width
        self.height = height
        Image.instance_count += 1    # ä¿®æ”¹ç±»å±æ€§

# ç±»å±æ€§é€šè¿‡ç±»åæˆ–å®ä¾‹è®¿é—®
print(Image.supported_formats)    # ['jpg', 'png', 'bmp']

img1 = Image("a.jpg", 640, 480)
img2 = Image("b.png", 1920, 1080)

# æ¯ä¸ªå®ä¾‹æœ‰è‡ªå·±çš„å±æ€§
print(img1.name)   # a.jpg
print(img2.name)   # b.png

# ç±»å±æ€§è¢«æ‰€æœ‰å®ä¾‹å…±äº«
print(Image.instance_count)   # 2ï¼ˆåˆ›å»ºäº†ä¸¤ä¸ªå®ä¾‹ï¼‰
print(img1.instance_count)    # 2ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡å®ä¾‹è®¿é—®ï¼‰
```

#### 3.2 æ–¹æ³•çš„ç±»å‹

```python
class ImageProcessor:
    version = "1.0"

    def __init__(self, name):
        self.name = name

    # å®ä¾‹æ–¹æ³•ï¼šæœ€å¸¸ç”¨ï¼Œæ“ä½œå®ä¾‹æ•°æ®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ self
    def process(self, image):
        print(f"{self.name} æ­£åœ¨å¤„ç† {image}")

    # ç±»æ–¹æ³•ï¼šæ“ä½œç±»æ•°æ®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ clsï¼ˆç±»æœ¬èº«ï¼‰
    @classmethod
    def get_version(cls):
        return cls.version

    # é™æ€æ–¹æ³•ï¼šä¸æ“ä½œå®ä¾‹æˆ–ç±»æ•°æ®ï¼Œåªæ˜¯é€»è¾‘ä¸Šå±äºè¿™ä¸ªç±»
    @staticmethod
    def is_valid_format(filename):
        valid = (".jpg", ".png", ".bmp")
        return filename.lower().endswith(valid)

# å®ä¾‹æ–¹æ³•ï¼šéœ€è¦åˆ›å»ºå¯¹è±¡
proc = ImageProcessor("å¢å¼ºå™¨")
proc.process("photo.jpg")              # å¢å¼ºå™¨ æ­£åœ¨å¤„ç† photo.jpg

# ç±»æ–¹æ³•ï¼šå¯ä»¥ç›´æ¥é€šè¿‡ç±»åè°ƒç”¨
print(ImageProcessor.get_version())    # 1.0

# é™æ€æ–¹æ³•ï¼šå¯ä»¥é€šè¿‡ç±»åæˆ–å®ä¾‹è°ƒç”¨
print(ImageProcessor.is_valid_format("test.jpg"))   # True
print(ImageProcessor.is_valid_format("test.txt"))   # False
```

> ğŸ’¡ **ä»€ä¹ˆæ—¶å€™ç”¨å“ªç§æ–¹æ³•ï¼Ÿ**
> - **å®ä¾‹æ–¹æ³•**ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼šéœ€è¦è®¿é—®æˆ–ä¿®æ”¹å®ä¾‹æ•°æ®æ—¶
> - **ç±»æ–¹æ³•**ï¼šéœ€è¦è®¿é—®æˆ–ä¿®æ”¹ç±»æ•°æ®æ—¶ï¼Œæˆ–ä½œä¸ºæ›¿ä»£æ„é€ å‡½æ•°
> - **é™æ€æ–¹æ³•**ï¼šé€»è¾‘ä¸Šå±äºè¿™ä¸ªç±»ï¼Œä½†ä¸éœ€è¦è®¿é—®å®ä¾‹æˆ–ç±»æ•°æ®

---

### 4. ä¸‰å¤§ç‰¹æ€§

é¢å‘å¯¹è±¡æœ‰ä¸‰ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚

#### 4.1 å°è£…

**å°è£…** = æŠŠæ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ç»‘å®šåœ¨ä¸€èµ·ï¼Œéšè—å†…éƒ¨ç»†èŠ‚ï¼Œåªæš´éœ²å¿…è¦çš„æ¥å£ã€‚

```python
class BoundingBox:
    """æ£€æµ‹æ¡†ç±»ï¼šå°è£…åæ ‡å’Œç›¸å…³æ“ä½œ"""

    def __init__(self, x, y, width, height):
        # ç”¨ä¸‹åˆ’çº¿å‰ç¼€è¡¨ç¤º"è¿™æ˜¯å†…éƒ¨æ•°æ®ï¼Œå¤–éƒ¨ä¸åº”è¯¥ç›´æ¥è®¿é—®"
        self._x = x
        self._y = y
        self._width = width
        self._height = height

    # æä¾›å®‰å…¨çš„è®¿é—®æ–¹å¼ï¼ˆåªè¯»å±æ€§ï¼‰
    @property
    def area(self):
        """é¢ç§¯ï¼ˆåªè¯»ï¼‰"""
        return self._width * self._height

    @property
    def center(self):
        """ä¸­å¿ƒç‚¹åæ ‡ï¼ˆåªè¯»ï¼‰"""
        cx = self._x + self._width // 2
        cy = self._y + self._height // 2
        return (cx, cy)

    def contains_point(self, px, py):
        """åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨æ¡†å†…"""
        return (self._x <= px <= self._x + self._width and
                self._y <= py <= self._y + self._height)

    def __str__(self):
        return f"BBox({self._x}, {self._y}, {self._width}x{self._height})"

# ä½¿ç”¨
box = BoundingBox(100, 50, 200, 150)
print(box)                          # BBox(100, 50, 200x150)
print(f"é¢ç§¯: {box.area}")          # é¢ç§¯: 30000
print(f"ä¸­å¿ƒ: {box.center}")        # ä¸­å¿ƒ: (200, 125)
print(box.contains_point(150, 100)) # True
print(box.contains_point(500, 500)) # False

# ç”¨ @property å®šä¹‰çš„å±æ€§åƒæ™®é€šå±æ€§ä¸€æ ·è®¿é—®ï¼Œä½†æ˜¯åªè¯»çš„
# box.area = 999    # âŒ AttributeError: ä¸èƒ½ç›´æ¥ä¿®æ”¹
```

> ğŸ’¡ **Python çš„å°è£…çº¦å®šï¼š**
> - `_name`ï¼šå•ä¸‹åˆ’çº¿å‰ç¼€ â†’ "å»ºè®®ä¸è¦ä»å¤–éƒ¨ç›´æ¥è®¿é—®"ï¼ˆçº¦å®šä¿—æˆï¼Œä¸å¼ºåˆ¶ï¼‰
> - `__name`ï¼šåŒä¸‹åˆ’çº¿å‰ç¼€ â†’ Python ä¼šåšåç§°æ”¹å†™ï¼Œæ›´éš¾ä»å¤–éƒ¨è®¿é—®
> - ä¸åƒ Java/C++ æœ‰ private/public å…³é”®å­—ï¼ŒPython é è‡ªè§‰å’Œçº¦å®š

#### 4.2 ç»§æ‰¿

**ç»§æ‰¿** = å­ç±»ï¼ˆæ´¾ç”Ÿç±»ï¼‰è·å¾—çˆ¶ç±»ï¼ˆåŸºç±»ï¼‰çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè¿˜å¯ä»¥æ·»åŠ æ–°çš„æˆ–ä¿®æ”¹åŸæœ‰çš„ã€‚

```python
# çˆ¶ç±»ï¼ˆåŸºç±»ï¼‰
class Filter:
    """å›¾åƒæ»¤æ³¢å™¨åŸºç±»"""

    def __init__(self, name):
        self.name = name

    def apply(self, image_data):
        """åº”ç”¨æ»¤æ³¢ï¼ˆå­ç±»å¿…é¡»é‡å†™ï¼‰"""
        raise NotImplementedError("å­ç±»å¿…é¡»å®ç° apply æ–¹æ³•")

    def info(self):
        print(f"æ»¤æ³¢å™¨: {self.name}")

# å­ç±»1ï¼šç»§æ‰¿ Filter
class BlurFilter(Filter):
    """æ¨¡ç³Šæ»¤æ³¢å™¨"""

    def __init__(self, kernel_size=3):
        super().__init__("æ¨¡ç³Šæ»¤æ³¢")    # è°ƒç”¨çˆ¶ç±»çš„ __init__
        self.kernel_size = kernel_size  # å­ç±»çš„æ–°å±æ€§

    def apply(self, image_data):
        """é‡å†™çˆ¶ç±»æ–¹æ³•ï¼šå®ç°æ¨¡ç³Š"""
        print(f"  å¯¹å›¾åƒåº”ç”¨ {self.kernel_size}x{self.kernel_size} æ¨¡ç³Š")
        # ç®€åŒ–æ¨¡æ‹Ÿï¼šå–ç›¸é‚»å€¼çš„å¹³å‡
        result = []
        for i in range(len(image_data)):
            start = max(0, i - 1)
            end = min(len(image_data), i + 2)
            avg = sum(image_data[start:end]) / (end - start)
            result.append(int(avg))
        return result

# å­ç±»2ï¼šç»§æ‰¿ Filter
class ThresholdFilter(Filter):
    """é˜ˆå€¼æ»¤æ³¢å™¨"""

    def __init__(self, threshold=128):
        super().__init__("é˜ˆå€¼å¤„ç†")
        self.threshold = threshold

    def apply(self, image_data):
        """é‡å†™çˆ¶ç±»æ–¹æ³•ï¼šå®ç°é˜ˆå€¼å¤„ç†"""
        print(f"  å¯¹å›¾åƒåº”ç”¨é˜ˆå€¼={self.threshold}")
        return [255 if p > self.threshold else 0 for p in image_data]

# ä½¿ç”¨
pixels = [100, 150, 200, 50, 180, 30, 220]

blur = BlurFilter(kernel_size=3)
blur.info()                          # æ»¤æ³¢å™¨: æ¨¡ç³Šæ»¤æ³¢ï¼ˆç»§æ‰¿è‡ª Filterï¼‰
result1 = blur.apply(pixels)
print(f"  æ¨¡ç³Šç»“æœ: {result1}")

print()

thresh = ThresholdFilter(threshold=100)
thresh.info()                        # æ»¤æ³¢å™¨: é˜ˆå€¼å¤„ç†ï¼ˆç»§æ‰¿è‡ª Filterï¼‰
result2 = thresh.apply(pixels)
print(f"  é˜ˆå€¼ç»“æœ: {result2}")
```

**ç»§æ‰¿çš„å…³é”®ç‚¹ï¼š**

```python
# super() è°ƒç”¨çˆ¶ç±»æ–¹æ³•
class Child(Parent):
    def __init__(self, ...):
        super().__init__(...)    # å…ˆè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
        # å†åˆå§‹åŒ–å­ç±»è‡ªå·±çš„å±æ€§

# æ£€æŸ¥ç»§æ‰¿å…³ç³»
print(isinstance(blur, BlurFilter))   # True
print(isinstance(blur, Filter))       # Trueï¼ˆBlurFilter æ˜¯ Filter çš„å­ç±»ï¼‰
print(isinstance(blur, ThresholdFilter))  # False

# æ£€æŸ¥ç±»ç»§æ‰¿é“¾
print(issubclass(BlurFilter, Filter))   # True
```

#### 4.3 å¤šæ€

**å¤šæ€** = åŒä¸€ä¸ªæ¥å£ï¼Œä¸åŒçš„å®ç°ã€‚è°ƒç”¨è€…ä¸éœ€è¦å…³å¿ƒå…·ä½“æ˜¯å“ªä¸ªç±»ï¼Œåªè¦å®ƒå®ç°äº†éœ€è¦çš„æ–¹æ³•å³å¯ã€‚

```python
def process_image(filter_obj, pixels):
    """å¤„ç†å›¾åƒâ€”â€”ä¸å…³å¿ƒå…·ä½“æ˜¯å“ªç§æ»¤æ³¢å™¨"""
    filter_obj.info()
    result = filter_obj.apply(pixels)
    print(f"  å¤„ç†ç»“æœ: {result}\n")
    return result

pixels = [100, 150, 200, 50, 180]

# ä¼ å…¥ä¸åŒçš„æ»¤æ³¢å™¨ï¼ŒåŒæ ·çš„æ¥å£ï¼Œä¸åŒçš„è¡Œä¸º
filters = [
    BlurFilter(3),
    ThresholdFilter(128),
]

for f in filters:
    process_image(f, pixels)
# è™½ç„¶ f æœ‰æ—¶æ˜¯ BlurFilterï¼Œæœ‰æ—¶æ˜¯ ThresholdFilterï¼Œ
# ä½† process_image å®Œå…¨ä¸éœ€è¦çŸ¥é“â€”â€”è¿™å°±æ˜¯å¤šæ€ï¼
```

> ğŸ’¡ **å¤šæ€çš„å¥½å¤„ï¼š** æ–°å¢ä¸€ç§æ»¤æ³¢å™¨æ—¶ï¼Œåªéœ€è¦å†™ä¸€ä¸ªæ–°çš„å­ç±»ï¼Œä¸éœ€è¦ä¿®æ”¹ `process_image` å‡½æ•°ã€‚è¿™å°±æ˜¯"å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­"çš„**å¼€é—­åŸåˆ™**ã€‚

---

### 5. å¸¸ç”¨é­”æœ¯æ–¹æ³•

Python çš„ç±»æœ‰ä¸€äº›ç‰¹æ®Šæ–¹æ³•ï¼ˆä»¥åŒä¸‹åˆ’çº¿å¼€å¤´å’Œç»“å°¾ï¼‰ï¼Œè®©ä½ çš„å¯¹è±¡å¯ä»¥åƒå†…ç½®ç±»å‹ä¸€æ ·ä½¿ç”¨ã€‚

```python
class Point:
    """äºŒç»´ç‚¹ï¼šå±•ç¤ºå¸¸ç”¨é­”æœ¯æ–¹æ³•"""

    def __init__(self, x, y):
        self.x = x
        self.y = y

    def __str__(self):
        """print() æ—¶æ˜¾ç¤ºçš„å†…å®¹"""
        return f"Point({self.x}, {self.y})"

    def __repr__(self):
        """è°ƒè¯•æ—¶æ˜¾ç¤ºçš„å†…å®¹ï¼ˆæ›´è¯¦ç»†ï¼‰"""
        return f"Point(x={self.x}, y={self.y})"

    def __eq__(self, other):
        """== è¿ç®—ç¬¦"""
        return self.x == other.x and self.y == other.y

    def __add__(self, other):
        """+ è¿ç®—ç¬¦"""
        return Point(self.x + other.x, self.y + other.y)

    def __len__(self):
        """len() å‡½æ•°ï¼ˆè¿™é‡Œè¿”å›åˆ°åŸç‚¹çš„æ›¼å“ˆé¡¿è·ç¦»ï¼‰"""
        return abs(self.x) + abs(self.y)

    def __getitem__(self, index):
        """æ”¯æŒç´¢å¼•è®¿é—® p[0], p[1]"""
        if index == 0:
            return self.x
        elif index == 1:
            return self.y
        else:
            raise IndexError("Point åªæœ‰ x(0) å’Œ y(1)")

# ä½¿ç”¨
p1 = Point(100, 200)
p2 = Point(50, 80)

print(p1)              # Point(100, 200)    â†’ è°ƒç”¨ __str__
print(p1 == p2)        # False              â†’ è°ƒç”¨ __eq__
print(p1 + p2)         # Point(150, 280)    â†’ è°ƒç”¨ __add__
print(len(p1))         # 300                â†’ è°ƒç”¨ __len__
print(p1[0], p1[1])    # 100 200            â†’ è°ƒç”¨ __getitem__
```

**å¸¸ç”¨é­”æœ¯æ–¹æ³•é€ŸæŸ¥è¡¨ï¼š**

| æ–¹æ³• | è§¦å‘æ–¹å¼ | ç”¨é€” |
|------|----------|------|
| `__init__(self, ...)` | `ClassName(...)` | åˆå§‹åŒ–å¯¹è±¡ |
| `__str__(self)` | `print(obj)`, `str(obj)` | å‹å¥½çš„å­—ç¬¦ä¸²è¡¨ç¤º |
| `__repr__(self)` | åœ¨äº¤äº’ç¯å¢ƒç›´æ¥è¾“å…¥ `obj` | è°ƒè¯•ç”¨çš„å­—ç¬¦ä¸²è¡¨ç¤º |
| `__len__(self)` | `len(obj)` | è¿”å›é•¿åº¦ |
| `__getitem__(self, key)` | `obj[key]` | ç´¢å¼•è®¿é—® |
| `__setitem__(self, key, val)` | `obj[key] = val` | ç´¢å¼•èµ‹å€¼ |
| `__eq__(self, other)` | `obj == other` | ç›¸ç­‰æ¯”è¾ƒ |
| `__lt__(self, other)` | `obj < other` | å°äºæ¯”è¾ƒ |
| `__add__(self, other)` | `obj + other` | åŠ æ³•è¿ç®— |
| `__contains__(self, item)` | `item in obj` | æˆå‘˜åˆ¤æ–­ |
| `__iter__(self)` | `for x in obj` | è¿­ä»£æ”¯æŒ |
| `__call__(self, ...)` | `obj(...)` | åƒå‡½æ•°ä¸€æ ·è°ƒç”¨å¯¹è±¡ |

---

### 6. å®é™…åº”ç”¨ï¼šåœ¨ CV é¡¹ç›®ä¸­ä½¿ç”¨ OOP

è®¡ç®—æœºè§†è§‰é¡¹ç›®ä¸­ OOP çš„å…¸å‹åº”ç”¨æ¨¡å¼ï¼š

```python
# æ¨¡å¼1ï¼šæ•°æ®å°è£…
class Detection:
    """å°è£…ä¸€ä¸ªæ£€æµ‹ç»“æœ"""
    def __init__(self, class_name, confidence, bbox):
        self.class_name = class_name
        self.confidence = confidence
        self.bbox = bbox    # (x, y, w, h)

    @property
    def area(self):
        return self.bbox[2] * self.bbox[3]

    def __str__(self):
        return f"{self.class_name} ({self.confidence:.0%})"

# æ¨¡å¼2ï¼šå¤„ç†å™¨åŸºç±» + å­ç±»æ‰©å±•
class BaseDetector:
    """æ£€æµ‹å™¨åŸºç±»"""
    def __init__(self, model_name, confidence_threshold=0.5):
        self.model_name = model_name
        self.threshold = confidence_threshold

    def detect(self, image):
        raise NotImplementedError

    def filter_results(self, detections):
        return [d for d in detections if d.confidence >= self.threshold]

# æ¨¡å¼3ï¼šé…ç½®ç®¡ç†
class Config:
    """é¡¹ç›®é…ç½®ç±»"""
    def __init__(self, **kwargs):
        self.width = kwargs.get("width", 640)
        self.height = kwargs.get("height", 480)
        self.fps = kwargs.get("fps", 30)
        self.model = kwargs.get("model", "yolov5s")

    def __str__(self):
        attrs = vars(self)  # è·å–æ‰€æœ‰å±æ€§çš„å­—å…¸
        return "\n".join(f"  {k}: {v}" for k, v in attrs.items())
```

---

## ğŸ’» ä»£ç å®æˆ˜

### å®æˆ˜ç»ƒä¹ ï¼šå›¾åƒå¤„ç†æµæ°´çº¿

è¿è¡Œ `code/oop.py` æŸ¥çœ‹å®Œæ•´ç¤ºä¾‹ã€‚

```python
# ===================================================================
# å®æˆ˜ç»ƒä¹ ï¼šå›¾åƒå¤„ç†æµæ°´çº¿ï¼ˆé¢å‘å¯¹è±¡ç‰ˆï¼‰
# ç›®æ ‡ï¼šç»¼åˆè¿ç”¨ç±»ã€ç»§æ‰¿ã€å¤šæ€ã€é­”æœ¯æ–¹æ³•
# ===================================================================

# ---------- 1. åŸºç¡€ç±»ï¼šå›¾åƒä¿¡æ¯ ----------
print("=" * 50)
print("ğŸ“¸ é¢å‘å¯¹è±¡å®æˆ˜ï¼šå›¾åƒå¤„ç†æµæ°´çº¿")
print("=" * 50)

class ImageInfo:
    """å›¾åƒä¿¡æ¯å°è£…ç±»"""
    total_created = 0    # ç±»å±æ€§ï¼šç»Ÿè®¡åˆ›å»ºäº†å¤šå°‘ä¸ªå®ä¾‹

    def __init__(self, name, width, height, channels=3):
        self.name = name
        self.width = width
        self.height = height
        self.channels = channels
        ImageInfo.total_created += 1

    @property
    def pixel_count(self):
        return self.width * self.height

    @property
    def size_mb(self):
        return self.width * self.height * self.channels / (1024 * 1024)

    @property
    def aspect_ratio(self):
        from math import gcd
        g = gcd(self.width, self.height)
        return f"{self.width // g}:{self.height // g}"

    def __str__(self):
        return (f"{self.name} | {self.width}x{self.height} | "
                f"{self.channels}ch | {self.size_mb:.1f}MB")

    def __repr__(self):
        return f"ImageInfo('{self.name}', {self.width}, {self.height}, {self.channels})"

    def __eq__(self, other):
        return (self.width == other.width and
                self.height == other.height and
                self.channels == other.channels)

# åˆ›å»ºå›¾åƒå¯¹è±¡
images = [
    ImageInfo("é£æ™¯.jpg", 1920, 1080),
    ImageInfo("äººåƒ.png", 1080, 1920),
    ImageInfo("ç¼©ç•¥å›¾.jpg", 640, 480),
    ImageInfo("4Kå£çº¸.jpg", 3840, 2160),
]

print("\nğŸ“‹ å›¾åƒåˆ—è¡¨:")
for img in images:
    print(f"  {img}")
    print(f"     åƒç´ : {img.pixel_count:,} | æ¯”ä¾‹: {img.aspect_ratio}")

print(f"\næ€»å…±åˆ›å»ºäº† {ImageInfo.total_created} ä¸ªå›¾åƒå¯¹è±¡")

# æ¯”è¾ƒä¸¤å¼ å›¾
img_a = ImageInfo("a.jpg", 1920, 1080)
img_b = ImageInfo("b.png", 1920, 1080)
print(f"\na.jpg å’Œ b.png å°ºå¯¸ç›¸åŒ? {img_a == img_b}")  # True

# ---------- 2. ç»§æ‰¿ï¼šæ»¤æ³¢å™¨ä½“ç³» ----------
print("\n" + "=" * 50)
print("ğŸ”§ æ»¤æ³¢å™¨ä½“ç³»ï¼ˆç»§æ‰¿ + å¤šæ€ï¼‰")
print("=" * 50)

class Filter:
    """æ»¤æ³¢å™¨åŸºç±»"""
    def __init__(self, name):
        self.name = name

    def apply(self, pixels):
        raise NotImplementedError

    def __str__(self):
        return f"[{self.name}]"

class NormalizeFilter(Filter):
    """å½’ä¸€åŒ–æ»¤æ³¢å™¨"""
    def __init__(self, max_val=255):
        super().__init__("å½’ä¸€åŒ–")
        self.max_val = max_val

    def apply(self, pixels):
        return [round(p / self.max_val, 3) for p in pixels]

class ClampFilter(Filter):
    """è£å‰ªæ»¤æ³¢å™¨"""
    def __init__(self, low=0, high=255):
        super().__init__(f"è£å‰ª[{low},{high}]")
        self.low = low
        self.high = high

    def apply(self, pixels):
        return [max(self.low, min(self.high, p)) for p in pixels]

class InvertFilter(Filter):
    """åè‰²æ»¤æ³¢å™¨"""
    def __init__(self, max_val=255):
        super().__init__("åè‰²")
        self.max_val = max_val

    def apply(self, pixels):
        return [self.max_val - p for p in pixels]

class Pipeline:
    """æ»¤æ³¢å™¨æµæ°´çº¿ï¼šæŒ‰é¡ºåºåº”ç”¨å¤šä¸ªæ»¤æ³¢å™¨"""

    def __init__(self, *filters):
        self.filters = list(filters)

    def add(self, filter_obj):
        self.filters.append(filter_obj)
        return self    # è¿”å› self æ”¯æŒé“¾å¼è°ƒç”¨

    def process(self, pixels):
        result = pixels[:]  # å¤åˆ¶ï¼Œä¸ä¿®æ”¹åŸæ•°æ®
        print(f"  è¾“å…¥:  {result}")
        for f in self.filters:
            result = f.apply(result)
            print(f"  {f} â†’ {result}")
        return result

# æ„å»ºæµæ°´çº¿
print("\nå¤„ç†æµæ°´çº¿:")
pipe = Pipeline()
pipe.add(ClampFilter(50, 200)).add(InvertFilter(255)).add(NormalizeFilter(255))

raw_pixels = [300, 180, 20, 128, 255, 0, 90]
output = pipe.process(raw_pixels)

# ---------- 3. å®ç”¨ç±»ï¼šæ£€æµ‹ç»“æœç®¡ç† ----------
print("\n" + "=" * 50)
print("ğŸ¯ æ£€æµ‹ç»“æœç®¡ç†å™¨")
print("=" * 50)

class Detection:
    """å•ä¸ªæ£€æµ‹ç»“æœ"""
    def __init__(self, class_name, confidence, x, y, w, h):
        self.class_name = class_name
        self.confidence = confidence
        self.x = x
        self.y = y
        self.w = w
        self.h = h

    @property
    def area(self):
        return self.w * self.h

    @property
    def center(self):
        return (self.x + self.w // 2, self.y + self.h // 2)

    def __str__(self):
        return f"{self.class_name} {self.confidence:.0%} @({self.x},{self.y})"

    def __lt__(self, other):
        """æ”¯æŒæŒ‰ç½®ä¿¡åº¦æ’åº"""
        return self.confidence < other.confidence

class DetectionResult:
    """æ£€æµ‹ç»“æœé›†åˆ"""
    def __init__(self, image_name):
        self.image_name = image_name
        self._detections = []

    def add(self, detection):
        self._detections.append(detection)

    def __len__(self):
        return len(self._detections)

    def __getitem__(self, index):
        return self._detections[index]

    def __iter__(self):
        return iter(self._detections)

    def filter_by_confidence(self, min_conf):
        return [d for d in self._detections if d.confidence >= min_conf]

    def filter_by_class(self, class_name):
        return [d for d in self._detections if d.class_name == class_name]

    def summary(self):
        print(f"\nğŸ“Š æ£€æµ‹æŠ¥å‘Š: {self.image_name}")
        print(f"   æ€»ç›®æ ‡æ•°: {len(self)}")

        # ç»Ÿè®¡å„ç±»åˆ«
        from collections import Counter
        class_counts = Counter(d.class_name for d in self)
        for cls, count in class_counts.most_common():
            print(f"   - {cls}: {count} ä¸ª")

        # æœ€é«˜ç½®ä¿¡åº¦
        if self._detections:
            best = max(self._detections)  # åˆ©ç”¨ __lt__ æ¯”è¾ƒ
            print(f"   æœ€é«˜ç½®ä¿¡åº¦: {best}")

# åˆ›å»ºæ£€æµ‹ç»“æœ
result = DetectionResult("street_scene.jpg")
result.add(Detection("person", 0.95, 100, 50, 80, 200))
result.add(Detection("car",    0.88, 300, 200, 150, 100))
result.add(Detection("person", 0.72, 500, 80, 60, 180))
result.add(Detection("dog",    0.65, 400, 350, 50, 40))
result.add(Detection("car",    0.91, 50, 180, 200, 120))

# å±•ç¤ºç»“æœ
result.summary()

# ä½¿ç”¨é­”æœ¯æ–¹æ³•
print(f"\nä½¿ç”¨ len(): {len(result)} ä¸ªç›®æ ‡")
print(f"ä½¿ç”¨ç´¢å¼•: result[0] = {result[0]}")
print(f"ä½¿ç”¨ for éå†:")
for det in result:
    print(f"  {det} | é¢ç§¯={det.area:,} | ä¸­å¿ƒ={det.center}")

# ç­›é€‰
print(f"\né«˜ç½®ä¿¡åº¦ (>80%):")
for det in result.filter_by_confidence(0.8):
    print(f"  {det}")

print(f"\næ‰€æœ‰è¡Œäºº:")
for det in result.filter_by_class("person"):
    print(f"  {det}")

# æ’åºï¼ˆåˆ©ç”¨ __lt__ï¼‰
sorted_dets = sorted(result, reverse=True)
print(f"\næŒ‰ç½®ä¿¡åº¦æ’åº:")
for det in sorted_dets:
    print(f"  {det}")
```

---

## ğŸš¨ å¸¸è§é—®é¢˜ä¸æ˜“é”™ç‚¹

### Q1: ä»€ä¹ˆæ—¶å€™è¯¥ç”¨ç±»ï¼Œä»€ä¹ˆæ—¶å€™ç”¨å‡½æ•°å°±å¤Ÿäº†ï¼Ÿ

**ç®€å•åˆ¤æ–­æ ‡å‡†ï¼š**
- **ç”¨å‡½æ•°**ï¼šåªæ˜¯ä¸€ä¸ªæ“ä½œï¼Œä¸éœ€è¦ç»´æŠ¤çŠ¶æ€ï¼ˆå¦‚ `normalize_pixel(value)`ï¼‰
- **ç”¨ç±»**ï¼šéœ€è¦æŠŠæ•°æ®å’Œç›¸å…³æ“ä½œç»‘åœ¨ä¸€èµ·ï¼Œæˆ–éœ€è¦ç»´æŠ¤çŠ¶æ€ï¼ˆå¦‚ `Detection` å¯¹è±¡ï¼‰

> ğŸ’¡ ä¸è¦ä¸ºäº†é¢å‘å¯¹è±¡è€Œé¢å‘å¯¹è±¡ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°å°±èƒ½è§£å†³é—®é¢˜ï¼Œå°±ä¸éœ€è¦å†™ä¸€ä¸ªç±»ã€‚

### Q2: å¿˜äº†å†™ self æ€ä¹ˆåŠï¼Ÿ

```python
class MyClass:
    def __init__(self, value):
        self.value = value

    # âŒ å¿˜äº† self
    def show():           # TypeError: show() ä¸æ¥å—å‚æ•°
        print(value)      # NameError: value æœªå®šä¹‰

    # âœ… æ­£ç¡®
    def show(self):
        print(self.value)
```

### Q3: super().__init__() ä»€ä¹ˆæ—¶å€™å¿…é¡»è°ƒç”¨ï¼Ÿ

å½“å­ç±»çš„ `__init__` éœ€è¦ç”¨åˆ°çˆ¶ç±»åˆå§‹åŒ–çš„å±æ€§æ—¶ï¼Œ**å¿…é¡»è°ƒç”¨** `super().__init__()`ã€‚

```python
class Parent:
    def __init__(self, name):
        self.name = name

class Child(Parent):
    def __init__(self, name, age):
        # âŒ å¿˜äº†è°ƒç”¨ super()
        self.age = age
        # print(self.name)  # AttributeError: æ²¡æœ‰ name å±æ€§ï¼

    def __init__(self, name, age):
        # âœ… æ­£ç¡®
        super().__init__(name)   # å…ˆåˆå§‹åŒ–çˆ¶ç±»
        self.age = age           # å†åˆå§‹åŒ–å­ç±»
```

### Q4: @property æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

`@property` è®©æ–¹æ³•å¯ä»¥åƒå±æ€§ä¸€æ ·è®¿é—®ï¼Œä¸ç”¨åŠ æ‹¬å·ã€‚é€‚åˆé‚£äº›"çœ‹èµ·æ¥æ˜¯å±æ€§ï¼Œä½†éœ€è¦è®¡ç®—"çš„åœºæ™¯ã€‚

```python
class Rectangle:
    def __init__(self, width, height):
        self.width = width
        self.height = height

    @property
    def area(self):
        return self.width * self.height

rect = Rectangle(10, 20)
print(rect.area)     # 200ï¼ˆåƒå±æ€§ä¸€æ ·è®¿é—®ï¼Œä¸ç”¨å†™ rect.area()ï¼‰
```

---

## ğŸ¯ æ€»ç»“

æœ¬èŠ‚å­¦ä¹ äº† Python é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼š

âœ… **ç±»å’Œå¯¹è±¡**ï¼šclass å®šä¹‰æ¨¡æ¿ï¼Œå®ä¾‹åŒ–åˆ›å»ºå¯¹è±¡
âœ… **self**ï¼šå¯¹è±¡è‡ªèº«çš„å¼•ç”¨ï¼Œæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°
âœ… **å±æ€§**ï¼šå®ä¾‹å±æ€§ï¼ˆæ¯ä¸ªå¯¹è±¡ç‹¬æœ‰ï¼‰vs ç±»å±æ€§ï¼ˆæ‰€æœ‰å¯¹è±¡å…±äº«ï¼‰
âœ… **æ–¹æ³•ç±»å‹**ï¼šå®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•ï¼ˆ@classmethodï¼‰ã€é™æ€æ–¹æ³•ï¼ˆ@staticmethodï¼‰
âœ… **å°è£…**ï¼šç”¨ `_` å‰ç¼€çº¦å®šç§æœ‰ï¼Œ`@property` æä¾›å®‰å…¨è®¿é—®
âœ… **ç»§æ‰¿**ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œ`super()` è°ƒç”¨çˆ¶ç±»æ–¹æ³•
âœ… **å¤šæ€**ï¼šåŒä¸€æ¥å£ï¼Œä¸åŒå®ç°ï¼Œçµæ´»æ‰©å±•
âœ… **é­”æœ¯æ–¹æ³•**ï¼š`__str__`ã€`__len__`ã€`__getitem__`ã€`__eq__` ç­‰

> ğŸ”‘ **æ ¸å¿ƒè¦ç‚¹ï¼š** åœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼ŒOOP ç”¨äºå°è£…æ£€æµ‹ç»“æœï¼ˆDetection ç±»ï¼‰ã€æ„å»ºå¤„ç†æµæ°´çº¿ï¼ˆPipeline æ¨¡å¼ï¼‰ã€è®¾è®¡å¯æ‰©å±•çš„æ¨¡å‹æ¶æ„ï¼ˆåŸºç±» + å­ç±»ï¼‰ã€‚OpenCV å’Œ PyTorch éƒ½å¤§é‡ä½¿ç”¨äº†é¢å‘å¯¹è±¡è®¾è®¡ã€‚

**ä¸‹ä¸€æ­¥ï¼š**
ğŸ‘‰ [05 - æ–‡ä»¶æ“ä½œ](../05-æ–‡ä»¶æ“ä½œ/æ–‡ä»¶æ“ä½œ.md)

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Python ç±»æ–‡æ¡£](https://docs.python.org/zh-cn/3/tutorial/classes.html)
- [Python æ•°æ®æ¨¡å‹ï¼ˆé­”æœ¯æ–¹æ³•ï¼‰](https://docs.python.org/zh-cn/3/reference/datamodel.html)
- [Real Python: OOP æ•™ç¨‹](https://realpython.com/python3-object-oriented-programming/)
