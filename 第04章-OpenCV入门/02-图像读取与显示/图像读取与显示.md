# å›¾åƒè¯»å–ä¸æ˜¾ç¤º

> è¯»å–å’Œæ˜¾ç¤ºå›¾åƒæ˜¯ OpenCV æœ€åŸºæœ¬ã€ä¹Ÿæ˜¯ä½ æœ€å…ˆæ¥è§¦çš„æ“ä½œã€‚å°±åƒå­¦è‹±è¯­å…ˆå­¦"Hello"ï¼Œå­¦ OpenCV å…ˆå­¦ `imread` å’Œ `imshow`ã€‚æŒæ¡äº†è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œä½ å°±è¿ˆå‡ºäº†è®¡ç®—æœºè§†è§‰çš„ç¬¬ä¸€æ­¥ã€‚

---

## ğŸ“– ç†è®ºéƒ¨åˆ†

### 1. å›¾åƒè¯»å–ï¼šcv2.imread()

#### 1.1 åŸºæœ¬è¯­æ³•

```python
import cv2

# åŸºæœ¬ç”¨æ³•
img = cv2.imread("photo.jpg")

# å®Œæ•´è¯­æ³•
img = cv2.imread(filename, flags)
# filename: å›¾åƒæ–‡ä»¶è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰
# flags:    è¯»å–æ–¹å¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤å½©è‰²è¯»å–ï¼‰
# è¿”å›å€¼:   NumPy æ•°ç»„ï¼ˆè¯»å–å¤±è´¥è¿”å› Noneï¼‰
```

#### 1.2 è¯»å–æ ‡å¿—ï¼ˆflagsï¼‰

flags å‚æ•°å†³å®šäº†å›¾åƒä»¥ä»€ä¹ˆæ–¹å¼è¢«è¯»å…¥å†…å­˜ï¼š

| æ ‡å¿— | æ•°å€¼ | æ•ˆæœ | è¿”å› shape |
|------|------|------|-----------|
| `cv2.IMREAD_COLOR` | 1 | **å½©è‰²è¯»å–**ï¼ˆé»˜è®¤ï¼‰ï¼Œå¿½ç•¥é€æ˜é€šé“ | `(H, W, 3)` |
| `cv2.IMREAD_GRAYSCALE` | 0 | **ç°åº¦è¯»å–**ï¼Œæ— è®ºåŸå›¾æ˜¯å¦å½©è‰² | `(H, W)` |
| `cv2.IMREAD_UNCHANGED` | -1 | **åŸæ ·è¯»å–**ï¼Œä¿ç•™é€æ˜é€šé“ | `(H, W, 4)` æˆ–å…¶ä»– |

```python
import cv2

# è¯»å–ä¸ºå½©è‰²å›¾åƒï¼ˆé»˜è®¤ï¼‰
color = cv2.imread("photo.jpg")                      # BGR 3é€šé“
color = cv2.imread("photo.jpg", cv2.IMREAD_COLOR)    # ç­‰ä»·å†™æ³•
color = cv2.imread("photo.jpg", 1)                   # æ•°å€¼ç®€å†™

# è¯»å–ä¸ºç°åº¦å›¾åƒ
gray = cv2.imread("photo.jpg", cv2.IMREAD_GRAYSCALE) # å•é€šé“
gray = cv2.imread("photo.jpg", 0)                    # æ•°å€¼ç®€å†™

# è¯»å–å«é€æ˜é€šé“çš„ PNG
rgba = cv2.imread("logo.png", cv2.IMREAD_UNCHANGED)  # BGRA 4é€šé“
rgba = cv2.imread("logo.png", -1)                    # æ•°å€¼ç®€å†™
```

```
ä¸åŒè¯»å–æ¨¡å¼çš„å¯¹æ¯”ï¼š

åŸå§‹å›¾åƒ: photo.jpg (1920Ã—1080 å½©è‰²JPEG)

IMREAD_COLOR (é»˜è®¤):
  shape = (1080, 1920, 3)    dtype = uint8
  é€šé“: [B, G, R]
  å†…å­˜: 1080 Ã— 1920 Ã— 3 = 5.9 MB

IMREAD_GRAYSCALE:
  shape = (1080, 1920)       dtype = uint8
  é€šé“: æ— ï¼ˆå•å€¼ï¼‰
  å†…å­˜: 1080 Ã— 1920 Ã— 1 = 2.0 MBï¼ˆçœ 2/3 å†…å­˜ï¼ï¼‰

IMREAD_UNCHANGED:
  shape = (1080, 1920, 3)    dtype = uint8  (JPEG æ²¡æœ‰é€æ˜é€šé“)
  å¦‚æœæ˜¯ PNG é€æ˜å›¾: shape = (1080, 1920, 4)  å¤šäº† Alpha é€šé“
```

#### 1.3 è·¯å¾„æ³¨æ„äº‹é¡¹ï¼ˆé‡è¦ï¼ï¼‰

```python
# âœ… æ­£ç¡®çš„è·¯å¾„å†™æ³•

# æ–¹å¼1ï¼šæ­£æ–œæ ï¼ˆæ¨èï¼Œè·¨å¹³å°é€šç”¨ï¼‰
img = cv2.imread("D:/images/photo.jpg")

# æ–¹å¼2ï¼šåŒåæ–œæ ï¼ˆWindows ä¸“ç”¨ï¼‰
img = cv2.imread("D:\\images\\photo.jpg")

# æ–¹å¼3ï¼šåŸå§‹å­—ç¬¦ä¸²ï¼ˆWindows æ¨èï¼‰
img = cv2.imread(r"D:\images\photo.jpg")

# æ–¹å¼4ï¼šç›¸å¯¹è·¯å¾„
img = cv2.imread("./images/photo.jpg")       # å½“å‰ç›®å½•ä¸‹
img = cv2.imread("../data/photo.jpg")        # ä¸Šçº§ç›®å½•

# âŒ å¸¸è§é”™è¯¯
# img = cv2.imread("D:\images\photo.jpg")    # \i å’Œ \p å¯èƒ½è¢«å½“æˆè½¬ä¹‰ç¬¦ï¼
```

> âš ï¸ **ä¸­æ–‡è·¯å¾„é—®é¢˜ï¼š** OpenCV çš„ `imread` åœ¨æŸäº›ç³»ç»Ÿä¸Š**ä¸æ”¯æŒä¸­æ–‡è·¯å¾„**ï¼å¦‚æœè·¯å¾„å«ä¸­æ–‡å¯¼è‡´è¯»å–å¤±è´¥ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•è§£å†³ï¼š

```python
import cv2
import numpy as np

# æ–¹æ³•1ï¼šç”¨ NumPy è¯»å–å†è§£ç ï¼ˆæ¨èï¼ï¼‰
def imread_chinese(filepath, flags=cv2.IMREAD_COLOR):
    """æ”¯æŒä¸­æ–‡è·¯å¾„çš„å›¾åƒè¯»å–"""
    data = np.fromfile(filepath, dtype=np.uint8)
    img = cv2.imdecode(data, flags)
    return img

# ä½¿ç”¨
img = imread_chinese("D:/å›¾ç‰‡/ç…§ç‰‡.jpg")

# æ–¹æ³•2ï¼šå…ˆç”¨ os è¯»å–å­—èŠ‚
import os
def imread_safe(filepath, flags=cv2.IMREAD_COLOR):
    with open(filepath, 'rb') as f:
        data = np.frombuffer(f.read(), dtype=np.uint8)
    return cv2.imdecode(data, flags)
```

#### 1.4 è¯»å–å¤±è´¥çš„å¤„ç†ï¼ˆå¿…é¡»å…»æˆçš„ä¹ æƒ¯ï¼ï¼‰

`cv2.imread()` æœ€å¤§çš„å‘æ˜¯ï¼š**è¯»å–å¤±è´¥ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯é™é»˜è¿”å› None**ã€‚

```python
# âŒ å±é™©çš„å†™æ³•ï¼šä¸æ£€æŸ¥å°±ç›´æ¥ä½¿ç”¨
img = cv2.imread("not_exist.jpg")
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)  # æŠ¥é”™ï¼img æ˜¯ None

# âœ… å®‰å…¨çš„å†™æ³•ï¼šå…ˆæ£€æŸ¥å†ä½¿ç”¨
img = cv2.imread("photo.jpg")
if img is None:
    print("é”™è¯¯ï¼šæ— æ³•è¯»å–å›¾åƒï¼è¯·æ£€æŸ¥ï¼š")
    print("  1. æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®")
    print("  2. æ–‡ä»¶æ˜¯å¦å­˜åœ¨")
    print("  3. è·¯å¾„æ˜¯å¦åŒ…å«ä¸­æ–‡ï¼ˆå¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰")
    print("  4. æ–‡ä»¶æ˜¯å¦æŸå")
    exit()

# åˆ°è¿™é‡Œ img ä¸€å®šæ˜¯æœ‰æ•ˆçš„
print(f"æˆåŠŸè¯»å–ï¼Œå°ºå¯¸: {img.shape}")
```

> ğŸ’¡ **å…»æˆä¹ æƒ¯ï¼š** æ¯æ¬¡ `cv2.imread()` ä¹‹åéƒ½æ£€æŸ¥ `is None`ã€‚è¿™èƒ½å¸®ä½ é¿å… 90% çš„"è«åå…¶å¦™"çš„é”™è¯¯ã€‚

#### 1.5 æ”¯æŒçš„å›¾åƒæ ¼å¼

```
OpenCV æ”¯æŒçš„å¸¸è§å›¾åƒæ ¼å¼ï¼š

æ ¼å¼      æ‰©å±•å              ç‰¹ç‚¹
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
JPEG     .jpg .jpeg          æœ‰æŸå‹ç¼©ï¼Œæ–‡ä»¶å°ï¼Œä¸æ”¯æŒé€æ˜
PNG      .png                æ— æŸå‹ç¼©ï¼Œæ”¯æŒé€æ˜é€šé“
BMP      .bmp                æ— å‹ç¼©ï¼Œæ–‡ä»¶å¤§ï¼Œè¯»å†™å¿«
TIFF     .tif .tiff          æ”¯æŒå¤šé¡µã€é«˜ä½æ·±
WebP     .webp               ç°ä»£æ ¼å¼ï¼Œå‹ç¼©ç‡é«˜
PBM/PGM  .pbm .pgm .ppm     ç®€å•çš„æ–‡æœ¬/äºŒè¿›åˆ¶æ ¼å¼
```

---

### 2. å›¾åƒæ˜¾ç¤ºï¼šcv2.imshow()

#### 2.1 åŸºæœ¬ç”¨æ³•

```python
import cv2

img = cv2.imread("photo.jpg")
if img is None:
    exit()

# æ˜¾ç¤ºå›¾åƒ
cv2.imshow("Window Name", img)   # å‚æ•°1: çª—å£æ ‡é¢˜, å‚æ•°2: å›¾åƒæ•°ç»„

# ç­‰å¾…æŒ‰é”®ï¼ˆå¿…é¡»ï¼ï¼‰
key = cv2.waitKey(0)             # 0 = æ— é™ç­‰å¾…ï¼Œè¿”å›æŒ‰é”®çš„ ASCII ç 

# å…³é—­çª—å£
cv2.destroyAllWindows()          # å…³é—­æ‰€æœ‰ OpenCV çª—å£
```

#### 2.2 waitKey() è¯¦è§£

`cv2.waitKey()` æ˜¯ OpenCV çª—å£ç³»ç»Ÿçš„"å¿ƒè·³"ï¼Œæ²¡æœ‰å®ƒçª—å£å°±æ— æ³•æ­£å¸¸å·¥ä½œï¼š

```python
# waitKey(delay) çš„å‚æ•°å«ä¹‰ï¼š
# delay = 0:    æ— é™ç­‰å¾…ï¼Œç›´åˆ°ç”¨æˆ·æŒ‰ä¸‹ä»»æ„é”®
# delay > 0:    ç­‰å¾… delay æ¯«ç§’ï¼Œè¶…æ—¶è‡ªåŠ¨è¿”å› -1
# è¿”å›å€¼:       æŒ‰ä¸‹çš„é”®çš„ ASCII ç ï¼ˆæ²¡æŒ‰é”®è¿”å› -1ï¼‰

# ç”¨æ³•1ï¼šç­‰å¾…ç”¨æˆ·æŒ‰é”®å…³é—­
cv2.imshow("Photo", img)
cv2.waitKey(0)                   # æŒ‰ä»»æ„é”®ç»§ç»­
cv2.destroyAllWindows()

# ç”¨æ³•2ï¼šæ£€æµ‹ç‰¹å®šæŒ‰é”®
cv2.imshow("Photo", img)
key = cv2.waitKey(0) & 0xFF     # & 0xFF ç¡®ä¿è·¨å¹³å°å…¼å®¹
if key == ord('q'):             # æŒ‰ q é€€å‡º
    print("ç”¨æˆ·æŒ‰äº† qï¼Œé€€å‡º")
elif key == ord('s'):           # æŒ‰ s ä¿å­˜
    cv2.imwrite("saved.jpg", img)
    print("å›¾åƒå·²ä¿å­˜")
cv2.destroyAllWindows()

# ç”¨æ³•3ï¼šè§†é¢‘/åŠ¨ç”»å¾ªç¯ï¼ˆåé¢ç« èŠ‚ä¼šç”¨åˆ°ï¼‰
# while True:
#     frame = ...              # è·å–ä¸€å¸§
#     cv2.imshow("Video", frame)
#     if cv2.waitKey(30) & 0xFF == ord('q'):  # æ¯å¸§ç­‰å¾…30ms
#         break
```

> ğŸ’¡ **ä¸ºä»€ä¹ˆè¦ `& 0xFF`ï¼Ÿ** åœ¨æŸäº›å¹³å°ï¼ˆå¦‚ Linux 64ä½ï¼‰ï¼Œ`waitKey()` è¿”å›çš„å€¼å¯èƒ½è¶…è¿‡ 8 ä½ã€‚`& 0xFF` å–æœ€ä½ 8 ä½ï¼Œç¡®ä¿æ­£ç¡®æ¯”è¾ƒ ASCII ç ã€‚å…»æˆè¿™ä¸ªä¹ æƒ¯å°±å¥½ã€‚

#### 2.3 çª—å£ç®¡ç†

```python
# åˆ›å»ºå¯è°ƒæ•´å¤§å°çš„çª—å£
cv2.namedWindow("Resizable", cv2.WINDOW_NORMAL)    # å¯æ‹–æ‹½è°ƒæ•´å¤§å°
cv2.namedWindow("Fixed", cv2.WINDOW_AUTOSIZE)      # å›ºå®šå¤§å°ï¼ˆé»˜è®¤ï¼‰

# è°ƒæ•´çª—å£å¤§å°
cv2.resizeWindow("Resizable", 800, 600)   # è®¾ç½®ä¸º 800Ã—600

# ç§»åŠ¨çª—å£ä½ç½®
cv2.moveWindow("Resizable", 100, 100)     # ç§»åŠ¨åˆ°å±å¹• (100, 100)

# æ˜¾ç¤ºå›¾åƒ
cv2.imshow("Resizable", img)
cv2.imshow("Fixed", img)

# å…³é—­ç‰¹å®šçª—å£
cv2.destroyWindow("Fixed")         # å…³é—­åä¸º "Fixed" çš„çª—å£

# å…³é—­æ‰€æœ‰çª—å£
cv2.destroyAllWindows()
```

#### 2.4 åŒæ—¶æ˜¾ç¤ºå¤šå¼ å›¾åƒ

```python
import cv2
import numpy as np

img = cv2.imread("photo.jpg")
if img is None:
    exit()

# æ–¹æ³•1ï¼šå¤šä¸ªçª—å£
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

cv2.imshow("Original", img)
cv2.imshow("Gray", gray)
cv2.waitKey(0)
cv2.destroyAllWindows()

# æ–¹æ³•2ï¼šæ‹¼æ¥åˆ°ä¸€å¼ å›¾ä¸Šæ˜¾ç¤ºï¼ˆæ¨èï¼ï¼‰
# å…ˆæŠŠç°åº¦å›¾è½¬æˆ3é€šé“ï¼Œæ‰èƒ½å’Œå½©è‰²å›¾æ‹¼æ¥
gray_3ch = cv2.cvtColor(gray, cv2.COLOR_GRAY2BGR)

# æ°´å¹³æ‹¼æ¥
comparison = np.hstack([img, gray_3ch])
cv2.imshow("Comparison", comparison)
cv2.waitKey(0)
cv2.destroyAllWindows()
```

---

### 3. ä½¿ç”¨ Matplotlib æ˜¾ç¤ºï¼ˆJupyter æ¨èï¼‰

åœ¨ Jupyter Notebook ä¸­ï¼Œ`cv2.imshow()` å¯èƒ½ä¸å¤ªå¥½ç”¨ã€‚è¿™æ—¶å€™å¯ä»¥ç”¨ Matplotlibï¼š

```python
import cv2
import matplotlib.pyplot as plt

img = cv2.imread("photo.jpg")
if img is None:
    exit()

# âš ï¸ å¿…é¡»è½¬æ¢ BGR â†’ RGBï¼å¦åˆ™é¢œè‰²æ˜¯åçš„
img_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

# æ˜¾ç¤ºå•å¼ å›¾åƒ
plt.figure(figsize=(10, 6))
plt.imshow(img_rgb)
plt.title("Photo")
plt.axis('off')           # éšè—åæ ‡è½´
plt.show()

# æ˜¾ç¤ºå¤šå¼ å›¾åƒï¼ˆå­å›¾å¸ƒå±€ï¼‰
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

fig, axes = plt.subplots(1, 2, figsize=(14, 6))

axes[0].imshow(img_rgb)
axes[0].set_title("Original (Color)")
axes[0].axis('off')

axes[1].imshow(gray, cmap='gray')   # ç°åº¦å›¾è¦æŒ‡å®š cmap='gray'
axes[1].set_title("Grayscale")
axes[1].axis('off')

plt.tight_layout()
plt.show()
```

> âš ï¸ **ä¸¤ä¸ªå¸¸è§å‘ï¼š**
> 1. Matplotlib ç”¨ RGB é¡ºåºï¼ŒOpenCV ç”¨ BGR â†’ å¿…é¡»ç”¨ `cvtColor` è½¬æ¢
> 2. ç°åº¦å›¾ç”¨ `plt.imshow()` æ—¶è¦åŠ  `cmap='gray'`ï¼Œå¦åˆ™æ˜¾ç¤ºä¸ºå½©è‰²çƒ­åŠ›å›¾

---

### 4. æ˜¾ç¤ºæ–¹å¼å¯¹æ¯”

| ç‰¹æ€§ | cv2.imshow() | Matplotlib |
|------|-------------|-----------|
| **ç¯å¢ƒ** | éœ€è¦å›¾å½¢ç•Œé¢ï¼ˆGUIï¼‰ | æ”¯æŒ Jupyter Notebook |
| **é€Ÿåº¦** | å¿«ï¼ˆå®æ—¶è§†é¢‘é€‚ç”¨ï¼‰ | è¾ƒæ…¢ |
| **é¢œè‰²** | ç›´æ¥æ˜¾ç¤º BGR | éœ€è¦è½¬ RGB |
| **äº¤äº’** | æ”¯æŒé”®ç›˜/é¼ æ ‡äº‹ä»¶ | æœ‰é™äº¤äº’ |
| **é€‚ç”¨åœºæ™¯** | æ¡Œé¢ç¨‹åºã€è§†é¢‘ | æ•°æ®åˆ†æã€æ•™å­¦ |
| **ç°åº¦å›¾** | è‡ªåŠ¨æ­£ç¡®æ˜¾ç¤º | éœ€è¦ cmap='gray' |

---

## ğŸ’» ä»£ç å®æˆ˜

### å®æˆ˜ç»ƒä¹ ï¼šå›¾åƒè¯»å–ä¸æ˜¾ç¤ºå…¨æµç¨‹

```python
# ===================================================================
# å®æˆ˜ç»ƒä¹ ï¼šå›¾åƒè¯»å–ä¸æ˜¾ç¤ºå…¨æµç¨‹
# ç›®æ ‡ï¼šæŒæ¡ imreadã€imshow çš„å„ç§ç”¨æ³•
# ===================================================================

import cv2
import numpy as np

# ---------- 1. åˆ›å»ºæµ‹è¯•å›¾åƒï¼ˆä¸ä¾èµ–å¤–éƒ¨æ–‡ä»¶ï¼‰----------
print("=" * 55)
print("ğŸ–¼ï¸ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæµ‹è¯•å›¾åƒ")
print("=" * 55)

# åˆ›å»ºä¸€å¼ å½©è‰²æµ‹è¯•å›¾åƒ
height, width = 300, 400
test_img = np.zeros((height, width, 3), dtype=np.uint8)

# ç”»å½©è‰²æ¡çº¹
stripe_w = width // 6
test_img[:, 0*stripe_w:1*stripe_w] = [0, 0, 255]     # çº¢è‰²ï¼ˆBGRï¼‰
test_img[:, 1*stripe_w:2*stripe_w] = [0, 165, 255]   # æ©™è‰²
test_img[:, 2*stripe_w:3*stripe_w] = [0, 255, 255]   # é»„è‰²
test_img[:, 3*stripe_w:4*stripe_w] = [0, 255, 0]     # ç»¿è‰²
test_img[:, 4*stripe_w:5*stripe_w] = [255, 0, 0]     # è“è‰²
test_img[:, 5*stripe_w:width]      = [128, 0, 128]   # ç´«è‰²

# å…ˆä¿å­˜ä¸ºæ–‡ä»¶ï¼Œç„¶åç”¨ imread è¯»å–ï¼ˆæ¨¡æ‹Ÿå®Œæ•´æµç¨‹ï¼‰
cv2.imwrite("test_stripes.jpg", test_img)
print(f"  å·²åˆ›å»ºæµ‹è¯•å›¾åƒ: {test_img.shape}")
print(f"  å·²ä¿å­˜ä¸º test_stripes.jpg")

# ---------- 2. ä¸åŒæ¨¡å¼è¯»å– ----------
print("\n" + "=" * 55)
print("ğŸ“– ç¬¬äºŒæ­¥ï¼šä¸åŒæ¨¡å¼è¯»å–")
print("=" * 55)

# å½©è‰²è¯»å–
color = cv2.imread("test_stripes.jpg", cv2.IMREAD_COLOR)
print(f"  å½©è‰²è¯»å–: shape={color.shape}, dtype={color.dtype}")
print(f"            é€šé“æ•°={color.shape[2]}")

# ç°åº¦è¯»å–
gray = cv2.imread("test_stripes.jpg", cv2.IMREAD_GRAYSCALE)
print(f"  ç°åº¦è¯»å–: shape={gray.shape}, dtype={gray.dtype}")
print(f"            ç»´åº¦æ•°={gray.ndim}")

# åŸæ ·è¯»å–ï¼ˆJPEGæ²¡æœ‰é€æ˜é€šé“ï¼Œæ‰€ä»¥å’Œå½©è‰²è¯»å–ä¸€æ ·ï¼‰
unchanged = cv2.imread("test_stripes.jpg", cv2.IMREAD_UNCHANGED)
print(f"  åŸæ ·è¯»å–: shape={unchanged.shape}, dtype={unchanged.dtype}")

# å†…å­˜å¯¹æ¯”
print(f"\n  å†…å­˜å ç”¨å¯¹æ¯”:")
print(f"    å½©è‰²: {color.nbytes:>10,} å­—èŠ‚ ({color.nbytes/1024:.1f} KB)")
print(f"    ç°åº¦: {gray.nbytes:>10,} å­—èŠ‚ ({gray.nbytes/1024:.1f} KB)")
print(f"    èŠ‚çœ: {(1 - gray.nbytes/color.nbytes)*100:.0f}%")

# ---------- 3. è¯»å–å¤±è´¥å¤„ç† ----------
print("\n" + "=" * 55)
print("âš ï¸ ç¬¬ä¸‰æ­¥ï¼šè¯»å–å¤±è´¥å¤„ç†")
print("=" * 55)

# æ•…æ„è¯»å–ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶
bad_img = cv2.imread("this_file_does_not_exist.jpg")
print(f"  è¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶: {bad_img}")   # None
print(f"  ç±»å‹: {type(bad_img)}")          # <class 'NoneType'>

# å®‰å…¨è¯»å–å‡½æ•°
def safe_imread(filepath, flags=cv2.IMREAD_COLOR):
    """å®‰å…¨åœ°è¯»å–å›¾åƒï¼Œå¤±è´¥æ—¶ç»™å‡ºè¯¦ç»†æç¤º"""
    img = cv2.imread(filepath, flags)
    if img is None:
        import os
        exists = os.path.exists(filepath)
        print(f"  âŒ è¯»å–å¤±è´¥: {filepath}")
        print(f"     æ–‡ä»¶å­˜åœ¨: {exists}")
        if not exists:
            print(f"     è¯·æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼")
        else:
            print(f"     æ–‡ä»¶å­˜åœ¨ä½†æ— æ³•è§£ç ï¼Œå¯èƒ½æ˜¯æŸåæˆ–æ ¼å¼ä¸æ”¯æŒ")
        return None
    print(f"  âœ… è¯»å–æˆåŠŸ: {filepath}, shape={img.shape}")
    return img

# æµ‹è¯•å®‰å…¨è¯»å–
safe_imread("test_stripes.jpg")
safe_imread("not_exist.png")

# ---------- 4. åƒç´ å€¼æ¢ç´¢ ----------
print("\n" + "=" * 55)
print("ğŸ” ç¬¬å››æ­¥ï¼šè¯»å–åçš„åƒç´ å€¼æ¢ç´¢")
print("=" * 55)

img = cv2.imread("test_stripes.jpg")

# å–å‡ ä¸ªä½ç½®çš„åƒç´ å€¼
positions = [(0, 0), (0, 100), (0, 200), (0, 300)]
print("  åƒç´ å€¼ï¼ˆBGRæ ¼å¼ï¼‰:")
for y, x in positions:
    pixel = img[y, x]
    print(f"    ä½ç½®({y:>3d},{x:>3d}): B={pixel[0]:>3d}, "
          f"G={pixel[1]:>3d}, R={pixel[2]:>3d}")

# ç°åº¦å›¾çš„åƒç´ å€¼
gray = cv2.imread("test_stripes.jpg", 0)
print("\n  ç°åº¦å€¼:")
for y, x in positions:
    print(f"    ä½ç½®({y:>3d},{x:>3d}): {gray[y, x]:>3d}")

# ---------- 5. æ˜¾ç¤ºå›¾åƒ ----------
print("\n" + "=" * 55)
print("ğŸ–¥ï¸ ç¬¬äº”æ­¥ï¼šå›¾åƒæ˜¾ç¤º")
print("=" * 55)

# åˆ›å»ºå¤šç§æ˜¾ç¤ºæ•ˆæœ
img = cv2.imread("test_stripes.jpg")
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
gray_3ch = cv2.cvtColor(gray, cv2.COLOR_GRAY2BGR)

# æ‹¼æ¥å¯¹æ¯”å›¾
comparison = np.hstack([img, gray_3ch])
print(f"  å¯¹æ¯”å›¾ shape: {comparison.shape}")
print(f"  å·¦åŠ: å½©è‰²åŸå›¾")
print(f"  å³åŠ: ç°åº¦æ•ˆæœ")

# æ˜¾ç¤ºï¼ˆå–æ¶ˆæ³¨é‡Šè¿è¡Œï¼‰
# cv2.imshow("Color vs Gray", comparison)
# key = cv2.waitKey(0) & 0xFF
# print(f"  æŒ‰ä¸‹çš„é”®: {chr(key)} (ASCII={key})")
# cv2.destroyAllWindows()

print("\n  å¦‚éœ€æ˜¾ç¤ºçª—å£ï¼Œè¯·å–æ¶ˆä»£ç ä¸­çš„æ³¨é‡Šè¿è¡Œ")

# ---------- 6. æŒ‰é”®äº¤äº’ ----------
print("\n" + "=" * 55)
print("âŒ¨ï¸ ç¬¬å…­æ­¥ï¼šæŒ‰é”®äº¤äº’ç¤ºä¾‹")
print("=" * 55)

print("  æŒ‰é”®äº¤äº’æ¨¡æ¿:")
print("    q â†’ é€€å‡º")
print("    s â†’ ä¿å­˜")
print("    g â†’ è½¬ç°åº¦")
print()

# å®Œæ•´çš„æŒ‰é”®äº¤äº’ç¤ºä¾‹ï¼ˆå–æ¶ˆæ³¨é‡Šè¿è¡Œï¼‰
# img = cv2.imread("test_stripes.jpg")
# cv2.imshow("Interactive", img)
# while True:
#     key = cv2.waitKey(0) & 0xFF
#     if key == ord('q'):
#         print("  é€€å‡º")
#         break
#     elif key == ord('s'):
#         cv2.imwrite("saved_result.jpg", img)
#         print("  å·²ä¿å­˜")
#     elif key == ord('g'):
#         img = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
#         cv2.imshow("Interactive", img)
#         print("  å·²è½¬ç°åº¦")
# cv2.destroyAllWindows()

print("  ï¼ˆå–æ¶ˆæ³¨é‡Šå¯ä½“éªŒäº¤äº’åŠŸèƒ½ï¼‰")

# æ¸…ç†æµ‹è¯•æ–‡ä»¶
import os
if os.path.exists("test_stripes.jpg"):
    os.remove("test_stripes.jpg")
    print("\n  å·²æ¸…ç†æµ‹è¯•æ–‡ä»¶")

print("\nâœ… å›¾åƒè¯»å–ä¸æ˜¾ç¤ºç»ƒä¹ å®Œæˆï¼")
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**

```
=======================================================
ğŸ–¼ï¸ ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæµ‹è¯•å›¾åƒ
=======================================================
  å·²åˆ›å»ºæµ‹è¯•å›¾åƒ: (300, 400, 3)
  å·²ä¿å­˜ä¸º test_stripes.jpg

=======================================================
ğŸ“– ç¬¬äºŒæ­¥ï¼šä¸åŒæ¨¡å¼è¯»å–
=======================================================
  å½©è‰²è¯»å–: shape=(300, 400, 3), dtype=uint8
            é€šé“æ•°=3
  ç°åº¦è¯»å–: shape=(300, 400), dtype=uint8
            ç»´åº¦æ•°=2
  åŸæ ·è¯»å–: shape=(300, 400, 3), dtype=uint8

  å†…å­˜å ç”¨å¯¹æ¯”:
    å½©è‰²:    360,000 å­—èŠ‚ (351.6 KB)
    ç°åº¦:    120,000 å­—èŠ‚ (117.2 KB)
    èŠ‚çœ: 67%

=======================================================
âš ï¸ ç¬¬ä¸‰æ­¥ï¼šè¯»å–å¤±è´¥å¤„ç†
=======================================================
  è¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶: None
  ç±»å‹: <class 'NoneType'>
  âœ… è¯»å–æˆåŠŸ: test_stripes.jpg, shape=(300, 400, 3)
  âŒ è¯»å–å¤±è´¥: not_exist.png
     æ–‡ä»¶å­˜åœ¨: False
     è¯·æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼

âœ… å›¾åƒè¯»å–ä¸æ˜¾ç¤ºç»ƒä¹ å®Œæˆï¼
```

---

## ğŸš¨ å¸¸è§é—®é¢˜ä¸æ˜“é”™ç‚¹

### Q1: imread è¿”å› None ä½†è·¯å¾„çœ‹èµ·æ¥æ²¡é—®é¢˜ï¼Ÿ

```python
# å¸¸è§åŸå› ï¼š
# 1. è·¯å¾„ä¸­æœ‰ä¸­æ–‡
img = cv2.imread("D:/å›¾ç‰‡/ç…§ç‰‡.jpg")    # å¯èƒ½è¿”å› Noneï¼

# è§£å†³ï¼šç”¨ NumPy è§£ç 
data = np.fromfile("D:/å›¾ç‰‡/ç…§ç‰‡.jpg", dtype=np.uint8)
img = cv2.imdecode(data, cv2.IMREAD_COLOR)

# 2. è·¯å¾„åˆ†éš”ç¬¦é—®é¢˜ï¼ˆWindowsï¼‰
img = cv2.imread("D:\new\test.jpg")     # \n å’Œ \t æ˜¯è½¬ä¹‰ç¬¦ï¼
img = cv2.imread(r"D:\new\test.jpg")    # åŠ  r å‰ç¼€
img = cv2.imread("D:/new/test.jpg")     # ç”¨æ­£æ–œæ 

# 3. æ–‡ä»¶æ‰©å±•åå¤§å°å†™
# æŸäº›ç³»ç»ŸåŒºåˆ†å¤§å°å†™ï¼šphoto.JPG â‰  photo.jpg

# 4. ç›¸å¯¹è·¯å¾„çš„å·¥ä½œç›®å½•ä¸å¯¹
import os
print(f"å½“å‰å·¥ä½œç›®å½•: {os.getcwd()}")   # å…ˆç¡®è®¤å·¥ä½œç›®å½•
```

### Q2: imshow çª—å£å¡æ­» / æ— æ³•å…³é—­ï¼Ÿ

```python
# åŸå› ï¼šwaitKey() æ²¡æœ‰æ­£ç¡®è°ƒç”¨

# âŒ å¿˜è®° waitKey
cv2.imshow("Test", img)
# çª—å£ä¸€é—ªè€Œè¿‡æˆ–æ— å“åº”

# âœ… å®Œæ•´ä¸‰ä»¶å¥—
cv2.imshow("Test", img)
cv2.waitKey(0)
cv2.destroyAllWindows()

# âŒ åœ¨å¾ªç¯ä¸­æ²¡æœ‰ waitKey
# for i in range(10):
#     cv2.imshow("Test", images[i])
# # åªçœ‹åˆ°æœ€åä¸€å¸§æˆ–çª—å£å¡æ­»

# âœ… å¾ªç¯ä¸­è¦æœ‰ waitKey
# for i in range(10):
#     cv2.imshow("Test", images[i])
#     cv2.waitKey(500)   # æ¯å¸§æ˜¾ç¤º500ms
# cv2.destroyAllWindows()
```

### Q3: ç°åº¦å›¾å’Œå½©è‰²å›¾æ€ä¹ˆåˆ¤æ–­ï¼Ÿ

```python
img = cv2.imread("photo.jpg")

# é€šè¿‡ shape åˆ¤æ–­
if img.ndim == 2:
    print("ç°åº¦å›¾")
elif img.ndim == 3:
    if img.shape[2] == 3:
        print("å½©è‰²å›¾ (BGR)")
    elif img.shape[2] == 4:
        print("å¸¦é€æ˜é€šé“ (BGRA)")

# é€šç”¨çš„è·å–æ–¹å¼
h, w = img.shape[:2]          # é«˜åº¦ã€å®½åº¦ï¼ˆç°åº¦/å½©è‰²éƒ½èƒ½ç”¨ï¼‰
channels = 1 if img.ndim == 2 else img.shape[2]
print(f"é«˜={h}, å®½={w}, é€šé“={channels}")
```

### Q4: Matplotlib æ˜¾ç¤ºé¢œè‰²ä¸å¯¹ï¼Ÿ

```python
import cv2
import matplotlib.pyplot as plt

img = cv2.imread("photo.jpg")

# âŒ ç›´æ¥æ˜¾ç¤º â†’ çº¢è“äº’æ¢
plt.imshow(img)    # BGR è¢«å½“æˆ RGBï¼Œé¢œè‰²å…¨åäº†ï¼

# âœ… å…ˆè½¬æ¢å†æ˜¾ç¤º
plt.imshow(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))

# âŒ ç°åº¦å›¾æ˜¾ç¤ºæˆå½©è™¹è‰²
gray = cv2.imread("photo.jpg", 0)
plt.imshow(gray)             # é»˜è®¤ç”¨å½©è‰²çƒ­åŠ›å›¾

# âœ… æŒ‡å®šç°åº¦è‰²å½©æ˜ å°„
plt.imshow(gray, cmap='gray')
```

---

## ğŸ¯ æ€»ç»“

æœ¬èŠ‚å­¦ä¹ äº† OpenCV çš„å›¾åƒè¯»å–ä¸æ˜¾ç¤ºï¼š

âœ… **cv2.imread()**ï¼šè¯»å–å›¾åƒï¼Œæ”¯æŒå½©è‰²/ç°åº¦/åŸæ ·ä¸‰ç§æ¨¡å¼
âœ… **è¯»å–æ ‡å¿—**ï¼š`IMREAD_COLOR`(1)ã€`IMREAD_GRAYSCALE`(0)ã€`IMREAD_UNCHANGED`(-1)
âœ… **è·¯å¾„å¤„ç†**ï¼šç”¨æ­£æ–œæ æˆ– `r""` åŸå§‹å­—ç¬¦ä¸²ï¼Œä¸­æ–‡è·¯å¾„ç”¨ `imdecode` è§£å†³
âœ… **å®‰å…¨æ£€æŸ¥**ï¼šè¯»å–åå¿…é¡»æ£€æŸ¥ `img is None`
âœ… **cv2.imshow()**ï¼šæ˜¾ç¤ºå›¾åƒï¼Œå¿…é¡»é…åˆ `waitKey()` ä½¿ç”¨
âœ… **waitKey()**ï¼š0=æ— é™ç­‰å¾…ï¼Œ>0=ç­‰å¾…æ¯«ç§’æ•°ï¼Œè¿”å›æŒ‰é”® ASCII ç 
âœ… **Matplotlib æ˜¾ç¤º**ï¼šéœ€è¦ BGRâ†’RGB è½¬æ¢ï¼Œç°åº¦å›¾åŠ  `cmap='gray'`

> ğŸ”‘ **æ ¸å¿ƒè¦ç‚¹ï¼š** `cv2.imread()` è¯»å–å**ä¸€å®šè¦æ£€æŸ¥ None**ï¼Œ`cv2.imshow()` å**ä¸€å®šè¦åŠ  waitKey()**ï¼Œç”¨ Matplotlib æ˜¾ç¤º**ä¸€å®šè¦è½¬ RGB**ã€‚è®°ä½è¿™ä¸‰ä¸ª"ä¸€å®šè¦"ï¼Œä½ å°±ä¸ä¼šçŠ¯æ–°æ‰‹å¸¸è§é”™è¯¯ï¼

**ä¸‹ä¸€æ­¥ï¼š**
ğŸ‘‰ [03 - å›¾åƒä¿å­˜](../03-å›¾åƒä¿å­˜/å›¾åƒä¿å­˜.md)

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [OpenCV å®˜æ–¹æ–‡æ¡£ - imread](https://docs.opencv.org/4.x/d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56)
- [OpenCV å®˜æ–¹æ–‡æ¡£ - imshow](https://docs.opencv.org/4.x/d7/dfc/group__highgui.html#ga453d42fe4cb60e5723281a89973ee563)
- [OpenCV-Python å›¾åƒå…¥é—¨æ•™ç¨‹](https://docs.opencv.org/4.x/dc/d2e/tutorial_py_image_display.html)
