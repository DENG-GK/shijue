# Cannyè¾¹ç¼˜æ£€æµ‹

> Cannyè¾¹ç¼˜æ£€æµ‹æ˜¯ç›®å‰å…¬è®¤**æ•ˆæœæœ€å¥½**çš„è¾¹ç¼˜æ£€æµ‹ç®—æ³•ã€‚å®ƒä¸æ˜¯ç®€å•çš„å·ç§¯æ ¸ï¼Œè€Œæ˜¯ä¸€å¥—å®Œæ•´çš„**å¤šé˜¶æ®µå¤„ç†æµç¨‹**ã€‚Cannyç®—æ³•èƒ½å¤Ÿæ£€æµ‹å‡ºç»†ã€è¿ç»­ã€å®šä½å‡†ç¡®çš„è¾¹ç¼˜ï¼Œæ˜¯è®¡ç®—æœºè§†è§‰ä¸­åº”ç”¨æœ€å¹¿æ³›çš„è¾¹ç¼˜æ£€æµ‹æ–¹æ³•ï¼

---

## ğŸ“– ç†è®ºéƒ¨åˆ†

### 1. Cannyç®—æ³•ç®€ä»‹

#### 1.1 ç®—æ³•èƒŒæ™¯

```
Cannyè¾¹ç¼˜æ£€æµ‹çš„å†å²ï¼š

  1986å¹´ï¼ŒJohn Cannyåœ¨å…¶è®ºæ–‡
  "A Computational Approach to Edge Detection"
  ä¸­æå‡ºäº†è¿™ä¸€ç®—æ³•

  Cannyæå‡ºäº†"æœ€ä¼˜è¾¹ç¼˜æ£€æµ‹"çš„ä¸‰ä¸ªå‡†åˆ™ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                             â”‚
  â”‚  1. ä½é”™è¯¯ç‡ï¼ˆGood Detectionï¼‰                               â”‚
  â”‚     â€¢ å°½å¯èƒ½æ£€æµ‹å‡ºæ‰€æœ‰çœŸæ­£çš„è¾¹ç¼˜                             â”‚
  â”‚     â€¢ å°½å¯èƒ½å°‘æ£€æµ‹åˆ°å‡è¾¹ç¼˜ï¼ˆå™ªå£°ï¼‰                           â”‚
  â”‚                                                             â”‚
  â”‚  2. é«˜å®šä½ç²¾åº¦ï¼ˆGood Localizationï¼‰                          â”‚
  â”‚     â€¢ æ£€æµ‹åˆ°çš„è¾¹ç¼˜ä½ç½®åº”è¯¥å°½å¯èƒ½æ¥è¿‘çœŸå®ä½ç½®                 â”‚
  â”‚                                                             â”‚
  â”‚  3. å•ä¸€å“åº”ï¼ˆSingle Responseï¼‰                              â”‚
  â”‚     â€¢ ä¸€æ¡è¾¹ç¼˜åªäº§ç”Ÿä¸€ä¸ªå“åº”                                 â”‚
  â”‚     â€¢ é¿å…"åŒè¾¹ç¼˜"æˆ–"å¤šè¾¹ç¼˜"é—®é¢˜                            â”‚
  â”‚                                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  åŸºäºè¿™ä¸‰ä¸ªå‡†åˆ™ï¼ŒCannyè®¾è®¡äº†ä¸€å¥—å¤šé˜¶æ®µçš„å¤„ç†æµç¨‹
```

#### 1.2 Cannyç®—æ³•æµç¨‹

```
Cannyè¾¹ç¼˜æ£€æµ‹çš„äº”ä¸ªæ­¥éª¤ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  åŸå§‹å›¾åƒ    â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. é«˜æ–¯æ»¤æ³¢  â”‚ â† å¹³æ»‘å™ªå£°
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 2. æ¢¯åº¦è®¡ç®—  â”‚ â† ç”¨Sobelè®¡ç®—æ¢¯åº¦å¹…å€¼å’Œæ–¹å‘
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 3. éæå¤§å€¼  â”‚ â† ç»†åŒ–è¾¹ç¼˜ï¼Œåªä¿ç•™æœ€å¼ºç‚¹
  â”‚    æŠ‘åˆ¶      â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 4. åŒé˜ˆå€¼    â”‚ â† åŒºåˆ†å¼ºè¾¹ç¼˜å’Œå¼±è¾¹ç¼˜
  â”‚    æ£€æµ‹      â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 5. è¾¹ç¼˜è¿æ¥  â”‚ â† é€šè¿‡å¼ºè¾¹ç¼˜è¿æ¥å¼±è¾¹ç¼˜
  â”‚  ï¼ˆæ»åé˜ˆå€¼ï¼‰â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æœ€ç»ˆè¾¹ç¼˜    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  æ¯ä¸€æ­¥éƒ½å¾ˆå…³é”®ï¼Œç¼ºä¸€ä¸å¯ï¼
```

---

### 2. æ­¥éª¤è¯¦è§£

#### 2.1 æ­¥éª¤1ï¼šé«˜æ–¯æ»¤æ³¢

```
é«˜æ–¯æ»¤æ³¢çš„ä½œç”¨ï¼š

  è¾¹ç¼˜æ£€æµ‹å¯¹å™ªå£°æ•æ„Ÿï¼Œéœ€è¦å…ˆå¹³æ»‘

  é«˜æ–¯æ ¸ç¤ºä¾‹ï¼ˆ5Ã—5ï¼ŒÏƒ=1.4ï¼‰ï¼š
  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
  â”‚ 2  â”‚ 4  â”‚ 5  â”‚ 4  â”‚ 2  â”‚
  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
  â”‚ 4  â”‚ 9  â”‚ 12 â”‚ 9  â”‚ 4  â”‚
  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
  â”‚ 5  â”‚ 12 â”‚ 15 â”‚ 12 â”‚ 5  â”‚  Ã— (1/159)
  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
  â”‚ 4  â”‚ 9  â”‚ 12 â”‚ 9  â”‚ 4  â”‚
  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
  â”‚ 2  â”‚ 4  â”‚ 5  â”‚ 4  â”‚ 2  â”‚
  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

  é«˜æ–¯æ ¸å¤§å°å’ŒÏƒçš„é€‰æ‹©ï¼š
  â€¢ æ ¸è¶Šå¤§ï¼Œå¹³æ»‘æ•ˆæœè¶Šå¼ºï¼Œä½†è¾¹ç¼˜å¯èƒ½æ¨¡ç³Š
  â€¢ Ïƒè¶Šå¤§ï¼Œå¹³æ»‘æ•ˆæœè¶Šå¼º
  â€¢ å…¸å‹å€¼ï¼š5Ã—5æ ¸ï¼ŒÏƒ=1.0~1.4
```

#### 2.2 æ­¥éª¤2ï¼šæ¢¯åº¦è®¡ç®—

```
ä½¿ç”¨Sobelç®—å­è®¡ç®—æ¢¯åº¦ï¼š

  Gx = Sobelæ°´å¹³æ¢¯åº¦
  Gy = Sobelå‚ç›´æ¢¯åº¦

  æ¢¯åº¦å¹…å€¼ï¼š
  |G| = âˆš(GxÂ² + GyÂ²)

  æ¢¯åº¦æ–¹å‘ï¼š
  Î¸ = arctan(Gy / Gx)

  æ–¹å‘é‡åŒ–ï¼ˆç®€åŒ–è®¡ç®—ï¼‰ï¼š
  æŠŠæ–¹å‘ç¦»æ•£åŒ–ä¸º4ä¸ªä¸»æ–¹å‘

          90Â°
           â”‚
           â”‚
    135Â° â”€â”€â”¼â”€â”€ 45Â°
           â”‚
           â”‚
          0Â°

  é‡åŒ–è§„åˆ™ï¼š
  â€¢ 0Â°~22.5Â° æˆ– 157.5Â°~180Â° â†’ 0Â°ï¼ˆæ°´å¹³ï¼‰
  â€¢ 22.5Â°~67.5Â° â†’ 45Â°ï¼ˆå¯¹è§’â†—ï¼‰
  â€¢ 67.5Â°~112.5Â° â†’ 90Â°ï¼ˆå‚ç›´ï¼‰
  â€¢ 112.5Â°~157.5Â° â†’ 135Â°ï¼ˆå¯¹è§’â†–ï¼‰
```

#### 2.3 æ­¥éª¤3ï¼šéæå¤§å€¼æŠ‘åˆ¶

```
éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMS - Non-Maximum Suppressionï¼‰ï¼š

  ç›®æ ‡ï¼šç»†åŒ–è¾¹ç¼˜ï¼Œè®©è¾¹ç¼˜å˜æˆå•åƒç´ å®½

  åŸç†ï¼šåªä¿ç•™æ¢¯åº¦æ–¹å‘ä¸Šçš„å±€éƒ¨æœ€å¤§å€¼

  ç¤ºä¾‹ï¼ˆå‚ç›´è¾¹ç¼˜ï¼Œæ¢¯åº¦æ–¹å‘ä¸ºæ°´å¹³0Â°ï¼‰ï¼š

  æ¢¯åº¦å¹…å€¼ï¼š              éæå¤§å€¼æŠ‘åˆ¶åï¼š
  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
  â”‚ 50 â”‚ 80 â”‚ 30 â”‚        â”‚ 0  â”‚ 80 â”‚ 0  â”‚
  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤   â†’    â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
  â”‚ 40 â”‚ 90 â”‚ 20 â”‚        â”‚ 0  â”‚ 90 â”‚ 0  â”‚
  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
  â”‚ 30 â”‚ 70 â”‚ 25 â”‚        â”‚ 0  â”‚ 70 â”‚ 0  â”‚
  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
           â†‘                       â†‘
    åœ¨æ°´å¹³æ–¹å‘ä¸Š               åªä¿ç•™æ¯è¡Œ
    æ¯”è¾ƒå·¦å³é‚»å±…               çš„æœ€å¤§å€¼

  ä¸åŒæ–¹å‘çš„æ¯”è¾ƒï¼š

  æ–¹å‘=0Â°ï¼ˆæ°´å¹³ï¼‰ï¼š  æ–¹å‘=45Â°ï¼š      æ–¹å‘=90Â°ï¼ˆå‚ç›´ï¼‰ï¼š  æ–¹å‘=135Â°ï¼š
    æ¯”è¾ƒå·¦å³         æ¯”è¾ƒâ†™â†—          æ¯”è¾ƒä¸Šä¸‹          æ¯”è¾ƒâ†–â†˜
      â”‚ â† P â†’ â”‚      â†™       â†—        â†‘              â†–       â†˜
                       P               P                 P
                    â†—       â†™        â†“              â†˜       â†–
```

#### 2.4 æ­¥éª¤4ï¼šåŒé˜ˆå€¼æ£€æµ‹

```
åŒé˜ˆå€¼æ£€æµ‹çš„åŸç†ï¼š

  ä½¿ç”¨ä¸¤ä¸ªé˜ˆå€¼ï¼šé«˜é˜ˆå€¼ï¼ˆthreshold2ï¼‰å’Œä½é˜ˆå€¼ï¼ˆthreshold1ï¼‰

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                             â”‚
  â”‚  æ¢¯åº¦å¹…å€¼ > é«˜é˜ˆå€¼ â†’ å¼ºè¾¹ç¼˜ï¼ˆç¡®å®šæ˜¯è¾¹ç¼˜ï¼‰                   â”‚
  â”‚                                                             â”‚
  â”‚  ä½é˜ˆå€¼ < æ¢¯åº¦å¹…å€¼ < é«˜é˜ˆå€¼ â†’ å¼±è¾¹ç¼˜ï¼ˆå¯èƒ½æ˜¯è¾¹ç¼˜ï¼‰          â”‚
  â”‚                                                             â”‚
  â”‚  æ¢¯åº¦å¹…å€¼ < ä½é˜ˆå€¼ â†’ éè¾¹ç¼˜ï¼ˆä¸æ˜¯è¾¹ç¼˜ï¼‰                     â”‚
  â”‚                                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  å›¾ç¤ºï¼š

  æ¢¯åº¦
  å¹…å€¼
    â”‚
    â”‚
  200â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é«˜é˜ˆå€¼
    â”‚        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ         å¼ºè¾¹ç¼˜
  100â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä½é˜ˆå€¼
    â”‚    â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’    å¼±è¾¹ç¼˜
    â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  éè¾¹ç¼˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ä½ç½®

  ä¸ºä»€ä¹ˆéœ€è¦åŒé˜ˆå€¼ï¼Ÿ
  â€¢ å•é˜ˆå€¼ï¼šé˜ˆå€¼é«˜äº†æ¼æ£€ï¼Œé˜ˆå€¼ä½äº†å™ªå£°å¤š
  â€¢ åŒé˜ˆå€¼ï¼šé«˜é˜ˆå€¼ä¿è¯å¼ºè¾¹ç¼˜ï¼Œä½é˜ˆå€¼ä¿ç•™å¯èƒ½çš„è¾¹ç¼˜ç»†èŠ‚
```

#### 2.5 æ­¥éª¤5ï¼šè¾¹ç¼˜è¿æ¥ï¼ˆæ»åé˜ˆå€¼ï¼‰

```
è¾¹ç¼˜è¿æ¥ï¼ˆHysteresis Thresholdingï¼‰ï¼š

  åŸåˆ™ï¼šå¼±è¾¹ç¼˜åªæœ‰åœ¨ä¸å¼ºè¾¹ç¼˜è¿é€šæ—¶æ‰ä¿ç•™

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                             â”‚
  â”‚  1. é¦–å…ˆæ ‡è®°æ‰€æœ‰å¼ºè¾¹ç¼˜åƒç´ ï¼ˆä¸€å®šæ˜¯è¾¹ç¼˜ï¼‰                    â”‚
  â”‚                                                             â”‚
  â”‚  2. æ£€æŸ¥æ¯ä¸ªå¼±è¾¹ç¼˜åƒç´ çš„8é‚»åŸŸ                               â”‚
  â”‚     â€¢ å¦‚æœä¸å¼ºè¾¹ç¼˜è¿é€š â†’ ä¿ç•™ï¼Œå˜æˆå¼ºè¾¹ç¼˜                   â”‚
  â”‚     â€¢ å¦‚æœä¸ä¸å¼ºè¾¹ç¼˜è¿é€š â†’ ä¸¢å¼ƒ                             â”‚
  â”‚                                                             â”‚
  â”‚  3. é€’å½’å¤„ç†ï¼Œç›´åˆ°æ²¡æœ‰æ–°çš„è¾¹ç¼˜åŠ å…¥                          â”‚
  â”‚                                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ç¤ºä¾‹ï¼š

  åŒé˜ˆå€¼åï¼š                   è¾¹ç¼˜è¿æ¥åï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚     â–ˆâ–ˆâ–ˆ         â”‚         â”‚     â–ˆâ–ˆâ–ˆ         â”‚
  â”‚    â–’  â–ˆâ–ˆâ–ˆ       â”‚         â”‚    â–ˆ  â–ˆâ–ˆâ–ˆ       â”‚
  â”‚   â–’    â–’â–ˆâ–ˆ      â”‚    â†’    â”‚   â–ˆ    â–ˆâ–ˆâ–ˆ      â”‚
  â”‚  â–’              â”‚         â”‚  â–ˆ              â”‚
  â”‚ â–’â–’â–’â–’            â”‚         â”‚                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â–ˆ=å¼ºè¾¹ç¼˜ â–’=å¼±è¾¹ç¼˜              ä¸å¼ºè¾¹ç¼˜è¿é€šçš„å¼±è¾¹ç¼˜è¢«ä¿ç•™
                                å­¤ç«‹çš„å¼±è¾¹ç¼˜è¢«ä¸¢å¼ƒ

  è¿™å°±æ˜¯"æ»å"çš„å«ä¹‰ï¼š
  å¼±è¾¹ç¼˜çš„å‘½è¿å–å†³äºå®ƒæ˜¯å¦ä¸å¼ºè¾¹ç¼˜ç›¸è¿
```

---

### 3. OpenCVä¸­çš„Canny

#### 3.1 å‡½æ•°è¯­æ³•

```
cv2.Canny() å‡½æ•°è¯¦è§£ï¼š

  edges = cv2.Canny(image, threshold1, threshold2, apertureSize=3, L2gradient=False)

  å‚æ•°è¯´æ˜ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å‚æ•°           â”‚ è¯´æ˜                                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ image          â”‚ è¾“å…¥å›¾åƒï¼ˆç°åº¦å›¾æˆ–å½©è‰²å›¾ï¼‰                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ threshold1     â”‚ ä½é˜ˆå€¼                                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ threshold2     â”‚ é«˜é˜ˆå€¼                                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ apertureSize   â”‚ Sobelæ ¸å¤§å°ï¼ˆ3, 5, 7ï¼‰ï¼Œé»˜è®¤3                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ L2gradient     â”‚ True: ä½¿ç”¨âˆš(GxÂ²+GyÂ²)                          â”‚
  â”‚                â”‚ False: ä½¿ç”¨|Gx|+|Gy|ï¼ˆé»˜è®¤ï¼Œæ›´å¿«ï¼‰            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  è¿”å›å€¼ï¼š
  â€¢ edges: äºŒå€¼è¾¹ç¼˜å›¾ï¼ˆ0æˆ–255ï¼‰

  ä½¿ç”¨ç¤ºä¾‹ï¼š
  edges = cv2.Canny(img, 50, 150)
```

#### 3.2 é˜ˆå€¼é€‰æ‹©

```
é˜ˆå€¼é€‰æ‹©æŒ‡å—ï¼š

  ç»éªŒæ³•åˆ™ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                             â”‚
  â”‚  é«˜é˜ˆå€¼ = 2~3 Ã— ä½é˜ˆå€¼                                      â”‚
  â”‚                                                             â”‚
  â”‚  å…¸å‹å€¼ï¼š                                                    â”‚
  â”‚  â€¢ ä½å¯¹æ¯”åº¦å›¾åƒï¼šthreshold1=30, threshold2=90              â”‚
  â”‚  â€¢ ä¸­å¯¹æ¯”åº¦å›¾åƒï¼šthreshold1=50, threshold2=150             â”‚
  â”‚  â€¢ é«˜å¯¹æ¯”åº¦å›¾åƒï¼šthreshold1=100, threshold2=200            â”‚
  â”‚                                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  é˜ˆå€¼å¯¹ç»“æœçš„å½±å“ï¼š

    é˜ˆå€¼å¤ªä½ï¼š                    é˜ˆå€¼é€‚ä¸­ï¼š                    é˜ˆå€¼å¤ªé«˜ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚            â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚            â”‚     â–ˆâ–ˆâ–ˆâ–ˆ     â”‚
  â”‚ â–ˆ â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ”‚            â”‚   â–ˆ    â–ˆ     â”‚            â”‚              â”‚
  â”‚ â–ˆâ–ˆ â–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ”‚     â†’      â”‚   â–ˆ    â–ˆ     â”‚     â†’      â”‚              â”‚
  â”‚ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚            â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚            â”‚              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    å™ªå£°å¤ªå¤š                    æ¸…æ™°çš„è¾¹ç¼˜                    è¾¹ç¼˜ä¸¢å¤±

  è‡ªåŠ¨é˜ˆå€¼æ–¹æ³•ï¼ˆOtsuï¼‰ï¼š
  # ä½¿ç”¨å›¾åƒä¸­å€¼æ¥è‡ªåŠ¨ç¡®å®šé˜ˆå€¼
  median = np.median(img)
  threshold1 = int(max(0, (1.0 - 0.33) * median))
  threshold2 = int(min(255, (1.0 + 0.33) * median))
```

---

### 4. Canny vs å…¶ä»–ç®—å­

```
Cannyä¸å…¶ä»–è¾¹ç¼˜æ£€æµ‹æ–¹æ³•çš„å¯¹æ¯”ï¼š

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚    ç‰¹æ€§        â”‚  Sobel   â”‚ Laplacianâ”‚   Scharr   â”‚   Canny   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  è¾¹ç¼˜ç»†åº¦      â”‚   ç²—     â”‚   ä¸­ç­‰   â”‚    ç²—      â”‚   ç»†      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  è¾¹ç¼˜è¿ç»­æ€§    â”‚   å·®     â”‚   å·®     â”‚    å·®      â”‚   å¥½      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  å™ªå£°æŠ‘åˆ¶      â”‚   ä¸­ç­‰   â”‚   å·®     â”‚    ä¸­ç­‰    â”‚   å¥½      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  å®šä½ç²¾åº¦      â”‚   ä¸­ç­‰   â”‚   å¥½     â”‚    å¥½      â”‚   å¥½      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  è®¡ç®—é€Ÿåº¦      â”‚   å¿«     â”‚   å¿«     â”‚    å¿«      â”‚   ä¸­ç­‰    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  æ–¹å‘ä¿¡æ¯      â”‚   æœ‰     â”‚   æ—      â”‚    æœ‰      â”‚   æ— *     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  å‚æ•°æ•°é‡      â”‚   1      â”‚   1      â”‚    0       â”‚   2       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  * Cannyå†…éƒ¨è®¡ç®—äº†æ–¹å‘ï¼Œä½†é»˜è®¤ä¸è¾“å‡º

  æ€»ç»“ï¼š
  â€¢ éœ€è¦é€Ÿåº¦ â†’ Sobel
  â€¢ éœ€è¦ç²¾ç¡®æ–¹å‘ â†’ Sobel/Scharr
  â€¢ éœ€è¦æœ€å¥½çš„è¾¹ç¼˜è´¨é‡ â†’ Canny
  â€¢ æ—¥å¸¸ä½¿ç”¨æ¨è â†’ Canny
```

---

## ğŸ’» ä»£ç å®æˆ˜

### ä»£ç 1ï¼šCannyåŸºæœ¬ç”¨æ³•

```python
"""
Cannyè¾¹ç¼˜æ£€æµ‹çš„åŸºæœ¬ç”¨æ³•
å­¦ä¹ å¦‚ä½•ä½¿ç”¨cv2.Canny()è¿›è¡Œè¾¹ç¼˜æ£€æµ‹
"""

import cv2
import numpy as np
import matplotlib.pyplot as plt

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei']
plt.rcParams['axes.unicode_minus'] = False

# ===================== åˆ›å»ºæµ‹è¯•å›¾åƒ =====================

def create_test_image():
    """åˆ›å»ºæµ‹è¯•å›¾åƒ"""
    img = np.zeros((300, 400), dtype=np.uint8)
    img[:] = 80

    # å„ç§å½¢çŠ¶
    cv2.rectangle(img, (40, 40), (140, 140), 200, -1)
    cv2.circle(img, (260, 90), 50, 180, -1)
    cv2.ellipse(img, (320, 200), (50, 30), 30, 0, 360, 200, -1)

    # çº¿æ¡
    cv2.line(img, (40, 180), (150, 260), 200, 4)

    # ä¸‰è§’å½¢
    pts = np.array([[200, 160], [160, 280], [240, 280]], np.int32)
    cv2.fillPoly(img, [pts], 180)

    return img

img = create_test_image()

print("æµ‹è¯•å›¾åƒå·²åˆ›å»º")
print(f"  å°ºå¯¸: {img.shape}")

# ===================== åº”ç”¨Cannyè¾¹ç¼˜æ£€æµ‹ =====================

# åŸºæœ¬ç”¨æ³•
edges = cv2.Canny(img, 50, 150)

print(f"\nCannyç»“æœï¼š")
print(f"  è¾“å‡ºç±»å‹: {edges.dtype}")
print(f"  åƒç´ å€¼: 0 æˆ– 255ï¼ˆäºŒå€¼å›¾ï¼‰")

# ===================== ä¸å…¶ä»–æ–¹æ³•å¯¹æ¯” =====================

# é«˜æ–¯æ¨¡ç³Šåå†Cannyï¼ˆæ ‡å‡†åšæ³•ï¼‰
img_blur = cv2.GaussianBlur(img, (5, 5), 1.4)
edges_blur = cv2.Canny(img_blur, 50, 150)

# Sobel
sobel_x = cv2.Sobel(img_blur, cv2.CV_64F, 1, 0, ksize=3)
sobel_y = cv2.Sobel(img_blur, cv2.CV_64F, 0, 1, ksize=3)
sobel = np.sqrt(sobel_x**2 + sobel_y**2)
sobel = np.clip(sobel, 0, 255).astype(np.uint8)

# Laplacian
laplacian = cv2.Laplacian(img_blur, cv2.CV_64F, ksize=3)
laplacian = cv2.convertScaleAbs(laplacian)

# ===================== å¯è§†åŒ– =====================

fig, axes = plt.subplots(2, 3, figsize=(15, 10))

# åŸå›¾
axes[0, 0].imshow(img, cmap='gray')
axes[0, 0].set_title('åŸå§‹å›¾åƒ', fontsize=12)
axes[0, 0].axis('off')

# Cannyï¼ˆä¸é¢„å¤„ç†ï¼‰
axes[0, 1].imshow(edges, cmap='gray')
axes[0, 1].set_title('Canny (50, 150)\nç›´æ¥å¤„ç†', fontsize=12)
axes[0, 1].axis('off')

# Cannyï¼ˆé«˜æ–¯æ¨¡ç³Šåï¼‰
axes[0, 2].imshow(edges_blur, cmap='gray')
axes[0, 2].set_title('Canny (50, 150)\né«˜æ–¯æ¨¡ç³Šå', fontsize=12)
axes[0, 2].axis('off')

# Sobel
axes[1, 0].imshow(sobel, cmap='gray')
axes[1, 0].set_title('Sobel\nï¼ˆè¾¹ç¼˜è¾ƒç²—ï¼‰', fontsize=12)
axes[1, 0].axis('off')

# Laplacian
axes[1, 1].imshow(laplacian, cmap='gray')
axes[1, 1].set_title('Laplacian\nï¼ˆè¾¹ç¼˜ä¸è¿ç»­ï¼‰', fontsize=12)
axes[1, 1].axis('off')

# å¯¹æ¯”è¯´æ˜
axes[1, 2].axis('off')
info = """
Cannyè¾¹ç¼˜æ£€æµ‹çš„ä¼˜åŠ¿ï¼š

âœ“ è¾¹ç¼˜ç»†ï¼ˆå•åƒç´ å®½ï¼‰
âœ“ è¾¹ç¼˜è¿ç»­
âœ“ å™ªå£°æŠ‘åˆ¶å¥½
âœ“ å®šä½å‡†ç¡®

ä½¿ç”¨æ–¹æ³•ï¼š
edges = cv2.Canny(img, 50, 150)

å‚æ•°è¯´æ˜ï¼š
â€¢ 50: ä½é˜ˆå€¼
â€¢ 150: é«˜é˜ˆå€¼
â€¢ æ¨èï¼šé«˜é˜ˆå€¼ = 2~3 Ã— ä½é˜ˆå€¼

æ ‡å‡†å¤„ç†æµç¨‹ï¼š
1. é«˜æ–¯æ¨¡ç³Šï¼ˆå¯é€‰ï¼‰
2. Cannyè¾¹ç¼˜æ£€æµ‹
"""
axes[1, 2].text(0.1, 0.5, info, fontsize=10,
                verticalalignment='center', fontfamily='SimHei',
                bbox=dict(boxstyle='round', facecolor='lightgreen', alpha=0.5))

plt.suptitle('Cannyè¾¹ç¼˜æ£€æµ‹åŸºç¡€', fontsize=14, fontweight='bold')
plt.tight_layout()
plt.savefig('canny_basic.png', dpi=150, bbox_inches='tight')
plt.show()

print("\nå›¾åƒå·²ä¿å­˜ä¸º 'canny_basic.png'")
```

---

### ä»£ç 2ï¼šé˜ˆå€¼å‚æ•°çš„å½±å“

```python
"""
æ¼”ç¤ºCannyç®—æ³•ä¸­é˜ˆå€¼å‚æ•°å¯¹ç»“æœçš„å½±å“
"""

import cv2
import numpy as np
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei']
plt.rcParams['axes.unicode_minus'] = False

# ===================== åˆ›å»ºæµ‹è¯•å›¾åƒ =====================

def create_complex_image():
    """åˆ›å»ºå¤æ‚æµ‹è¯•å›¾åƒ"""
    img = np.zeros((300, 400), dtype=np.uint8)

    # æ¸å˜èƒŒæ™¯
    for x in range(400):
        img[:, x] = 60 + int(x * 0.2)

    # å½¢çŠ¶
    cv2.rectangle(img, (50, 50), (150, 150), 200, -1)
    cv2.circle(img, (280, 100), 50, 220, -1)

    # ç»†çº¿æ¡
    cv2.line(img, (50, 200), (200, 280), 180, 2)
    cv2.line(img, (220, 200), (370, 280), 180, 2)

    # ä½å¯¹æ¯”åº¦å½¢çŠ¶
    cv2.rectangle(img, (250, 180), (350, 250), 130, -1)

    # æ·»åŠ å™ªå£°
    noise = np.random.normal(0, 10, img.shape)
    img = np.clip(img.astype(np.float64) + noise, 0, 255).astype(np.uint8)

    return img

img = create_complex_image()

# é«˜æ–¯æ¨¡ç³Š
img_blur = cv2.GaussianBlur(img, (5, 5), 1.0)

print("æµ‹è¯•å›¾åƒå·²åˆ›å»º")

# ===================== ä¸åŒé˜ˆå€¼çš„æ•ˆæœ =====================

threshold_pairs = [
    (10, 30),    # éå¸¸ä½
    (30, 90),    # ä½
    (50, 150),   # ä¸­ç­‰ï¼ˆæ¨èï¼‰
    (100, 200),  # é«˜
    (150, 300),  # éå¸¸é«˜
]

results = {}
for t1, t2 in threshold_pairs:
    edges = cv2.Canny(img_blur, t1, t2)
    results[(t1, t2)] = edges
    edge_count = np.sum(edges > 0)
    print(f"é˜ˆå€¼ ({t1:3d}, {t2:3d}): {edge_count:6d} ä¸ªè¾¹ç¼˜åƒç´ ")

# ===================== å¯è§†åŒ– =====================

fig, axes = plt.subplots(2, 3, figsize=(15, 10))

# åŸå›¾
axes[0, 0].imshow(img, cmap='gray')
axes[0, 0].set_title('åŸå§‹å›¾åƒï¼ˆå¸¦å™ªå£°ï¼‰', fontsize=11)
axes[0, 0].axis('off')

# ä¸åŒé˜ˆå€¼
for i, (t1, t2) in enumerate(threshold_pairs):
    row = (i + 1) // 3
    col = (i + 1) % 3
    axes[row, col].imshow(results[(t1, t2)], cmap='gray')

    if (t1, t2) == (50, 150):
        title = f'é˜ˆå€¼ ({t1}, {t2})\nâœ“ æ¨è'
        color = 'green'
    elif t1 < 30:
        title = f'é˜ˆå€¼ ({t1}, {t2})\nå™ªå£°è¾ƒå¤š'
        color = 'orange'
    elif t1 > 100:
        title = f'é˜ˆå€¼ ({t1}, {t2})\nè¾¹ç¼˜ä¸¢å¤±'
        color = 'red'
    else:
        title = f'é˜ˆå€¼ ({t1}, {t2})'
        color = 'black'

    axes[row, col].set_title(title, fontsize=11, color=color)
    axes[row, col].axis('off')

plt.suptitle('Cannyé˜ˆå€¼å‚æ•°çš„å½±å“', fontsize=14, fontweight='bold')
plt.tight_layout()
plt.savefig('canny_thresholds.png', dpi=150, bbox_inches='tight')
plt.show()

# ç»˜åˆ¶è¾¹ç¼˜åƒç´ æ•°é‡å˜åŒ–
fig, ax = plt.subplots(figsize=(10, 5))

thresholds = [f"({t1},{t2})" for t1, t2 in threshold_pairs]
counts = [np.sum(results[(t1, t2)] > 0) for t1, t2 in threshold_pairs]

bars = ax.bar(thresholds, counts, color=['orange', 'yellow', 'green', 'yellow', 'red'])
ax.set_xlabel('é˜ˆå€¼ (ä½, é«˜)', fontsize=12)
ax.set_ylabel('è¾¹ç¼˜åƒç´ æ•°é‡', fontsize=12)
ax.set_title('ä¸åŒé˜ˆå€¼ä¸‹çš„è¾¹ç¼˜åƒç´ æ•°é‡', fontsize=14, fontweight='bold')

# æ ‡æ³¨æ¨èé˜ˆå€¼
bars[2].set_color('green')
ax.annotate('æ¨è', xy=(2, counts[2]), xytext=(2.3, counts[2]*1.1),
            fontsize=12, fontfamily='SimHei',
            arrowprops=dict(arrowstyle='->', color='green'))

plt.tight_layout()
plt.savefig('canny_threshold_counts.png', dpi=150, bbox_inches='tight')
plt.show()

print("\nå¯¹æ¯”å›¾å·²ä¿å­˜")
```

---

### ä»£ç 3ï¼šCannyå¤„ç†æµç¨‹å¯è§†åŒ–

```python
"""
å¯è§†åŒ–Cannyè¾¹ç¼˜æ£€æµ‹çš„å†…éƒ¨å¤„ç†æµç¨‹
å±•ç¤ºæ¯ä¸ªæ­¥éª¤çš„æ•ˆæœ
"""

import cv2
import numpy as np
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei']
plt.rcParams['axes.unicode_minus'] = False

# ===================== åˆ›å»ºæµ‹è¯•å›¾åƒ =====================

def create_simple_image():
    """åˆ›å»ºç®€å•æµ‹è¯•å›¾åƒ"""
    img = np.zeros((200, 300), dtype=np.uint8)
    img[:] = 60

    # çŸ©å½¢
    cv2.rectangle(img, (50, 50), (150, 150), 200, -1)

    # åœ†å½¢
    cv2.circle(img, (220, 100), 40, 180, -1)

    # æ·»åŠ å°‘é‡å™ªå£°
    noise = np.random.normal(0, 8, img.shape)
    img = np.clip(img.astype(np.float64) + noise, 0, 255).astype(np.uint8)

    return img

img = create_simple_image()

print("æ¨¡æ‹ŸCannyçš„å¤„ç†æµç¨‹...")

# ===================== æ­¥éª¤1ï¼šé«˜æ–¯æ»¤æ³¢ =====================

step1_gaussian = cv2.GaussianBlur(img, (5, 5), 1.4)

# ===================== æ­¥éª¤2ï¼šæ¢¯åº¦è®¡ç®— =====================

sobel_x = cv2.Sobel(step1_gaussian, cv2.CV_64F, 1, 0, ksize=3)
sobel_y = cv2.Sobel(step1_gaussian, cv2.CV_64F, 0, 1, ksize=3)

step2_magnitude = np.sqrt(sobel_x**2 + sobel_y**2)
step2_direction = np.arctan2(sobel_y, sobel_x) * 180 / np.pi

# ===================== æ­¥éª¤3ï¼šéæå¤§å€¼æŠ‘åˆ¶ï¼ˆç®€åŒ–ç‰ˆï¼‰ =====================

def non_max_suppression(magnitude, direction):
    """ç®€åŒ–çš„éæå¤§å€¼æŠ‘åˆ¶"""
    rows, cols = magnitude.shape
    result = np.zeros_like(magnitude)

    # å°†æ–¹å‘é‡åŒ–åˆ°4ä¸ªä¸»æ–¹å‘
    direction = direction % 180

    for i in range(1, rows-1):
        for j in range(1, cols-1):
            angle = direction[i, j]

            # ç¡®å®šæ¯”è¾ƒçš„é‚»å±…
            if (0 <= angle < 22.5) or (157.5 <= angle <= 180):
                neighbors = [magnitude[i, j-1], magnitude[i, j+1]]
            elif 22.5 <= angle < 67.5:
                neighbors = [magnitude[i-1, j+1], magnitude[i+1, j-1]]
            elif 67.5 <= angle < 112.5:
                neighbors = [magnitude[i-1, j], magnitude[i+1, j]]
            else:
                neighbors = [magnitude[i-1, j-1], magnitude[i+1, j+1]]

            # å¦‚æœæ˜¯å±€éƒ¨æœ€å¤§å€¼ï¼Œä¿ç•™
            if magnitude[i, j] >= max(neighbors):
                result[i, j] = magnitude[i, j]

    return result

step3_nms = non_max_suppression(step2_magnitude, step2_direction)

# ===================== æ­¥éª¤4&5ï¼šåŒé˜ˆå€¼å’Œè¾¹ç¼˜è¿æ¥ =====================

def double_threshold_and_linking(nms, low_thresh, high_thresh):
    """åŒé˜ˆå€¼æ£€æµ‹å’Œè¾¹ç¼˜è¿æ¥"""
    rows, cols = nms.shape
    result = np.zeros_like(nms, dtype=np.uint8)

    # æ ‡è®°å¼ºè¾¹ç¼˜å’Œå¼±è¾¹ç¼˜
    strong = 255
    weak = 75

    strong_i, strong_j = np.where(nms >= high_thresh)
    weak_i, weak_j = np.where((nms >= low_thresh) & (nms < high_thresh))

    result[strong_i, strong_j] = strong
    result[weak_i, weak_j] = weak

    # è¾¹ç¼˜è¿æ¥ï¼šå¼±è¾¹ç¼˜ä¸å¼ºè¾¹ç¼˜è¿é€šåˆ™ä¿ç•™
    for i in range(1, rows-1):
        for j in range(1, cols-1):
            if result[i, j] == weak:
                # æ£€æŸ¥8é‚»åŸŸæ˜¯å¦æœ‰å¼ºè¾¹ç¼˜
                if np.any(result[i-1:i+2, j-1:j+2] == strong):
                    result[i, j] = strong
                else:
                    result[i, j] = 0

    return result, (strong_i, strong_j), (weak_i, weak_j)

low_thresh = 50
high_thresh = 150

step4_threshold, strong_pos, weak_pos = double_threshold_and_linking(
    step3_nms, low_thresh, high_thresh)

# æœ€ç»ˆç»“æœ
step5_final = (step4_threshold == 255).astype(np.uint8) * 255

# OpenCVçš„Cannyç»“æœï¼ˆå¯¹æ¯”ï¼‰
opencv_canny = cv2.Canny(img, low_thresh, high_thresh)

# ===================== å¯è§†åŒ– =====================

fig, axes = plt.subplots(2, 4, figsize=(16, 8))

# æ­¥éª¤1
axes[0, 0].imshow(img, cmap='gray')
axes[0, 0].set_title('åŸå§‹å›¾åƒ', fontsize=11)
axes[0, 0].axis('off')

axes[0, 1].imshow(step1_gaussian, cmap='gray')
axes[0, 1].set_title('æ­¥éª¤1: é«˜æ–¯æ»¤æ³¢', fontsize=11)
axes[0, 1].axis('off')

# æ­¥éª¤2
axes[0, 2].imshow(step2_magnitude, cmap='gray', vmax=300)
axes[0, 2].set_title('æ­¥éª¤2: æ¢¯åº¦å¹…å€¼', fontsize=11)
axes[0, 2].axis('off')

im = axes[0, 3].imshow(step2_direction, cmap='hsv', vmin=-180, vmax=180)
axes[0, 3].set_title('æ­¥éª¤2: æ¢¯åº¦æ–¹å‘', fontsize=11)
axes[0, 3].axis('off')

# æ­¥éª¤3
axes[1, 0].imshow(step3_nms, cmap='gray', vmax=300)
axes[1, 0].set_title('æ­¥éª¤3: éæå¤§å€¼æŠ‘åˆ¶', fontsize=11)
axes[1, 0].axis('off')

# æ­¥éª¤4
axes[1, 1].imshow(step4_threshold, cmap='gray')
axes[1, 1].set_title('æ­¥éª¤4: åŒé˜ˆå€¼\nç™½=å¼ºè¾¹ç¼˜ï¼Œç°=å¼±è¾¹ç¼˜', fontsize=11)
axes[1, 1].axis('off')

# æ­¥éª¤5
axes[1, 2].imshow(step5_final, cmap='gray')
axes[1, 2].set_title('æ­¥éª¤5: è¾¹ç¼˜è¿æ¥\nï¼ˆç®€åŒ–å®ç°ï¼‰', fontsize=11)
axes[1, 2].axis('off')

# OpenCV Canny
axes[1, 3].imshow(opencv_canny, cmap='gray')
axes[1, 3].set_title('OpenCV Canny\nï¼ˆå®˜æ–¹å®ç°ï¼‰', fontsize=11)
axes[1, 3].axis('off')

plt.suptitle('Cannyè¾¹ç¼˜æ£€æµ‹å¤„ç†æµç¨‹', fontsize=14, fontweight='bold')
plt.tight_layout()
plt.savefig('canny_steps.png', dpi=150, bbox_inches='tight')
plt.show()

print("\nå¤„ç†æµç¨‹å›¾å·²ä¿å­˜ä¸º 'canny_steps.png'")
```

---

### ä»£ç 4ï¼šè‡ªåŠ¨é˜ˆå€¼é€‰æ‹©

```python
"""
Cannyè¾¹ç¼˜æ£€æµ‹çš„è‡ªåŠ¨é˜ˆå€¼é€‰æ‹©æ–¹æ³•
"""

import cv2
import numpy as np
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei']
plt.rcParams['axes.unicode_minus'] = False

# ===================== åˆ›å»ºæµ‹è¯•å›¾åƒ =====================

def create_test_image():
    """åˆ›å»ºæµ‹è¯•å›¾åƒ"""
    img = np.zeros((300, 400), dtype=np.uint8)

    # ä¸åŒç°åº¦çš„åŒºåŸŸ
    img[:150, :200] = 80
    img[:150, 200:] = 120
    img[150:, :200] = 160
    img[150:, 200:] = 200

    # æ·»åŠ å½¢çŠ¶
    cv2.circle(img, (100, 75), 40, 200, -1)
    cv2.rectangle(img, (250, 30), (350, 130), 60, -1)
    cv2.circle(img, (100, 220), 40, 60, -1)
    cv2.rectangle(img, (250, 180), (350, 280), 220, -1)

    # æ·»åŠ å™ªå£°
    noise = np.random.normal(0, 10, img.shape)
    img = np.clip(img.astype(np.float64) + noise, 0, 255).astype(np.uint8)

    return img

img = create_test_image()

# é«˜æ–¯æ¨¡ç³Š
img_blur = cv2.GaussianBlur(img, (5, 5), 1.0)

print("æµ‹è¯•å›¾åƒå·²åˆ›å»º")

# ===================== è‡ªåŠ¨é˜ˆå€¼æ–¹æ³• =====================

def auto_canny_median(img, sigma=0.33):
    """åŸºäºä¸­å€¼çš„è‡ªåŠ¨é˜ˆå€¼"""
    median = np.median(img)
    lower = int(max(0, (1.0 - sigma) * median))
    upper = int(min(255, (1.0 + sigma) * median))
    return lower, upper

def auto_canny_otsu(img):
    """åŸºäºOtsuçš„è‡ªåŠ¨é˜ˆå€¼"""
    # ä½¿ç”¨Otsuæ–¹æ³•æ‰¾åˆ°æœ€ä½³é˜ˆå€¼
    otsu_thresh, _ = cv2.threshold(img, 0, 255, cv2.THRESH_BINARY + cv2.THRESH_OTSU)
    lower = otsu_thresh * 0.5
    upper = otsu_thresh
    return int(lower), int(upper)

def auto_canny_percentile(img, low_percentile=10, high_percentile=90):
    """åŸºäºç™¾åˆ†ä½æ•°çš„è‡ªåŠ¨é˜ˆå€¼"""
    lower = np.percentile(img, low_percentile)
    upper = np.percentile(img, high_percentile)
    return int(lower), int(upper)

# è®¡ç®—ä¸åŒæ–¹æ³•çš„é˜ˆå€¼
thresh_fixed = (50, 150)
thresh_median = auto_canny_median(img_blur)
thresh_otsu = auto_canny_otsu(img_blur)
thresh_percentile = auto_canny_percentile(img_blur)

print(f"\nä¸åŒæ–¹æ³•è®¡ç®—çš„é˜ˆå€¼ï¼š")
print(f"  å›ºå®šé˜ˆå€¼:     {thresh_fixed}")
print(f"  ä¸­å€¼æ–¹æ³•:     {thresh_median}")
print(f"  Otsuæ–¹æ³•:     {thresh_otsu}")
print(f"  ç™¾åˆ†ä½æ–¹æ³•:   {thresh_percentile}")

# ===================== åº”ç”¨ä¸åŒé˜ˆå€¼ =====================

edges_fixed = cv2.Canny(img_blur, *thresh_fixed)
edges_median = cv2.Canny(img_blur, *thresh_median)
edges_otsu = cv2.Canny(img_blur, *thresh_otsu)
edges_percentile = cv2.Canny(img_blur, *thresh_percentile)

# ===================== å¯è§†åŒ– =====================

fig, axes = plt.subplots(2, 3, figsize=(15, 10))

# åŸå›¾
axes[0, 0].imshow(img, cmap='gray')
axes[0, 0].set_title('åŸå§‹å›¾åƒ', fontsize=11)
axes[0, 0].axis('off')

# ç›´æ–¹å›¾
axes[0, 1].hist(img.ravel(), bins=50, color='steelblue', alpha=0.7)
axes[0, 1].axvline(x=thresh_median[0], color='r', linestyle='--', label=f'ä½é˜ˆå€¼')
axes[0, 1].axvline(x=thresh_median[1], color='g', linestyle='--', label=f'é«˜é˜ˆå€¼')
axes[0, 1].set_title('ç°åº¦ç›´æ–¹å›¾', fontsize=11)
axes[0, 1].set_xlabel('ç°åº¦å€¼')
axes[0, 1].set_ylabel('åƒç´ æ•°')
axes[0, 1].legend()

# å›ºå®šé˜ˆå€¼
axes[0, 2].imshow(edges_fixed, cmap='gray')
axes[0, 2].set_title(f'å›ºå®šé˜ˆå€¼ {thresh_fixed}', fontsize=11)
axes[0, 2].axis('off')

# ä¸­å€¼æ–¹æ³•
axes[1, 0].imshow(edges_median, cmap='gray')
axes[1, 0].set_title(f'ä¸­å€¼æ–¹æ³• {thresh_median}\n(Ïƒ=0.33)', fontsize=11)
axes[1, 0].axis('off')

# Otsuæ–¹æ³•
axes[1, 1].imshow(edges_otsu, cmap='gray')
axes[1, 1].set_title(f'Otsuæ–¹æ³• {thresh_otsu}', fontsize=11)
axes[1, 1].axis('off')

# ç™¾åˆ†ä½æ–¹æ³•
axes[1, 2].imshow(edges_percentile, cmap='gray')
axes[1, 2].set_title(f'ç™¾åˆ†ä½æ–¹æ³• {thresh_percentile}\n(10%, 90%)', fontsize=11)
axes[1, 2].axis('off')

plt.suptitle('Cannyè‡ªåŠ¨é˜ˆå€¼é€‰æ‹©æ–¹æ³•', fontsize=14, fontweight='bold')
plt.tight_layout()
plt.savefig('canny_auto_threshold.png', dpi=150, bbox_inches='tight')
plt.show()

# å°è£…æˆå‡½æ•°
def auto_canny(img, sigma=0.33):
    """
    è‡ªåŠ¨Cannyè¾¹ç¼˜æ£€æµ‹
    ä½¿ç”¨åŸºäºä¸­å€¼çš„è‡ªåŠ¨é˜ˆå€¼
    """
    # å…ˆè¿›è¡Œé«˜æ–¯æ¨¡ç³Š
    blurred = cv2.GaussianBlur(img, (5, 5), 1.0)

    # è®¡ç®—è‡ªåŠ¨é˜ˆå€¼
    median = np.median(blurred)
    lower = int(max(0, (1.0 - sigma) * median))
    upper = int(min(255, (1.0 + sigma) * median))

    # åº”ç”¨Canny
    edges = cv2.Canny(blurred, lower, upper)

    return edges

print("\nè‡ªåŠ¨Cannyå‡½æ•°ç¤ºä¾‹ï¼š")
print("  edges = auto_canny(img, sigma=0.33)")
print("\nå›¾åƒå·²ä¿å­˜ä¸º 'canny_auto_threshold.png'")
```

---

### ä»£ç 5ï¼šCannyå®é™…åº”ç”¨ç¤ºä¾‹

```python
"""
Cannyè¾¹ç¼˜æ£€æµ‹çš„å®é™…åº”ç”¨ç¤ºä¾‹
åŒ…æ‹¬ï¼šè½®å»“æ£€æµ‹ã€æ–‡æ¡£è¾¹ç¼˜ã€ç‰©ä½“æ£€æµ‹ç­‰
"""

import cv2
import numpy as np
import matplotlib.pyplot as plt

plt.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei']
plt.rcParams['axes.unicode_minus'] = False

# ===================== åˆ›å»ºæ¨¡æ‹Ÿåœºæ™¯ =====================

def create_document_image():
    """åˆ›å»ºæ¨¡æ‹Ÿçš„æ–‡æ¡£å›¾åƒ"""
    img = np.ones((400, 300, 3), dtype=np.uint8) * 180  # ç°è‰²èƒŒæ™¯

    # ç™½è‰²æ–‡æ¡£
    pts = np.array([[50, 50], [250, 30], [270, 350], [30, 370]], np.int32)
    cv2.fillPoly(img, [pts], (255, 255, 255))

    # æ–‡å­—è¡Œï¼ˆç”¨çŸ©å½¢æ¨¡æ‹Ÿï¼‰
    for y in range(80, 320, 30):
        width = np.random.randint(100, 180)
        cv2.rectangle(img, (70, y), (70+width, y+15), (50, 50, 50), -1)

    return img

def create_object_image():
    """åˆ›å»ºæ¨¡æ‹Ÿçš„ç‰©ä½“å›¾åƒ"""
    img = np.zeros((300, 400, 3), dtype=np.uint8)

    # æ¸å˜èƒŒæ™¯
    for y in range(300):
        img[y, :] = [80 + y//4, 100 + y//5, 120 + y//6]

    # ç‰©ä½“1ï¼šæ¯å­
    cv2.ellipse(img, (100, 200), (40, 20), 0, 0, 360, (200, 180, 160), -1)
    cv2.rectangle(img, (60, 100), (140, 200), (200, 180, 160), -1)
    cv2.ellipse(img, (100, 100), (40, 15), 0, 0, 360, (220, 200, 180), -1)

    # ç‰©ä½“2ï¼šç›’å­
    pts = np.array([[200, 250], [200, 150], [280, 120], [350, 150],
                    [350, 250], [280, 280]], np.int32)
    cv2.fillPoly(img, [pts], (100, 150, 200))
    cv2.line(img, (280, 120), (280, 280), (80, 130, 180), 2)

    # ç‰©ä½“3ï¼šçƒ
    cv2.circle(img, (320, 80), 35, (200, 100, 100), -1)

    return img

# åˆ›å»ºå›¾åƒ
doc_img = create_document_image()
obj_img = create_object_image()

# ===================== åº”ç”¨1ï¼šæ–‡æ¡£è¾¹ç¼˜æ£€æµ‹ =====================

doc_gray = cv2.cvtColor(doc_img, cv2.COLOR_BGR2GRAY)
doc_blur = cv2.GaussianBlur(doc_gray, (5, 5), 1.0)
doc_edges = cv2.Canny(doc_blur, 50, 150)

# æ‰¾è½®å»“
contours, _ = cv2.findContours(doc_edges, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)

# æ‰¾æœ€å¤§è½®å»“ï¼ˆæ–‡æ¡£ï¼‰
if contours:
    largest_contour = max(contours, key=cv2.contourArea)
    # è¿‘ä¼¼å¤šè¾¹å½¢
    epsilon = 0.02 * cv2.arcLength(largest_contour, True)
    approx = cv2.approxPolyDP(largest_contour, epsilon, True)

    # ç»˜åˆ¶ç»“æœ
    doc_result = doc_img.copy()
    cv2.drawContours(doc_result, [approx], -1, (0, 255, 0), 3)

    # æ ‡è®°è§’ç‚¹
    for point in approx:
        cv2.circle(doc_result, tuple(point[0]), 8, (0, 0, 255), -1)

# ===================== åº”ç”¨2ï¼šç‰©ä½“è½®å»“æ£€æµ‹ =====================

obj_gray = cv2.cvtColor(obj_img, cv2.COLOR_BGR2GRAY)
obj_blur = cv2.GaussianBlur(obj_gray, (5, 5), 1.0)
obj_edges = cv2.Canny(obj_blur, 30, 100)

# æ‰¾è½®å»“
obj_contours, _ = cv2.findContours(obj_edges, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)

# ç»˜åˆ¶æ‰€æœ‰è½®å»“
obj_result = obj_img.copy()
cv2.drawContours(obj_result, obj_contours, -1, (0, 255, 0), 2)

# ä¸ºæ¯ä¸ªè½®å»“ç”»è¾¹ç•Œæ¡†
for cnt in obj_contours:
    if cv2.contourArea(cnt) > 500:  # è¿‡æ»¤å°è½®å»“
        x, y, w, h = cv2.boundingRect(cnt)
        cv2.rectangle(obj_result, (x, y), (x+w, y+h), (255, 0, 0), 2)

# ===================== åº”ç”¨3ï¼šè¾¹ç¼˜å åŠ æ•ˆæœ =====================

def edge_overlay_effect(img, low_thresh=50, high_thresh=150):
    """è¾¹ç¼˜å åŠ è‰ºæœ¯æ•ˆæœ"""
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    blur = cv2.GaussianBlur(gray, (5, 5), 1.0)
    edges = cv2.Canny(blur, low_thresh, high_thresh)

    # è†¨èƒ€è¾¹ç¼˜ä½¿å…¶æ›´æ˜æ˜¾
    kernel = np.ones((2, 2), np.uint8)
    edges = cv2.dilate(edges, kernel, iterations=1)

    # å åŠ åˆ°åŸå›¾ï¼ˆé»‘è‰²è¾¹ç¼˜ï¼‰
    result = img.copy()
    result[edges > 0] = [0, 0, 0]

    return result, edges

obj_overlay, _ = edge_overlay_effect(obj_img)

# ===================== å¯è§†åŒ– =====================

fig, axes = plt.subplots(2, 4, figsize=(16, 8))

# æ–‡æ¡£å¤„ç†
axes[0, 0].imshow(cv2.cvtColor(doc_img, cv2.COLOR_BGR2RGB))
axes[0, 0].set_title('åŸå§‹æ–‡æ¡£å›¾åƒ', fontsize=11)
axes[0, 0].axis('off')

axes[0, 1].imshow(doc_edges, cmap='gray')
axes[0, 1].set_title('Cannyè¾¹ç¼˜', fontsize=11)
axes[0, 1].axis('off')

axes[0, 2].imshow(cv2.cvtColor(doc_result, cv2.COLOR_BGR2RGB))
axes[0, 2].set_title('æ–‡æ¡£è½®å»“æ£€æµ‹\nï¼ˆç»¿è‰²è¾¹æ¡†ï¼Œçº¢è‰²è§’ç‚¹ï¼‰', fontsize=11)
axes[0, 2].axis('off')

# è¯´æ˜
axes[0, 3].axis('off')
info1 = """
æ–‡æ¡£è¾¹ç¼˜æ£€æµ‹åº”ç”¨ï¼š

1. Cannyæ£€æµ‹è¾¹ç¼˜
2. æŸ¥æ‰¾è½®å»“
3. å¤šè¾¹å½¢è¿‘ä¼¼
4. æå–æ–‡æ¡£å››è§’

åº”ç”¨åœºæ™¯ï¼š
â€¢ æ‰«æä»ªåº”ç”¨
â€¢ æ–‡æ¡£æ ¡æ­£
â€¢ OCRé¢„å¤„ç†
"""
axes[0, 3].text(0.1, 0.5, info1, fontsize=9,
                verticalalignment='center', fontfamily='SimHei',
                bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.5))

# ç‰©ä½“å¤„ç†
axes[1, 0].imshow(cv2.cvtColor(obj_img, cv2.COLOR_BGR2RGB))
axes[1, 0].set_title('åŸå§‹ç‰©ä½“å›¾åƒ', fontsize=11)
axes[1, 0].axis('off')

axes[1, 1].imshow(obj_edges, cmap='gray')
axes[1, 1].set_title('Cannyè¾¹ç¼˜', fontsize=11)
axes[1, 1].axis('off')

axes[1, 2].imshow(cv2.cvtColor(obj_result, cv2.COLOR_BGR2RGB))
axes[1, 2].set_title('ç‰©ä½“è½®å»“æ£€æµ‹\nï¼ˆç»¿è‰²è½®å»“ï¼Œè“è‰²è¾¹ç•Œæ¡†ï¼‰', fontsize=11)
axes[1, 2].axis('off')

axes[1, 3].imshow(cv2.cvtColor(obj_overlay, cv2.COLOR_BGR2RGB))
axes[1, 3].set_title('è¾¹ç¼˜å åŠ æ•ˆæœ\nï¼ˆè‰ºæœ¯æ•ˆæœï¼‰', fontsize=11)
axes[1, 3].axis('off')

plt.suptitle('Cannyè¾¹ç¼˜æ£€æµ‹å®é™…åº”ç”¨', fontsize=14, fontweight='bold')
plt.tight_layout()
plt.savefig('canny_applications.png', dpi=150, bbox_inches='tight')
plt.show()

print("\nåº”ç”¨ç¤ºä¾‹å›¾å·²ä¿å­˜ä¸º 'canny_applications.png'")
```

---

### ä»£ç 6ï¼šCannyå‚æ•°è°ƒèŠ‚å·¥å…·

```python
"""
äº¤äº’å¼Cannyè¾¹ç¼˜æ£€æµ‹å‚æ•°è°ƒèŠ‚å·¥å…·
å®æ—¶è°ƒæ•´é˜ˆå€¼è§‚å¯Ÿæ•ˆæœ
"""

import cv2
import numpy as np

# ===================== åˆ›å»ºæµ‹è¯•å›¾åƒ =====================

def create_test_image():
    """åˆ›å»ºæµ‹è¯•å›¾åƒ"""
    img = np.zeros((400, 500), dtype=np.uint8)
    img[:] = 80

    # å„ç§å½¢çŠ¶
    cv2.rectangle(img, (50, 50), (150, 150), 200, -1)
    cv2.circle(img, (280, 100), 50, 180, -1)
    cv2.ellipse(img, (400, 100), (60, 40), 0, 0, 360, 220, -1)

    # çº¿æ¡
    cv2.line(img, (50, 200), (200, 350), 200, 5)
    cv2.line(img, (200, 200), (50, 350), 200, 5)

    # å¤šè¾¹å½¢
    pts = np.array([[300, 200], [250, 300], [300, 380], [400, 350], [420, 250]], np.int32)
    cv2.fillPoly(img, [pts], 180)

    # æ·»åŠ å™ªå£°
    noise = np.random.normal(0, 10, img.shape)
    img = np.clip(img.astype(np.float64) + noise, 0, 255).astype(np.uint8)

    return img

# å…¨å±€å˜é‡
img = create_test_image()
threshold1 = 50
threshold2 = 150
blur_size = 5

def nothing(x):
    pass

def update_display():
    """æ›´æ–°æ˜¾ç¤º"""
    global img, threshold1, threshold2, blur_size

    # è·å–å‚æ•°
    threshold1 = cv2.getTrackbarPos('Low Threshold', 'Canny Edge Detection')
    threshold2 = cv2.getTrackbarPos('High Threshold', 'Canny Edge Detection')
    blur_size = cv2.getTrackbarPos('Blur Size', 'Canny Edge Detection')

    # ç¡®ä¿blur_sizeæ˜¯å¥‡æ•°ä¸”å¤§äº0
    if blur_size % 2 == 0:
        blur_size += 1
    if blur_size < 1:
        blur_size = 1

    # é«˜æ–¯æ¨¡ç³Š
    blurred = cv2.GaussianBlur(img, (blur_size, blur_size), 0)

    # Cannyè¾¹ç¼˜æ£€æµ‹
    edges = cv2.Canny(blurred, threshold1, threshold2)

    # è®¡ç®—è¾¹ç¼˜åƒç´ æ•°é‡
    edge_count = np.sum(edges > 0)

    # åˆ›å»ºæ˜¾ç¤ºå›¾åƒ
    # å·¦è¾¹ï¼šåŸå›¾ï¼Œå³è¾¹ï¼šè¾¹ç¼˜
    display = np.hstack([img, edges])
    display = cv2.cvtColor(display, cv2.COLOR_GRAY2BGR)

    # æ·»åŠ æ–‡å­—ä¿¡æ¯
    cv2.putText(display, 'Original', (10, 30),
                cv2.FONT_HERSHEY_SIMPLEX, 0.8, (0, 255, 0), 2)
    cv2.putText(display, f'Canny (t1={threshold1}, t2={threshold2})', (510, 30),
                cv2.FONT_HERSHEY_SIMPLEX, 0.8, (0, 255, 0), 2)
    cv2.putText(display, f'Blur: {blur_size}x{blur_size}', (510, 60),
                cv2.FONT_HERSHEY_SIMPLEX, 0.6, (0, 200, 200), 2)
    cv2.putText(display, f'Edge pixels: {edge_count}', (510, 90),
                cv2.FONT_HERSHEY_SIMPLEX, 0.6, (0, 200, 200), 2)

    # æ˜¾ç¤ºé˜ˆå€¼æ¯”ä¾‹æç¤º
    if threshold2 > 0:
        ratio = threshold2 / max(1, threshold1)
        color = (0, 255, 0) if 2 <= ratio <= 3 else (0, 0, 255)
        cv2.putText(display, f'Ratio: {ratio:.1f} (recommend 2-3)', (10, 390),
                    cv2.FONT_HERSHEY_SIMPLEX, 0.6, color, 2)

    cv2.imshow('Canny Edge Detection', display)

# ===================== åˆ›å»ºçª—å£ =====================

cv2.namedWindow('Canny Edge Detection', cv2.WINDOW_NORMAL)
cv2.resizeWindow('Canny Edge Detection', 1000, 450)

# åˆ›å»ºtrackbar
cv2.createTrackbar('Low Threshold', 'Canny Edge Detection', 50, 300, nothing)
cv2.createTrackbar('High Threshold', 'Canny Edge Detection', 150, 300, nothing)
cv2.createTrackbar('Blur Size', 'Canny Edge Detection', 5, 31, nothing)

print("=" * 60)
print("Cannyè¾¹ç¼˜æ£€æµ‹å‚æ•°è°ƒèŠ‚å·¥å…·")
print("=" * 60)
print("\nå‚æ•°è¯´æ˜ï¼š")
print("  Low Threshold:  ä½é˜ˆå€¼ï¼ˆå¼±è¾¹ç¼˜ï¼‰")
print("  High Threshold: é«˜é˜ˆå€¼ï¼ˆå¼ºè¾¹ç¼˜ï¼‰")
print("  Blur Size:      é«˜æ–¯æ¨¡ç³Šæ ¸å¤§å°")
print("\nè°ƒèŠ‚å»ºè®®ï¼š")
print("  â€¢ é«˜é˜ˆå€¼ = 2~3 Ã— ä½é˜ˆå€¼")
print("  â€¢ æ¯”ä¾‹åœ¨2-3ä¹‹é—´æ—¶æ˜¾ç¤ºç»¿è‰²")
print("  â€¢ Blur Size æ ¹æ®å™ªå£°ç¨‹åº¦è°ƒæ•´")
print("\næŒ‰ 'q' æˆ– ESC é€€å‡º")
print("æŒ‰ 's' ä¿å­˜å½“å‰ç»“æœ")
print("=" * 60)

# ===================== ä¸»å¾ªç¯ =====================

while True:
    update_display()

    key = cv2.waitKey(100) & 0xFF
    if key == ord('q') or key == 27:
        break
    elif key == ord('s'):
        # ä¿å­˜å½“å‰ç»“æœ
        blurred = cv2.GaussianBlur(img, (blur_size, blur_size), 0)
        edges = cv2.Canny(blurred, threshold1, threshold2)
        cv2.imwrite('canny_result.png', edges)
        print(f"\nç»“æœå·²ä¿å­˜ï¼šcanny_result.png")
        print(f"å‚æ•°ï¼šLow={threshold1}, High={threshold2}, Blur={blur_size}")

cv2.destroyAllWindows()

print("\nç¨‹åºå·²é€€å‡º")
print(f"æœ€ç»ˆå‚æ•°: Low={threshold1}, High={threshold2}, Blur={blur_size}")
```

---

## ğŸ“ æœ¬èŠ‚æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Cannyè¾¹ç¼˜æ£€æµ‹æ€»ç»“                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  1. Cannyæ˜¯ä»€ä¹ˆï¼Ÿ                                                   â”‚
â”‚     â€¢ å…¬è®¤æ•ˆæœæœ€å¥½çš„è¾¹ç¼˜æ£€æµ‹ç®—æ³•                                   â”‚
â”‚     â€¢ å¤šé˜¶æ®µå¤„ç†æµç¨‹ï¼Œä¸æ˜¯ç®€å•çš„å·ç§¯æ ¸                             â”‚
â”‚     â€¢ è¾“å‡ºç»†ã€è¿ç»­ã€å®šä½å‡†ç¡®çš„è¾¹ç¼˜                                 â”‚
â”‚                                                                    â”‚
â”‚  2. Cannyçš„äº”ä¸ªæ­¥éª¤                                                 â”‚
â”‚     â‘  é«˜æ–¯æ»¤æ³¢ â†’ å¹³æ»‘å™ªå£°                                         â”‚
â”‚     â‘¡ æ¢¯åº¦è®¡ç®— â†’ Sobelè®¡ç®—å¹…å€¼å’Œæ–¹å‘                              â”‚
â”‚     â‘¢ éæå¤§å€¼æŠ‘åˆ¶ â†’ ç»†åŒ–è¾¹ç¼˜ä¸ºå•åƒç´                              â”‚
â”‚     â‘£ åŒé˜ˆå€¼æ£€æµ‹ â†’ åŒºåˆ†å¼º/å¼±è¾¹ç¼˜                                  â”‚
â”‚     â‘¤ è¾¹ç¼˜è¿æ¥ â†’ å¼±è¾¹ç¼˜ä¸å¼ºè¾¹ç¼˜è¿é€šåˆ™ä¿ç•™                         â”‚
â”‚                                                                    â”‚
â”‚  3. OpenCVå‡½æ•°                                                      â”‚
â”‚     edges = cv2.Canny(img, threshold1, threshold2)                 â”‚
â”‚                                                                    â”‚
â”‚  4. é˜ˆå€¼é€‰æ‹©                                                        â”‚
â”‚     â€¢ æ¨èï¼šé«˜é˜ˆå€¼ = 2~3 Ã— ä½é˜ˆå€¼                                  â”‚
â”‚     â€¢ å…¸å‹å€¼ï¼š(50, 150) æˆ– (100, 200)                              â”‚
â”‚     â€¢ è‡ªåŠ¨é˜ˆå€¼ï¼šåŸºäºä¸­å€¼æˆ–Otsu                                     â”‚
â”‚                                                                    â”‚
â”‚  5. Cannyçš„ä¼˜ç‚¹                                                     â”‚
â”‚     âœ“ è¾¹ç¼˜ç»†ï¼ˆå•åƒç´ å®½ï¼‰                                          â”‚
â”‚     âœ“ è¾¹ç¼˜è¿ç»­æ€§å¥½                                                â”‚
â”‚     âœ“ å™ªå£°æŠ‘åˆ¶èƒ½åŠ›å¼º                                              â”‚
â”‚     âœ“ å®šä½ç²¾ç¡®                                                    â”‚
â”‚     âœ“ å‡è¾¹ç¼˜å°‘                                                    â”‚
â”‚                                                                    â”‚
â”‚  6. å…¸å‹åº”ç”¨                                                        â”‚
â”‚     â€¢ æ–‡æ¡£è¾¹ç¼˜æ£€æµ‹                                                 â”‚
â”‚     â€¢ ç‰©ä½“è½®å»“æå–                                                 â”‚
â”‚     â€¢ è½¦é“çº¿æ£€æµ‹                                                   â”‚
â”‚     â€¢ å·¥ä¸šè§†è§‰æ£€æµ‹                                                 â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ç« èŠ‚æ€»ç»“

æ­å–œä½ å®Œæˆäº†ç¬¬09ç« -è¾¹ç¼˜æ£€æµ‹çš„å­¦ä¹ ï¼åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ï¼š

1. **è¾¹ç¼˜æ£€æµ‹ç†è®º**ï¼šç†è§£è¾¹ç¼˜çš„æœ¬è´¨å’Œæ¢¯åº¦çš„æ¦‚å¿µ
2. **Sobelç®—å­**ï¼šç»å…¸çš„ä¸€é˜¶å¯¼æ•°è¾¹ç¼˜æ£€æµ‹
3. **Scharrç®—å­**ï¼šSobelçš„é«˜ç²¾åº¦æ”¹è¿›ç‰ˆ
4. **Laplacianç®—å­**ï¼šäºŒé˜¶å¯¼æ•°è¾¹ç¼˜æ£€æµ‹
5. **Cannyè¾¹ç¼˜æ£€æµ‹**ï¼šå…¬è®¤æœ€ä¼˜çš„è¾¹ç¼˜æ£€æµ‹ç®—æ³•

è¾¹ç¼˜æ£€æµ‹æ˜¯è®¡ç®—æœºè§†è§‰çš„åŸºç¡€ï¼ŒæŒæ¡è¿™äº›æ–¹æ³•åï¼Œä½ å¯ä»¥ç»§ç»­å­¦ä¹ ï¼š
- è½®å»“æ£€æµ‹ä¸åˆ†æ
- éœå¤«å˜æ¢ï¼ˆç›´çº¿/åœ†æ£€æµ‹ï¼‰
- ç‰¹å¾ç‚¹æ£€æµ‹ï¼ˆSIFTã€ORBç­‰ï¼‰

---

> ğŸ’¡ **å­¦ä¹ å»ºè®®**ï¼šåœ¨å®é™…é¡¹ç›®ä¸­ï¼ŒCannyé€šå¸¸æ˜¯é¦–é€‰çš„è¾¹ç¼˜æ£€æµ‹æ–¹æ³•ã€‚è®°ä½ï¼šå…ˆé«˜æ–¯æ¨¡ç³Šï¼Œå†Cannyï¼Œé˜ˆå€¼æ¯”ä¾‹2-3ï¼
