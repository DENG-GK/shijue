# æ•°ç»„å½¢çŠ¶æ“ä½œ

> æ•°ç»„å½¢çŠ¶å˜æ¢åœ¨å›¾åƒé¢„å¤„ç†ä¸­é¢‘ç¹ä½¿ç”¨â€”â€”è°ƒæ•´ç»´åº¦ä»¥é€‚é…æ¨¡å‹è¾“å…¥ã€æ‹¼æ¥å¤šå¼ å›¾åƒã€å±•å¹³æ•°ç»„è¿›è¡Œåˆ†æã€‚æŒæ¡å½¢çŠ¶æ“ä½œï¼Œä½ å°±èƒ½éšå¿ƒæ‰€æ¬²åœ°"å¡‘é€ "æ•°æ®ã€‚

---

## ğŸ“– ç†è®ºéƒ¨åˆ†

### 1. ä¸ºä»€ä¹ˆéœ€è¦å½¢çŠ¶æ“ä½œï¼Ÿ

åœ¨å›¾åƒå¤„ç†å’Œæ·±åº¦å­¦ä¹ ä¸­ï¼Œæ•°æ®ç»å¸¸éœ€è¦"æ¢ä¸ªå½¢çŠ¶"ï¼š

- **æ¨¡å‹è¾“å…¥**ï¼šæ¨¡å‹è¦æ±‚è¾“å…¥ `(1, 3, 224, 224)`ï¼Œä½†ä½ çš„å›¾åƒæ˜¯ `(224, 224, 3)` â†’ éœ€è¦ reshape + transpose
- **å›¾åƒæ‹¼æ¥**ï¼šæŠŠå¤šå¼ å›¾åƒæ‹¼æˆä¸€å¼ å¤§å›¾ â†’ éœ€è¦ concatenate / stack
- **ç‰¹å¾å±•å¹³**ï¼šæŠŠäºŒç»´çš„ç‰¹å¾å›¾å˜æˆä¸€ç»´å‘é‡é€å…¥å…¨è¿æ¥å±‚ â†’ éœ€è¦ flatten
- **æ‰¹é‡å¤„ç†**ï¼šå¤šå¼ å›¾åƒæ‰“åŒ…æˆä¸€ä¸ªæ‰¹æ¬¡ â†’ éœ€è¦ stack

---

### 2. æŸ¥çœ‹å’Œæ”¹å˜å½¢çŠ¶

#### 2.1 reshape()ï¼šæ”¹å˜å½¢çŠ¶

`reshape()` æ˜¯æœ€å¸¸ç”¨çš„å½¢çŠ¶æ“ä½œå‡½æ•°ï¼Œå®ƒæŠŠæ•°ç»„é‡æ–°æ’åˆ—æˆæ–°çš„å½¢çŠ¶ï¼Œ**å…ƒç´ æ€»æ•°å¿…é¡»ä¿æŒä¸å˜**ã€‚

```python
import numpy as np

# ä¸€ç»´ â†’ äºŒç»´
arr = np.arange(12)   # [0, 1, 2, ..., 11]
print(arr.shape)      # (12,)

matrix = arr.reshape(3, 4)   # å˜æˆ 3è¡Œ4åˆ—
print(matrix)
# [[ 0  1  2  3]
#  [ 4  5  6  7]
#  [ 8  9 10 11]]

# ä¹Ÿå¯ä»¥å†™æˆ
matrix = arr.reshape((3, 4))   # å…ƒç»„å½¢å¼ï¼Œæ•ˆæœç›¸åŒ
```

**ä½¿ç”¨ -1 è‡ªåŠ¨è®¡ç®—æŸä¸ªç»´åº¦ï¼š**

```python
arr = np.arange(12)

# -1 è¡¨ç¤º"è®© NumPy è‡ªåŠ¨ç®—"
print(arr.reshape(3, -1))     # (3, 4)  â†’ 12Ã·3=4
print(arr.reshape(-1, 6))     # (2, 6)  â†’ 12Ã·6=2
print(arr.reshape(2, -1, 3))  # (2, 2, 3) â†’ 12Ã·2Ã·3=2
```

> ğŸ’¡ **-1 çš„å«ä¹‰ï¼š** åªèƒ½æœ‰ä¸€ä¸ªç»´åº¦è®¾ä¸º -1ï¼ŒNumPy ä¼šæ ¹æ®æ€»å…ƒç´ æ•°å’Œå…¶ä»–ç»´åº¦è‡ªåŠ¨è®¡ç®—ã€‚è¿™åœ¨ä¸ç¡®å®šæŸä¸ªç»´åº¦å¤§å°æ—¶ç‰¹åˆ«æ–¹ä¾¿ã€‚

**reshape åœ¨å›¾åƒå¤„ç†ä¸­çš„åº”ç”¨ï¼š**

```python
# åœºæ™¯1ï¼šç°åº¦å›¾åƒæ·»åŠ é€šé“ç»´åº¦ï¼ˆç”¨äºæŸäº›æ¨¡å‹è¾“å…¥ï¼‰
gray = np.zeros((480, 640), dtype=np.uint8)   # (H, W)
gray_3d = gray.reshape(480, 640, 1)           # (H, W, 1)
print(gray_3d.shape)   # (480, 640, 1)

# åœºæ™¯2ï¼šå±•å¹³å›¾åƒç”¨äºæœºå™¨å­¦ä¹ ç‰¹å¾
image = np.random.randint(0, 256, (28, 28), dtype=np.uint8)  # MNISTæ‰‹å†™æ•°å­—
flat = image.reshape(-1)   # å˜æˆä¸€ç»´: (784,)
# ç­‰ä»·äº image.reshape(28*28)

# åœºæ™¯3ï¼šæ·±åº¦å­¦ä¹ æ‰¹é‡è¾“å…¥
# å•å¼ å›¾åƒ (224, 224, 3) â†’ æ·»åŠ æ‰¹æ¬¡ç»´åº¦ (1, 224, 224, 3)
img = np.zeros((224, 224, 3), dtype=np.uint8)
batch = img.reshape(1, 224, 224, 3)
print(batch.shape)   # (1, 224, 224, 3)
```

> âš ï¸ **reshape ä¸æ”¹å˜åŸæ•°ç»„ï¼** å®ƒè¿”å›ä¸€ä¸ªæ–°çš„è§†å›¾ï¼ˆå…±äº«å†…å­˜ï¼‰ã€‚å¦‚æœä½ ä¿®æ”¹ reshape åçš„æ•°ç»„ï¼ŒåŸæ•°ç»„ä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚

```python
arr = np.arange(6)
matrix = arr.reshape(2, 3)
matrix[0, 0] = 999
print(arr)   # [999, 1, 2, 3, 4, 5]  åŸæ•°ç»„ä¹Ÿå˜äº†ï¼
```

#### 2.2 resize()ï¼šåŸåœ°æ”¹å˜å½¢çŠ¶

```python
arr = np.arange(6)

# resize ç›´æ¥ä¿®æ”¹åŸæ•°ç»„ï¼ˆåŸåœ°æ“ä½œï¼‰
arr.resize(2, 3)
print(arr)
# [[0 1 2]
#  [3 4 5]]
print(arr.shape)  # (2, 3)
```

> âš ï¸ **reshape vs resizeï¼š**
> - `reshape()`ï¼šè¿”å›æ–°è§†å›¾ï¼Œä¸ä¿®æ”¹åŸæ•°ç»„ï¼ˆæ¨èï¼ï¼‰
> - `resize()`ï¼šç›´æ¥ä¿®æ”¹åŸæ•°ç»„ï¼ˆå°‘ç”¨ï¼‰

---

### 3. å±•å¹³æ“ä½œ

æŠŠå¤šç»´æ•°ç»„å˜æˆä¸€ç»´æ•°ç»„â€”â€”åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼ŒæŠŠå›¾åƒç‰¹å¾"æ‘Šå¹³"åé€å…¥åˆ†ç±»å™¨ã€‚

#### 3.1 flatten() vs ravel()

```python
matrix = np.array([[1, 2, 3],
                   [4, 5, 6]])

# flatten() â€” è¿”å›å‰¯æœ¬ï¼ˆå®‰å…¨ï¼Œä¿®æ”¹ä¸å½±å“åŸæ•°ç»„ï¼‰
flat1 = matrix.flatten()
print(flat1)   # [1 2 3 4 5 6]
flat1[0] = 999
print(matrix[0, 0])  # 1ï¼ˆåŸæ•°ç»„æ²¡å˜ï¼‰

# ravel() â€” è¿”å›è§†å›¾ï¼ˆå¿«ï¼Œä½†ä¿®æ”¹ä¼šå½±å“åŸæ•°ç»„ï¼‰
flat2 = matrix.ravel()
print(flat2)   # [1 2 3 4 5 6]
flat2[0] = 999
print(matrix[0, 0])  # 999ï¼ˆåŸæ•°ç»„è¢«æ”¹äº†ï¼ï¼‰
```

| å‡½æ•° | è¿”å› | å†…å­˜ | å®‰å…¨ | é€Ÿåº¦ |
|------|------|------|------|------|
| `flatten()` | å‰¯æœ¬ | æ–°åˆ†é… | âœ… å®‰å…¨ | è¾ƒæ…¢ |
| `ravel()` | è§†å›¾ | å…±äº« | âš ï¸ ä¼šå½±å“åŸæ•°ç»„ | è¾ƒå¿« |
| `reshape(-1)` | è§†å›¾ | å…±äº« | âš ï¸ ä¼šå½±å“åŸæ•°ç»„ | è¾ƒå¿« |

```python
# ä¸‰ç§å±•å¹³æ–¹å¼
matrix = np.arange(12).reshape(3, 4)

print(matrix.flatten())      # å‰¯æœ¬
print(matrix.ravel())        # è§†å›¾
print(matrix.reshape(-1))    # è§†å›¾
# ç»“æœéƒ½æ˜¯ [ 0  1  2  3  4  5  6  7  8  9 10 11]
```

> ğŸ’¡ **å»ºè®®ï¼š** å¦‚æœä¸ç¡®å®šç”¨å“ªä¸ªï¼Œç”¨ `flatten()`â€”â€”å®‰å…¨ä¸å‡ºé”™ã€‚åªæœ‰åœ¨æ€§èƒ½æ•æ„Ÿä¸”ç¡®å®šä¸ä¼šä¿®æ”¹çš„åœºæ™¯æ‰ç”¨ `ravel()`ã€‚

---

### 4. å¢åŠ å’Œåˆ é™¤ç»´åº¦

#### 4.1 np.expand_dims()ï¼šå¢åŠ ç»´åº¦

```python
# ç°åº¦å›¾ (H, W) â†’ æ·»åŠ é€šé“ç»´åº¦ (H, W, 1) æˆ– æ‰¹æ¬¡ç»´åº¦ (1, H, W)
gray = np.zeros((480, 640), dtype=np.uint8)

# åœ¨æœ€ååŠ ä¸€ä¸ªç»´åº¦ â†’ (480, 640, 1)
gray_ch = np.expand_dims(gray, axis=2)
print(gray_ch.shape)   # (480, 640, 1)

# åœ¨æœ€å‰é¢åŠ ä¸€ä¸ªç»´åº¦ â†’ (1, 480, 640)
gray_batch = np.expand_dims(gray, axis=0)
print(gray_batch.shape)   # (1, 480, 640)
```

**æ›´ç®€æ´çš„å†™æ³•ï¼šnp.newaxis**

```python
gray = np.zeros((480, 640), dtype=np.uint8)

# ç­‰ä»·äº expand_dims
print(gray[:, :, np.newaxis].shape)   # (480, 640, 1)
print(gray[np.newaxis, :, :].shape)   # (1, 480, 640)

# np.newaxis å°±æ˜¯ None çš„åˆ«å
print(gray[:, :, None].shape)          # (480, 640, 1)
print(gray[None].shape)                # (1, 480, 640)
```

#### 4.2 np.squeeze()ï¼šåˆ é™¤å¤§å°ä¸º 1 çš„ç»´åº¦

```python
arr = np.zeros((1, 480, 640, 1))
print(arr.shape)   # (1, 480, 640, 1)

# åˆ é™¤æ‰€æœ‰å¤§å°ä¸º1çš„ç»´åº¦
squeezed = np.squeeze(arr)
print(squeezed.shape)   # (480, 640)

# åªåˆ é™¤æŒ‡å®šä½ç½®çš„ç»´åº¦
squeezed0 = np.squeeze(arr, axis=0)
print(squeezed0.shape)   # (480, 640, 1)

squeezed3 = np.squeeze(arr, axis=3)
print(squeezed3.shape)   # (1, 480, 640)
```

> ğŸ’¡ **å¸¸è§åœºæ™¯ï¼š** æ·±åº¦å­¦ä¹ æ¨¡å‹è¾“å‡ºå¯èƒ½å¸¦æœ‰å¤šä½™çš„ç»´åº¦ `(1, 1, 480, 640)`ï¼Œç”¨ `squeeze()` å»æ‰å¤šä½™çš„ 1ã€‚

---

### 5. è½¬ç½®æ“ä½œ

#### 5.1 äºŒç»´è½¬ç½®ï¼š.T

```python
matrix = np.array([[1, 2, 3],
                   [4, 5, 6]])    # (2, 3)

transposed = matrix.T              # (3, 2)
print(transposed)
# [[1 4]
#  [2 5]
#  [3 6]]
```

```
è½¬ç½®å›¾è§£ï¼š

åŸå§‹ (2, 3):          è½¬ç½®å (3, 2):
[[1, 2, 3],           [[1, 4],
 [4, 5, 6]]            [2, 5],
                        [3, 6]]

è¡Œå˜æˆäº†åˆ—ï¼Œåˆ—å˜æˆäº†è¡Œ
```

#### 5.2 å¤šç»´è½¬ç½®ï¼štranspose()

å¯¹äºä¸‰ç»´ä»¥ä¸Šçš„æ•°ç»„ï¼Œ`transpose()` å¯ä»¥æŒ‡å®šè½´çš„é¡ºåºï¼š

```python
# å½©è‰²å›¾åƒï¼š(H, W, C) â†’ (C, H, W)
# è¿™åœ¨ PyTorch ä¸­éå¸¸å¸¸ç”¨ï¼PyTorch è¦æ±‚é€šé“åœ¨å‰

image = np.random.randint(0, 256, (480, 640, 3), dtype=np.uint8)
print(image.shape)   # (480, 640, 3)  â€” OpenCV æ ¼å¼ (H, W, C)

# è½¬ä¸º PyTorch æ ¼å¼ (C, H, W)
pytorch_format = image.transpose(2, 0, 1)   # æŠŠç¬¬2ç»´æ”¾åˆ°ç¬¬0ä½
print(pytorch_format.shape)   # (3, 480, 640)

# è½¬å›æ¥
back = pytorch_format.transpose(1, 2, 0)   # æŠŠç»´åº¦æ¢å¤
print(back.shape)   # (480, 640, 3)
```

```
transpose(2, 0, 1) çš„å«ä¹‰ï¼š

åŸå§‹è½´é¡ºåº:  (0=H, 1=W, 2=C)  â†’ shape (480, 640, 3)
æ–°è½´é¡ºåº:    (2=C, 0=H, 1=W)  â†’ shape (3, 480, 640)

ç¬¬0ä½æ”¾åŸæ¥çš„ç¬¬2ç»´(C=3)
ç¬¬1ä½æ”¾åŸæ¥çš„ç¬¬0ç»´(H=480)
ç¬¬2ä½æ”¾åŸæ¥çš„ç¬¬1ç»´(W=640)
```

#### 5.3 swapaxes()ï¼šäº¤æ¢ä¸¤ä¸ªè½´

```python
# åªäº¤æ¢ä¸¤ä¸ªè½´æ—¶æ¯” transpose æ›´ç®€æ´
image = np.random.randint(0, 256, (480, 640, 3), dtype=np.uint8)

# äº¤æ¢é«˜åº¦å’Œå®½åº¦ï¼ˆç±»ä¼¼æ—‹è½¬90åº¦çš„æ•ˆæœï¼‰
swapped = np.swapaxes(image, 0, 1)
print(swapped.shape)   # (640, 480, 3)
```

---

### 6. æ•°ç»„æ‹¼æ¥

æŠŠå¤šä¸ªæ•°ç»„åˆå¹¶æˆä¸€ä¸ªâ€”â€”åœ¨å›¾åƒå¤„ç†ä¸­ç”¨äºæ‹¼æ¥å›¾åƒã€åˆå¹¶ç‰¹å¾ç­‰ã€‚

#### 6.1 np.concatenate()ï¼šæ²¿å·²æœ‰è½´æ‹¼æ¥

```python
a = np.array([[1, 2],
              [3, 4]])    # (2, 2)
b = np.array([[5, 6],
              [7, 8]])    # (2, 2)

# æ²¿ axis=0 æ‹¼æ¥ï¼ˆå‚ç›´æ–¹å‘ï¼Œä¸Šä¸‹æ‹¼ï¼‰
v = np.concatenate([a, b], axis=0)
print(v)
# [[1 2]
#  [3 4]
#  [5 6]
#  [7 8]]
print(v.shape)   # (4, 2)

# æ²¿ axis=1 æ‹¼æ¥ï¼ˆæ°´å¹³æ–¹å‘ï¼Œå·¦å³æ‹¼ï¼‰
h = np.concatenate([a, b], axis=1)
print(h)
# [[1 2 5 6]
#  [3 4 7 8]]
print(h.shape)   # (2, 4)
```

#### 6.2 vstack / hstackï¼šæ›´ç›´è§‚çš„æ‹¼æ¥

```python
a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6], [7, 8]])

# vstack = å‚ç›´æ‹¼æ¥ = concatenate(axis=0)
print(np.vstack([a, b]).shape)   # (4, 2)

# hstack = æ°´å¹³æ‹¼æ¥ = concatenate(axis=1)
print(np.hstack([a, b]).shape)   # (2, 4)
```

```
æ‹¼æ¥å›¾è§£ï¼š

vstackï¼ˆä¸Šä¸‹æ‹¼ï¼‰:        hstackï¼ˆå·¦å³æ‹¼ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚ a (2,2)â”‚               â”‚ a     â”‚ b     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¤               â”‚ (2,2) â”‚ (2,2) â”‚
â”‚ b (2,2)â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”˜                   ç»“æœ (2, 4)
 ç»“æœ (4, 2)
```

**å›¾åƒæ‹¼æ¥ç¤ºä¾‹ï¼š**

```python
# æŠŠä¸¤å¼ ç°åº¦å›¾æ°´å¹³æ‹¼æ¥ï¼ˆåšå¯¹æ¯”å±•ç¤ºï¼‰
img1 = np.zeros((100, 150), dtype=np.uint8)       # é»‘è‰²
img2 = np.ones((100, 150), dtype=np.uint8) * 255   # ç™½è‰²

comparison = np.hstack([img1, img2])
print(comparison.shape)   # (100, 300)

# æŠŠå››å¼ å›¾æ‹¼æˆ 2x2 çš„ç½‘æ ¼
top = np.hstack([img1, img2])      # ä¸Šé¢ä¸€è¡Œ
bottom = np.hstack([img2, img1])   # ä¸‹é¢ä¸€è¡Œ
grid = np.vstack([top, bottom])    # ä¸Šä¸‹æ‹¼æ¥
print(grid.shape)   # (200, 300)
```

#### 6.3 np.stack()ï¼šæ²¿æ–°è½´æ‹¼æ¥

`stack` å’Œ `concatenate` çš„åŒºåˆ«ï¼š`stack` ä¼š**åˆ›å»ºä¸€ä¸ªæ–°çš„ç»´åº¦**ã€‚

```python
a = np.array([1, 2, 3])   # (3,)
b = np.array([4, 5, 6])   # (3,)

# stack æ²¿æ–°è½´å †å 
stacked0 = np.stack([a, b], axis=0)   # æ²¿æ–°çš„ç¬¬0è½´
print(stacked0)
# [[1 2 3]
#  [4 5 6]]
print(stacked0.shape)   # (2, 3)

stacked1 = np.stack([a, b], axis=1)   # æ²¿æ–°çš„ç¬¬1è½´
print(stacked1)
# [[1 4]
#  [2 5]
#  [3 6]]
print(stacked1.shape)   # (3, 2)
```

**æ‰¹é‡å›¾åƒæ‰“åŒ…ï¼š**

```python
# æŠŠå¤šå¼ å›¾åƒæ‰“åŒ…æˆä¸€ä¸ªæ‰¹æ¬¡ (N, H, W, C)
images = [np.random.randint(0, 256, (224, 224, 3), dtype=np.uint8)
          for _ in range(8)]

batch = np.stack(images, axis=0)
print(batch.shape)   # (8, 224, 224, 3)  â€” 8å¼ å›¾çš„æ‰¹æ¬¡
```

---

### 7. æ•°ç»„åˆ†å‰²

æŠŠä¸€ä¸ªå¤§æ•°ç»„åˆ†æˆå¤šä¸ªå°æ•°ç»„â€”â€”æ‹†åˆ†å›¾åƒã€åˆ†ç¦»é€šé“ç­‰ã€‚

#### 7.1 np.split()ï¼šç­‰åˆ†

```python
arr = np.arange(12).reshape(4, 3)
print(arr)
# [[ 0  1  2]
#  [ 3  4  5]
#  [ 6  7  8]
#  [ 9 10 11]]

# æ²¿ axis=0 åˆ†æˆ 2 ä»½ï¼ˆæ¯ä»½ 2 è¡Œï¼‰
parts = np.split(arr, 2, axis=0)
print(parts[0])   # [[0 1 2] [3 4 5]]
print(parts[1])   # [[6 7 8] [9 10 11]]

# æ²¿ axis=1 åˆ†æˆ 3 ä»½ï¼ˆæ¯ä»½ 1 åˆ—ï¼‰
cols = np.split(arr, 3, axis=1)
print(cols[0])   # [[ 0] [ 3] [ 6] [ 9]]
```

#### 7.2 vsplit / hsplitï¼šæ›´ç›´è§‚çš„åˆ†å‰²

```python
arr = np.arange(16).reshape(4, 4)

# vsplit = å‚ç›´åˆ†å‰² = split(axis=0)
top, bottom = np.vsplit(arr, 2)
print(top.shape)      # (2, 4)
print(bottom.shape)   # (2, 4)

# hsplit = æ°´å¹³åˆ†å‰² = split(axis=1)
left, right = np.hsplit(arr, 2)
print(left.shape)     # (4, 2)
print(right.shape)    # (4, 2)
```

**å›¾åƒé€šé“åˆ†ç¦»ï¼ˆç”¨åˆ†å‰²å®ç°ï¼‰ï¼š**

```python
color_image = np.random.randint(0, 256, (480, 640, 3), dtype=np.uint8)

# åˆ†ç¦» BGR ä¸‰ä¸ªé€šé“
b, g, r = np.split(color_image, 3, axis=2)
print(b.shape)   # (480, 640, 1)  æ³¨æ„ï¼šå¤šäº†ä¸€ä¸ªç»´åº¦ï¼

# å»æ‰å¤šä½™çš„ç»´åº¦
b = np.squeeze(b)
print(b.shape)   # (480, 640)

# æ›´ç®€å•çš„åˆ†ç¦»æ–¹å¼ï¼ˆæ¨èï¼ï¼‰
b = color_image[:, :, 0]
g = color_image[:, :, 1]
r = color_image[:, :, 2]
```

---

## ğŸ’» ä»£ç å®æˆ˜

### å®æˆ˜ç»ƒä¹ ï¼šå›¾åƒå½¢çŠ¶å˜æ¢å·¥å…·ç®±

```python
# ===================================================================
# å®æˆ˜ç»ƒä¹ ï¼šå›¾åƒå½¢çŠ¶å˜æ¢å·¥å…·ç®±
# ç›®æ ‡ï¼šç»¼åˆè¿ç”¨ reshapeã€æ‹¼æ¥ã€åˆ†å‰²ã€è½¬ç½®
# ===================================================================

import numpy as np

# ---------- 1. reshape åŸºç¡€æ“ä½œ ----------
print("=" * 55)
print("ğŸ”„ ç¬¬ä¸€æ­¥ï¼šreshape åŸºç¡€")
print("=" * 55)

arr = np.arange(24)
print(f"  åŸå§‹: shape={arr.shape}, å†…å®¹={arr}")

# å„ç§ reshape
shapes = [(2, 12), (3, 8), (4, 6), (2, 3, 4), (2, 2, 6)]
for s in shapes:
    reshaped = arr.reshape(s)
    print(f"  reshape{s}: shape={reshaped.shape}")

# ä½¿ç”¨ -1 è‡ªåŠ¨è®¡ç®—
print(f"\n  reshape(6, -1): {arr.reshape(6, -1).shape}")    # (6, 4)
print(f"  reshape(-1, 3): {arr.reshape(-1, 3).shape}")      # (8, 3)
print(f"  reshape(2, -1, 4): {arr.reshape(2, -1, 4).shape}")  # (2, 3, 4)

# ---------- 2. å±•å¹³æ“ä½œ ----------
print("\n" + "=" * 55)
print("ğŸ“ ç¬¬äºŒæ­¥ï¼šå±•å¹³æ“ä½œ")
print("=" * 55)

image = np.arange(12).reshape(3, 4)
print(f"  åŸå§‹å›¾åƒ (3x4):\n{image}\n")

print(f"  flatten():    {image.flatten()}")
print(f"  ravel():      {image.ravel()}")
print(f"  reshape(-1):  {image.reshape(-1)}")

# å®‰å…¨æ€§å¯¹æ¯”
flat_copy = image.flatten()
flat_view = image.ravel()
flat_copy[0] = 999
flat_view[0] = 888
print(f"\n  ä¿®æ”¹ flatten ååŸæ•°ç»„[0,0]: {image[0,0]}")   # 888 (è¢« ravel æ”¹äº†)

# ---------- 3. ç»´åº¦å¢å‡ ----------
print("\n" + "=" * 55)
print("ğŸ“ ç¬¬ä¸‰æ­¥ï¼šç»´åº¦å¢å‡")
print("=" * 55)

gray = np.zeros((100, 150), dtype=np.uint8)
print(f"  ç°åº¦å›¾: {gray.shape}")

# å¢åŠ ç»´åº¦
with_channel = gray[:, :, np.newaxis]
print(f"  åŠ é€šé“ç»´åº¦: {with_channel.shape}")       # (100, 150, 1)

with_batch = gray[np.newaxis, :, :]
print(f"  åŠ æ‰¹æ¬¡ç»´åº¦: {with_batch.shape}")          # (1, 100, 150)

both = gray[np.newaxis, :, :, np.newaxis]
print(f"  åŠ ä¸¤ä¸ªç»´åº¦: {both.shape}")                # (1, 100, 150, 1)

# åˆ é™¤ç»´åº¦
squeezed = np.squeeze(both)
print(f"  squeeze å›æ¥: {squeezed.shape}")          # (100, 150)

# ---------- 4. è½¬ç½®æ“ä½œ ----------
print("\n" + "=" * 55)
print("ğŸ”€ ç¬¬å››æ­¥ï¼šè½¬ç½®æ“ä½œ")
print("=" * 55)

# äºŒç»´è½¬ç½®
matrix = np.arange(6).reshape(2, 3)
print(f"  åŸå§‹ (2,3):\n{matrix}")
print(f"  è½¬ç½® (3,2):\n{matrix.T}")

# ä¸‰ç»´è½¬ç½®ï¼šHWC â†’ CHWï¼ˆOpenCV â†’ PyTorchï¼‰
image = np.random.randint(0, 256, (4, 6, 3), dtype=np.uint8)
print(f"\n  OpenCV æ ¼å¼ (H,W,C): {image.shape}")

pytorch = image.transpose(2, 0, 1)
print(f"  PyTorch æ ¼å¼ (C,H,W): {pytorch.shape}")

back = pytorch.transpose(1, 2, 0)
print(f"  è½¬å› OpenCV (H,W,C): {back.shape}")

# ---------- 5. å›¾åƒæ‹¼æ¥ ----------
print("\n" + "=" * 55)
print("ğŸ§© ç¬¬äº”æ­¥ï¼šå›¾åƒæ‹¼æ¥")
print("=" * 55)

# åˆ›å»º 4 å¼ ä¸åŒç°åº¦å€¼çš„å°å›¾
imgs = [np.full((3, 4), val, dtype=np.uint8)
        for val in [0, 85, 170, 255]]

print(f"  4 å¼ å°å›¾, æ¯å¼  shape: {imgs[0].shape}")

# æ°´å¹³æ‹¼æ¥
h_concat = np.hstack(imgs)
print(f"  æ°´å¹³æ‹¼æ¥: {h_concat.shape}")
print(f"  {h_concat}\n")

# 2x2 ç½‘æ ¼
top = np.hstack([imgs[0], imgs[1]])
bottom = np.hstack([imgs[2], imgs[3]])
grid = np.vstack([top, bottom])
print(f"  2x2 ç½‘æ ¼: {grid.shape}")
print(f"  {grid}\n")

# æ‰¹é‡å›¾åƒæ‰“åŒ…
batch = np.stack(imgs, axis=0)
print(f"  stack æ‰“åŒ…: {batch.shape}")   # (4, 3, 4)

# ---------- 6. å›¾åƒåˆ†å‰² ----------
print("\n" + "=" * 55)
print("âœ‚ï¸ ç¬¬å…­æ­¥ï¼šå›¾åƒåˆ†å‰²")
print("=" * 55)

big_image = np.arange(48).reshape(6, 8)
print(f"  å¤§å›¾ (6x8):\n{big_image}\n")

# å‚ç›´åˆ†æˆ 3 ä»½
v_parts = np.vsplit(big_image, 3)
for i, part in enumerate(v_parts):
    print(f"  å‚ç›´ç¬¬{i}å— {part.shape}: {part.flatten()}")

# æ°´å¹³åˆ†æˆ 4 ä»½
h_parts = np.hsplit(big_image, 4)
print()
for i, part in enumerate(h_parts):
    print(f"  æ°´å¹³ç¬¬{i}å— {part.shape}:\n{part}")
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**

```
=======================================================
ğŸ”„ ç¬¬ä¸€æ­¥ï¼šreshape åŸºç¡€
=======================================================
  åŸå§‹: shape=(24,), å†…å®¹=[ 0  1  2 ... 23]
  reshape(2, 12): shape=(2, 12)
  reshape(3, 8): shape=(3, 8)
  reshape(4, 6): shape=(4, 6)
  reshape(2, 3, 4): shape=(2, 3, 4)
  reshape(2, 2, 6): shape=(2, 2, 6)

=======================================================
ğŸ“ ç¬¬ä¸‰æ­¥ï¼šç»´åº¦å¢å‡
=======================================================
  ç°åº¦å›¾: (100, 150)
  åŠ é€šé“ç»´åº¦: (100, 150, 1)
  åŠ æ‰¹æ¬¡ç»´åº¦: (1, 100, 150)

=======================================================
ğŸ”€ ç¬¬å››æ­¥ï¼šè½¬ç½®æ“ä½œ
=======================================================
  OpenCV æ ¼å¼ (H,W,C): (4, 6, 3)
  PyTorch æ ¼å¼ (C,H,W): (3, 4, 6)
  è½¬å› OpenCV (H,W,C): (4, 6, 3)

=======================================================
ğŸ§© ç¬¬äº”æ­¥ï¼šå›¾åƒæ‹¼æ¥
=======================================================
  æ°´å¹³æ‹¼æ¥: (3, 16)
  2x2 ç½‘æ ¼: (6, 8)
  stack æ‰“åŒ…: (4, 3, 4)
```

---

## ğŸš¨ å¸¸è§é—®é¢˜ä¸æ˜“é”™ç‚¹

### Q1: reshape æŠ¥é”™ "cannot reshape array of size X into shape Y"ï¼Ÿ

```python
arr = np.arange(12)

# âŒ å…ƒç´ æ€»æ•°ä¸åŒ¹é…ï¼ˆ12 â‰  3Ã—5=15ï¼‰
# arr.reshape(3, 5)   # ValueError!

# âœ… ç¡®ä¿ reshape å‰åå…ƒç´ æ€»æ•°ä¸€è‡´
arr.reshape(3, 4)     # 12 = 3Ã—4 âœ“
arr.reshape(2, 6)     # 12 = 2Ã—6 âœ“
arr.reshape(2, 2, 3)  # 12 = 2Ã—2Ã—3 âœ“
```

### Q2: flatten å’Œ ravel åˆ°åº•ç”¨å“ªä¸ªï¼Ÿ

```python
# ç®€å•åŸåˆ™ï¼š
# - éœ€è¦å®‰å…¨ï¼ˆä¸å½±å“åŸæ•°ç»„ï¼‰â†’ flatten()
# - éœ€è¦æ€§èƒ½ï¼ˆåªè¯»ä¸æ”¹ï¼‰â†’ ravel()
# - ä¸ç¡®å®š â†’ flatten()ï¼ˆæ›´å®‰å…¨ï¼‰

matrix = np.arange(6).reshape(2, 3)

safe = matrix.flatten()     # å‰¯æœ¬ï¼Œå®‰å…¨
fast = matrix.ravel()       # è§†å›¾ï¼Œå¿«ä½†å±é™©
```

### Q3: HWC å’Œ CHW æ ¼å¼æ€»ææ··ï¼Ÿ

```python
# OpenCV / NumPy é»˜è®¤: (H, W, C)  â€” é«˜åº¦Ã—å®½åº¦Ã—é€šé“
# PyTorch é»˜è®¤:        (C, H, W)  â€” é€šé“Ã—é«˜åº¦Ã—å®½åº¦
# TensorFlow é»˜è®¤:     (H, W, C)  â€” å’Œ OpenCV ä¸€æ ·

# OpenCV â†’ PyTorch:  transpose(2, 0, 1)
# PyTorch â†’ OpenCV:  transpose(1, 2, 0)

img_hwc = np.zeros((480, 640, 3))   # OpenCV
img_chw = img_hwc.transpose(2, 0, 1)  # PyTorch
img_back = img_chw.transpose(1, 2, 0)  # å›åˆ° OpenCV
```

### Q4: concatenate å’Œ stack æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

```python
a = np.array([1, 2, 3])  # (3,)
b = np.array([4, 5, 6])  # (3,)

# concatenate: æ²¿å·²æœ‰è½´æ‹¼æ¥ï¼Œä¸å¢åŠ ç»´åº¦
print(np.concatenate([a, b]).shape)       # (6,)

# stack: åˆ›å»ºæ–°è½´ï¼Œå¢åŠ ç»´åº¦
print(np.stack([a, b], axis=0).shape)     # (2, 3)
print(np.stack([a, b], axis=1).shape)     # (3, 2)

# ç®€å•è®°å¿†ï¼š
# concatenate = "æ¥èµ·æ¥"ï¼ˆç»´åº¦ä¸å˜ï¼‰
# stack = "å èµ·æ¥"ï¼ˆç»´åº¦+1ï¼‰
```

---

## ğŸ¯ æ€»ç»“

æœ¬èŠ‚å­¦ä¹ äº† NumPy æ•°ç»„çš„å½¢çŠ¶æ“ä½œï¼š

âœ… **reshape**ï¼šæ”¹å˜å½¢çŠ¶ï¼Œå…ƒç´ æ€»æ•°ä¸å˜ï¼Œ-1 è‡ªåŠ¨è®¡ç®—
âœ… **å±•å¹³**ï¼š`flatten()`ï¼ˆå®‰å…¨å‰¯æœ¬ï¼‰ã€`ravel()`ï¼ˆå¿«é€Ÿè§†å›¾ï¼‰ã€`reshape(-1)`
âœ… **å¢å‡ç»´åº¦**ï¼š`expand_dims()` / `np.newaxis` å¢åŠ ï¼Œ`squeeze()` åˆ é™¤
âœ… **è½¬ç½®**ï¼š`.T`ï¼ˆäºŒç»´ï¼‰ã€`transpose()`ï¼ˆå¤šç»´ï¼‰ã€HWCâ†”CHW è½¬æ¢
âœ… **æ‹¼æ¥**ï¼š`concatenate`ï¼ˆæ²¿å·²æœ‰è½´ï¼‰ã€`vstack`/`hstack`ï¼ˆä¸Šä¸‹/å·¦å³ï¼‰ã€`stack`ï¼ˆæ–°è½´ï¼‰
âœ… **åˆ†å‰²**ï¼š`split`ã€`vsplit`ã€`hsplit`

> ğŸ”‘ **æ ¸å¿ƒè¦ç‚¹ï¼š** å›¾åƒæ•°æ®æ ¼å¼è½¬æ¢ï¼ˆHWCâ†”CHWï¼‰ç”¨ `transpose`ï¼Œæ‰¹é‡æ‰“åŒ…ç”¨ `stack`ï¼Œå›¾åƒæ‹¼æ¥å±•ç¤ºç”¨ `hstack`/`vstack`ï¼Œå±•å¹³ç‰¹å¾ç”¨ `flatten`ã€‚è¿™äº›æ“ä½œåœ¨æ·±åº¦å­¦ä¹ æ•°æ®é¢„å¤„ç†ä¸­å‡ ä¹æ¯æ¬¡éƒ½ä¼šç”¨åˆ°ã€‚

**ä¸‹ä¸€æ­¥ï¼š**
ğŸ‘‰ [05 - å¸¸ç”¨å‡½æ•°](../05-å¸¸ç”¨å‡½æ•°/å¸¸ç”¨å‡½æ•°.md)

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [NumPy å®˜æ–¹æ–‡æ¡£ - æ•°ç»„æ“ä½œ](https://numpy.org/doc/stable/reference/routines.array-manipulation.html)
- [NumPy å®˜æ–¹æ–‡æ¡£ - reshape](https://numpy.org/doc/stable/reference/generated/numpy.reshape.html)
