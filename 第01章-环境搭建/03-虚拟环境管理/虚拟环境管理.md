# è™šæ‹Ÿç¯å¢ƒç®¡ç†

> è™šæ‹Ÿç¯å¢ƒå¯ä»¥ä¸ºä¸åŒé¡¹ç›®åˆ›å»ºç‹¬ç«‹çš„ Python ç¯å¢ƒï¼Œé¿å…åŒ…ç‰ˆæœ¬å†²çªï¼Œæ˜¯ä¸“ä¸š Python å¼€å‘çš„å¿…å¤‡æŠ€èƒ½ã€‚

---

## ğŸ“– ç†è®ºéƒ¨åˆ†

### 1. ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿç¯å¢ƒ

**é—®é¢˜åœºæ™¯ï¼š**

å‡è®¾ä½ æœ‰ä¸¤ä¸ªé¡¹ç›®ï¼š
- **é¡¹ç›®A**ï¼šä½¿ç”¨ OpenCV 4.5.0
- **é¡¹ç›®B**ï¼šä½¿ç”¨ OpenCV 4.8.0

å¦‚æœåœ¨å…¨å±€ç¯å¢ƒå®‰è£…ï¼Œåªèƒ½ä¿ç•™ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¼šå¯¼è‡´ç‰ˆæœ¬å†²çªï¼

**è™šæ‹Ÿç¯å¢ƒçš„ä¼˜åŠ¿ï¼š**
- âœ… **éš”ç¦»ä¾èµ–**ï¼šæ¯ä¸ªé¡¹ç›®ç‹¬ç«‹çš„åŒ…ç¯å¢ƒ
- âœ… **é¿å…å†²çª**ï¼šä¸åŒé¡¹ç›®å¯ä»¥ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„åº“
- âœ… **ç¯å¢ƒå¤ç°**ï¼šé€šè¿‡ requirements.txt è½»æ¾å¤åˆ¶ç¯å¢ƒ
- âœ… **æƒé™ç®¡ç†**ï¼šä¸éœ€è¦ç®¡ç†å‘˜æƒé™å®‰è£…åŒ…
- âœ… **é¡¹ç›®æ•´æ´**ï¼šåˆ é™¤é¡¹ç›®æ—¶ä¸€å¹¶åˆ é™¤è™šæ‹Ÿç¯å¢ƒ

**è™šæ‹Ÿç¯å¢ƒå·¥ä½œåŸç†ï¼š**
```
å…¨å±€ Python ç¯å¢ƒ
â”œâ”€â”€ Python è§£é‡Šå™¨ (å…±äº«)
â””â”€â”€ å…¨å±€ site-packages

é¡¹ç›®è™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ Python è§£é‡Šå™¨ (è½¯é“¾æ¥/å‰¯æœ¬)
â””â”€â”€ ç‹¬ç«‹çš„ site-packages (éš”ç¦»)
```

---

### 2. venv ä¸ conda å¯¹æ¯”

Python æœ‰å¤šç§è™šæ‹Ÿç¯å¢ƒç®¡ç†å·¥å…·ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ **venv** å’Œ **conda**ã€‚

| ç‰¹æ€§ | venv | conda |
|------|------|-------|
| **å†…ç½®** | âœ… Python 3.3+ è‡ªå¸¦ | âŒ éœ€è¦å•ç‹¬å®‰è£… |
| **è½»é‡çº§** | âœ… éå¸¸è½»é‡ | âŒ è¾ƒé‡ï¼ˆåŒ…å«åŒ…ç®¡ç†å™¨ï¼‰ |
| **Python ç‰ˆæœ¬ç®¡ç†** | âŒ ä½¿ç”¨ç³»ç»Ÿ Python | âœ… å¯ä»¥å®‰è£…ä¸åŒ Python ç‰ˆæœ¬ |
| **åŒ…ç®¡ç†** | pip | conda + pip |
| **è·¨è¯­è¨€æ”¯æŒ** | âŒ ä»… Python | âœ… Rã€Julia ç­‰ |
| **é€‚åˆåœºæ™¯** | çº¯ Python é¡¹ç›® | æ•°æ®ç§‘å­¦ã€æœºå™¨å­¦ä¹  |

**æ¨èé€‰æ‹©ï¼š**
- **ç®€å•é¡¹ç›®**ï¼šä½¿ç”¨ venvï¼ˆè½»é‡ã€å†…ç½®ï¼‰
- **æ•°æ®ç§‘å­¦/æ·±åº¦å­¦ä¹ **ï¼šä½¿ç”¨ condaï¼ˆç®¡ç†å¤æ‚ä¾èµ–ï¼‰

---

### 3. venv ä½¿ç”¨æ–¹æ³•

**venv** æ˜¯ Python 3.3+ è‡ªå¸¦çš„è™šæ‹Ÿç¯å¢ƒæ¨¡å—ã€‚

#### åŸºæœ¬æ¦‚å¿µ

- **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**ï¼š`python -m venv ç¯å¢ƒå`
- **æ¿€æ´»ç¯å¢ƒ**ï¼šè¿›å…¥è™šæ‹Ÿç¯å¢ƒï¼Œåç»­ pip å®‰è£…çš„åŒ…åªåœ¨æ­¤ç¯å¢ƒç”Ÿæ•ˆ
- **åœç”¨ç¯å¢ƒ**ï¼šé€€å‡ºè™šæ‹Ÿç¯å¢ƒ
- **åˆ é™¤ç¯å¢ƒ**ï¼šç›´æ¥åˆ é™¤ç¯å¢ƒæ–‡ä»¶å¤¹

---

### 4. conda ä½¿ç”¨æ–¹æ³•

**conda** æ˜¯ Anaconda/Miniconda æä¾›çš„åŒ…å’Œç¯å¢ƒç®¡ç†å™¨ã€‚

#### å®‰è£… Minicondaï¼ˆæ¨èï¼‰

**Windowsï¼š**
1. ä¸‹è½½ï¼šhttps://docs.conda.io/en/latest/miniconda.html
2. å®‰è£…æ—¶å‹¾é€‰ "Add Anaconda to PATH"
3. é‡å¯ç»ˆç«¯

**macOS/Linuxï¼š**
```bash
# ä¸‹è½½å¹¶å®‰è£…
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
```

---

## ğŸ’» ä»£ç å®æˆ˜

### venv åˆ›å»ºä¸æ¿€æ´»

#### Windows ç³»ç»Ÿ

```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆåœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼‰
cd E:\å­¦ä¹ ç”¨\è§†è§‰æ•™å­¦
python -m venv venv

# è¯´æ˜ï¼š
# - python -m venvï¼šè°ƒç”¨ venv æ¨¡å—
# - venvï¼šè™šæ‹Ÿç¯å¢ƒæ–‡ä»¶å¤¹åç§°ï¼ˆå¯è‡ªå®šä¹‰ï¼Œå¦‚ envã€.venvï¼‰

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆPowerShellï¼‰
.\venv\Scripts\Activate.ps1

# æˆ–ï¼ˆCMDï¼‰
venv\Scripts\activate.bat

# æ¿€æ´»åï¼Œæç¤ºç¬¦ä¼šæ˜¾ç¤ºï¼š(venv) PS E:\å­¦ä¹ ç”¨\è§†è§‰æ•™å­¦>

# 3. éªŒè¯è™šæ‹Ÿç¯å¢ƒ
python --version
pip --version
which python  # åº”æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒä¸­çš„ Python

# 4. åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…åŒ…
pip install numpy
pip install opencv-python

# 5. åœç”¨è™šæ‹Ÿç¯å¢ƒ
deactivate
```

#### macOS/Linux ç³»ç»Ÿ

```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# æ¿€æ´»åï¼Œæç¤ºç¬¦ä¼šæ˜¾ç¤ºï¼š(venv) user@hostname:~$

# 3. åœç”¨è™šæ‹Ÿç¯å¢ƒ
deactivate
```

---

### conda ç¯å¢ƒç®¡ç†

#### åŸºæœ¬å‘½ä»¤

```bash
# æŸ¥çœ‹ conda ç‰ˆæœ¬
conda --version

# æ›´æ–° conda
conda update conda

# æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒ
conda env list
# æˆ–
conda info --envs

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæŒ‡å®š Python ç‰ˆæœ¬ï¼‰
conda create -n cv_env python=3.11

# è¯´æ˜ï¼š
# - -nï¼šç¯å¢ƒåç§°
# - cv_envï¼šè‡ªå®šä¹‰ç¯å¢ƒå
# - python=3.11ï¼šæŒ‡å®š Python ç‰ˆæœ¬

# æ¿€æ´»ç¯å¢ƒ
conda activate cv_env

# æ¿€æ´»åï¼Œæç¤ºç¬¦ä¼šæ˜¾ç¤ºï¼š(cv_env) user@hostname:~$

# åœç”¨ç¯å¢ƒ
conda deactivate

# åˆ é™¤ç¯å¢ƒ
conda remove -n cv_env --all

# å¯¼å‡ºç¯å¢ƒé…ç½®
conda env export > environment.yml

# ä»é…ç½®æ–‡ä»¶åˆ›å»ºç¯å¢ƒ
conda env create -f environment.yml
```

---

#### conda åŒ…ç®¡ç†

```bash
# æ¿€æ´»ç¯å¢ƒå...

# å®‰è£…åŒ…
conda install numpy
conda install opencv

# å®‰è£…æŒ‡å®šç‰ˆæœ¬
conda install numpy=1.24.0

# ä» conda-forge å®‰è£…ï¼ˆæ›´å¤šåŒ…ï¼‰
conda install -c conda-forge package_name

# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…
conda list

# æ›´æ–°åŒ…
conda update numpy

# åˆ é™¤åŒ…
conda remove numpy

# æ¸…ç†ç¼“å­˜
conda clean --all
```

---

### åœ¨ VSCode ä¸­ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

#### é€‰æ‹©è™šæ‹Ÿç¯å¢ƒ

1. æ‰“å¼€ VSCode
2. æ‰“å¼€é¡¹ç›®æ–‡ä»¶å¤¹
3. æŒ‰ `Ctrl + Shift + P` æ‰“å¼€å‘½ä»¤é¢æ¿
4. è¾“å…¥ "Python: Select Interpreter"
5. é€‰æ‹©è™šæ‹Ÿç¯å¢ƒä¸­çš„ Pythonï¼š
   - venvï¼š`.\venv\Scripts\python.exe`
   - condaï¼š`(cv_env) Python 3.11.x`

#### è‡ªåŠ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

VSCode ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š
- æ‰“å¼€ç»ˆç«¯æ—¶è‡ªåŠ¨æ¿€æ´»
- è¿è¡Œ Python ä»£ç æ—¶ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

#### éªŒè¯è™šæ‹Ÿç¯å¢ƒ

åˆ›å»ºæµ‹è¯•æ–‡ä»¶ `test_venv.py`ï¼š

```python
# test_venv.py
import sys
import os

print("=" * 60)
print("ğŸ” è™šæ‹Ÿç¯å¢ƒæ£€æŸ¥")
print("=" * 60)

# æ˜¾ç¤º Python è§£é‡Šå™¨è·¯å¾„
print(f"\nğŸ“Œ Python è§£é‡Šå™¨: {sys.executable}")

# æ˜¾ç¤º site-packages è·¯å¾„
import site
print(f"\nğŸ“¦ åŒ…å®‰è£…è·¯å¾„:")
for path in site.getsitepackages():
    print(f"   - {path}")

# æ£€æŸ¥æ˜¯å¦åœ¨è™šæ‹Ÿç¯å¢ƒä¸­
in_venv = hasattr(sys, 'real_prefix') or (
    hasattr(sys, 'base_prefix') and sys.base_prefix != sys.prefix
)

if in_venv:
    print("\nâœ… å½“å‰åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼")
    print(f"   è™šæ‹Ÿç¯å¢ƒè·¯å¾„: {sys.prefix}")
else:
    print("\nâš ï¸  å½“å‰åœ¨å…¨å±€ç¯å¢ƒä¸­")
    print(f"   å…¨å±€ç¯å¢ƒè·¯å¾„: {sys.prefix}")

print("\n" + "=" * 60)
```

**è¿è¡Œæµ‹è¯•ï¼š**

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå
python test_venv.py
```

---

### é¡¹ç›®å®æˆ˜ï¼šåˆ›å»ºå®Œæ•´çš„è™šæ‹Ÿç¯å¢ƒ

#### æ­¥éª¤1ï¼šåˆ›å»ºé¡¹ç›®ç»“æ„

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir cv_project
cd cv_project

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆWindows PowerShellï¼‰
.\venv\Scripts\Activate.ps1

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆmacOS/Linuxï¼‰
source venv/bin/activate
```

#### æ­¥éª¤2ï¼šå®‰è£…é¡¹ç›®ä¾èµ–

```bash
# å‡çº§ pip
python -m pip install --upgrade pip

# å®‰è£…è®¡ç®—æœºè§†è§‰ç›¸å…³åŒ…
pip install numpy
pip install opencv-python
pip install matplotlib
pip install pillow

# æŸ¥çœ‹å·²å®‰è£…çš„åŒ…
pip list
```

#### æ­¥éª¤3ï¼šå¯¼å‡ºä¾èµ–åˆ—è¡¨

```bash
# å¯¼å‡ºåˆ° requirements.txt
pip freeze > requirements.txt
```

**ç”Ÿæˆçš„ requirements.txtï¼š**

```
numpy==1.24.3
opencv-python==4.8.1.78
matplotlib==3.7.2
Pillow==10.0.0
```

#### æ­¥éª¤4ï¼šå¤åˆ¶ç¯å¢ƒåˆ°å…¶ä»–æœºå™¨

```bash
# åœ¨æ–°æœºå™¨ä¸Šï¼š
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# 2. æ¿€æ´»ç¯å¢ƒ
source venv/bin/activate  # macOS/Linux
# æˆ–
.\venv\Scripts\Activate.ps1  # Windows

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

---

### å¸¸è§é—®é¢˜å¤„ç†

#### é—®é¢˜1ï¼šPowerShell æ— æ³•è¿è¡Œè„šæœ¬

**é”™è¯¯ä¿¡æ¯ï¼š**
```
æ— æ³•åŠ è½½æ–‡ä»¶ venv\Scripts\Activate.ps1ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬ã€‚
```

**è§£å†³æ–¹æ³•ï¼š**

```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell
Set-ExecutionPolicy RemoteSigned

# æˆ–ä¸´æ—¶å…è®¸ï¼ˆå½“å‰ä¼šè¯ï¼‰
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
```

---

#### é—®é¢˜2ï¼švenv åˆ›å»ºå¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: Command '...' returned non-zero exit status 1.
```

**è§£å†³æ–¹æ³•ï¼š**

```bash
# ç¡®ä¿å·²å®‰è£… venv æ¨¡å—ï¼ˆUbuntu/Debianï¼‰
sudo apt install python3-venv

# æˆ–ä½¿ç”¨ virtualenvï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰
pip install virtualenv
virtualenv venv
```

---

#### é—®é¢˜3ï¼šåˆ é™¤è™šæ‹Ÿç¯å¢ƒ

```bash
# 1. åœç”¨ç¯å¢ƒ
deactivate

# 2. ç›´æ¥åˆ é™¤æ–‡ä»¶å¤¹ï¼ˆWindowsï¼‰
rmdir /s venv

# æˆ–ï¼ˆmacOS/Linuxï¼‰
rm -rf venv
```

---

## ğŸ¯ æ€»ç»“

æœ¬èŠ‚å­¦ä¹ äº†è™šæ‹Ÿç¯å¢ƒç®¡ç†çš„å®Œæ•´æµç¨‹ï¼š

âœ… **ç†è§£è™šæ‹Ÿç¯å¢ƒ**ï¼šéš”ç¦»ä¾èµ–ï¼Œé¿å…å†²çª
âœ… **venv ä½¿ç”¨**ï¼šPython å†…ç½®ï¼Œè½»é‡çº§
âœ… **conda ä½¿ç”¨**ï¼šé€‚åˆæ•°æ®ç§‘å­¦ï¼Œç®¡ç† Python ç‰ˆæœ¬
âœ… **VSCode é›†æˆ**ï¼šè‡ªåŠ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
âœ… **é¡¹ç›®å®æˆ˜**ï¼šrequirements.txt ç¯å¢ƒå¤åˆ¶

**æœ€ä½³å®è·µï¼š**
- æ¯ä¸ªé¡¹ç›®ä½¿ç”¨ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒ
- ä½¿ç”¨ requirements.txt ç®¡ç†ä¾èµ–
- è™šæ‹Ÿç¯å¢ƒä¸è¦æäº¤åˆ° Gitï¼ˆæ·»åŠ åˆ° .gitignoreï¼‰

**ä¸‹ä¸€æ­¥ï¼š**
ğŸ‘‰ [04 - OpenCVå®‰è£…](../04-OpenCVå®‰è£…/README.md)

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [venv å®˜æ–¹æ–‡æ¡£](https://docs.python.org/zh-cn/3/library/venv.html)
- [conda å®˜æ–¹æ–‡æ¡£](https://docs.conda.io/en/latest/)
- [Virtualenv æ–‡æ¡£](https://virtualenv.pypa.io/en/latest/)
